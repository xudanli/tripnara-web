# å»ºè®®ç³»ç»ŸAPIæ¥å£é›†æˆæµ‹è¯•æ¸…å•

**æµ‹è¯•æ—¥æœŸ**: ___________
**æµ‹è¯•äººå‘˜**: ___________
**æµ‹è¯•ç¯å¢ƒ**: [ ] å¼€å‘ç¯å¢ƒ [ ] æµ‹è¯•ç¯å¢ƒ [ ] ç”Ÿäº§ç¯å¢ƒ

---

## ğŸ“‹ æµ‹è¯•ç›®æ ‡

éªŒè¯å»ºè®®ç³»ç»ŸAPIæ¥å£åœ¨å‰ç«¯ä»£ç ä¸­çš„é›†æˆæ˜¯å¦æ­£ç¡®ï¼ŒåŒ…æ‹¬ï¼š
1. APIæ¥å£è°ƒç”¨çš„æ­£ç¡®æ€§
2. å‚æ•°ä¼ é€’çš„æ­£ç¡®æ€§
3. å“åº”æ•°æ®å¤„ç†çš„æ­£ç¡®æ€§
4. é”™è¯¯å¤„ç†çš„æ­£ç¡®æ€§

---

## âœ… æµ‹è¯•æ¸…å•

### 1. GET /trips/:id/suggestions - è·å–å»ºè®®åˆ—è¡¨

#### 1.1 åŸºç¡€è°ƒç”¨æµ‹è¯•

- [ ] **æ— å‚æ•°è°ƒç”¨**
  ```typescript
  const result = await tripsApi.getSuggestions(tripId);
  ```
  - [ ] æ¥å£è°ƒç”¨æˆåŠŸ
  - [ ] è¿”å› `SuggestionListResponse` æ ¼å¼
  - [ ] `items` æ˜¯æ•°ç»„
  - [ ] `total` æ˜¯æ•°å­—

- [ ] **å¸¦è¿‡æ»¤å‚æ•°è°ƒç”¨**
  ```typescript
  const result = await tripsApi.getSuggestions(tripId, {
    persona: 'abu',
    scope: 'day',
    scopeId: 'day-123',
    severity: 'blocker',
    status: 'new',
    limit: 20,
    offset: 0,
  });
  ```
  - [ ] æ‰€æœ‰å‚æ•°æ­£ç¡®ä¼ é€’
  - [ ] è¿‡æ»¤ç»“æœæ­£ç¡®

#### 1.2 å‚æ•°ç»„åˆæµ‹è¯•

- [ ] **æŒ‰äººæ ¼è¿‡æ»¤**
  - [ ] `persona: 'abu'` - åªè¿”å›Abuçš„å»ºè®®
  - [ ] `persona: 'drdre'` - åªè¿”å›Dr.Dreçš„å»ºè®®
  - [ ] `persona: 'neptune'` - åªè¿”å›Neptuneçš„å»ºè®®

- [ ] **æŒ‰ä½œç”¨èŒƒå›´è¿‡æ»¤**
  - [ ] `scope: 'trip'` - è¿”å›è¡Œç¨‹çº§åˆ«å»ºè®®
  - [ ] `scope: 'day', scopeId: 'day-123'` - è¿”å›æŒ‡å®šå¤©çš„å»ºè®®
  - [ ] `scope: 'item', scopeId: 'item-456'` - è¿”å›æŒ‡å®šè¡Œç¨‹é¡¹çš„å»ºè®®

- [ ] **æŒ‰ä¸¥é‡çº§åˆ«è¿‡æ»¤**
  - [ ] `severity: 'blocker'` - åªè¿”å›é˜»å¡çº§åˆ«å»ºè®®
  - [ ] `severity: 'warn'` - åªè¿”å›è­¦å‘Šçº§åˆ«å»ºè®®
  - [ ] `severity: 'info'` - åªè¿”å›ä¿¡æ¯çº§åˆ«å»ºè®®

- [ ] **æŒ‰çŠ¶æ€è¿‡æ»¤**
  - [ ] `status: 'new'` - åªè¿”å›æ–°å»ºè®®
  - [ ] `status: 'seen'` - åªè¿”å›å·²æŸ¥çœ‹å»ºè®®
  - [ ] `status: 'applied'` - åªè¿”å›å·²åº”ç”¨å»ºè®®
  - [ ] `status: 'dismissed'` - åªè¿”å›å·²å¿½ç•¥å»ºè®®

- [ ] **åˆ†é¡µå‚æ•°**
  - [ ] `limit: 10` - é™åˆ¶è¿”å›10æ¡
  - [ ] `offset: 20` - è·³è¿‡å‰20æ¡
  - [ ] `limit: 20, offset: 0` - åˆ†é¡µç»„åˆ

---

### 2. GET /trips/:id/suggestions/stats - è·å–å»ºè®®ç»Ÿè®¡

- [ ] **åŸºç¡€è°ƒç”¨**
  ```typescript
  const stats = await tripsApi.getSuggestionStats(tripId);
  ```
  - [ ] æ¥å£è°ƒç”¨æˆåŠŸ
  - [ ] è¿”å› `SuggestionStats` æ ¼å¼
  - [ ] `tripId` æ­£ç¡®
  - [ ] `byPersona` åŒ…å« abu, drdre, neptune
  - [ ] `byPersona[persona].total` æ˜¯æ•°å­—
  - [ ] `byPersona[persona].bySeverity` åŒ…å« blocker, warn, info
  - [ ] `byScope.trip` æ˜¯æ•°å­—
  - [ ] `byScope.day` æ˜¯å¯¹è±¡
  - [ ] `byScope.item` æ˜¯å¯¹è±¡

- [ ] **ç»Ÿè®¡å‡†ç¡®æ€§éªŒè¯**
  - [ ] ç»Ÿè®¡æ•°å­—ä¸å»ºè®®åˆ—è¡¨æ•°é‡ä¸€è‡´
  - [ ] åªæœ‰ `new` å’Œ `seen` çŠ¶æ€çš„å»ºè®®è¢«ç»Ÿè®¡
  - [ ] `applied` å’Œ `dismissed` çŠ¶æ€çš„å»ºè®®ä¸è¢«ç»Ÿè®¡

---

### 3. POST /trips/:id/suggestions/:suggestionId/apply - åº”ç”¨å»ºè®®

#### 3.1 è¯·æ±‚æ ¼å¼éªŒè¯

- [ ] **è¯·æ±‚ä½“æ ¼å¼æ­£ç¡®**
  ```typescript
  await tripsApi.applySuggestion(tripId, suggestionId, {
    actionId: 'apply_alternative',
    params: { alternativeId: 'alt-001' },
    preview: false,
  });
  ```
  - [ ] è¯·æ±‚ä½“ä¸åŒ…å« `suggestionId`ï¼ˆåœ¨URLè·¯å¾„ä¸­ï¼‰
  - [ ] è¯·æ±‚ä½“åŒ…å« `actionId`
  - [ ] è¯·æ±‚ä½“å¯ä»¥åŒ…å« `params`
  - [ ] è¯·æ±‚ä½“å¯ä»¥åŒ…å« `preview`

#### 3.2 é¢„è§ˆæ¨¡å¼æµ‹è¯•

- [ ] **é¢„è§ˆæ¨¡å¼ï¼ˆpreview: trueï¼‰**
  ```typescript
  const result = await tripsApi.applySuggestion(tripId, suggestionId, {
    actionId: 'apply_alternative',
    preview: true,
  });
  ```
  - [ ] æ¥å£è°ƒç”¨æˆåŠŸ
  - [ ] è¿”å›é¢„è§ˆç»“æœ
  - [ ] è¡Œç¨‹æ•°æ®æœªå®é™…ä¿®æ”¹
  - [ ] `impact` å­—æ®µå­˜åœ¨

#### 3.3 å®é™…åº”ç”¨æµ‹è¯•

- [ ] **å®é™…åº”ç”¨ï¼ˆpreview: falseï¼‰**
  ```typescript
  const result = await tripsApi.applySuggestion(tripId, suggestionId, {
    actionId: 'apply_alternative',
    params: { alternativeId: 'alt-001' },
    preview: false,
  });
  ```
  - [ ] æ¥å£è°ƒç”¨æˆåŠŸ
  - [ ] è¿”å›åº”ç”¨ç»“æœ
  - [ ] è¡Œç¨‹æ•°æ®å·²å®é™…ä¿®æ”¹
  - [ ] `appliedChanges` åŒ…å«å˜æ›´æè¿°
  - [ ] `impact` å­—æ®µå­˜åœ¨
  - [ ] `triggeredSuggestions` å¯èƒ½åŒ…å«æ–°è§¦å‘çš„å»ºè®®ID

#### 3.4 ä¸åŒæ“ä½œç±»å‹æµ‹è¯•

- [ ] **åº”ç”¨æ›¿ä»£æ–¹æ¡ˆ**
  ```typescript
  await tripsApi.applySuggestion(tripId, suggestionId, {
    actionId: 'apply_alternative',
    params: { alternativeId: 'alt-001' },
  });
  ```

- [ ] **è°ƒæ•´èŠ‚å¥**
  ```typescript
  await tripsApi.applySuggestion(tripId, suggestionId, {
    actionId: 'adjust_rhythm',
    params: { duration: 30 },
  });
  ```

- [ ] **æ·»åŠ ç¼“å†²æ—¶é—´**
  ```typescript
  await tripsApi.applySuggestion(tripId, suggestionId, {
    actionId: 'add_buffer',
    params: { bufferDuration: 30 },
  });
  ```

---

### 4. POST /trips/:id/suggestions/:suggestionId/dismiss - å¿½ç•¥å»ºè®®

- [ ] **åŸºç¡€è°ƒç”¨**
  ```typescript
  await tripsApi.dismissSuggestion(tripId, suggestionId);
  ```
  - [ ] æ¥å£è°ƒç”¨æˆåŠŸ
  - [ ] å»ºè®®çŠ¶æ€æ›´æ–°ä¸º `dismissed`
  - [ ] å»ºè®®ä»ç»Ÿè®¡ä¸­ç§»é™¤ï¼ˆé‡æ–°è·å–ç»Ÿè®¡ï¼‰

- [ ] **é”™è¯¯å¤„ç†**
  - [ ] æ— æ•ˆçš„ `tripId` - è¿”å›404é”™è¯¯
  - [ ] æ— æ•ˆçš„ `suggestionId` - è¿”å›404é”™è¯¯
  - [ ] é”™è¯¯ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º

---

## ğŸ”„ é›†æˆæµç¨‹æµ‹è¯•

### 5. å®Œæ•´æµç¨‹æµ‹è¯•

- [ ] **æµç¨‹1: æŸ¥çœ‹å»ºè®® â†’ åº”ç”¨å»ºè®® â†’ éªŒè¯ç»“æœ**
  1. [ ] è·å–å»ºè®®åˆ—è¡¨
  2. [ ] é€‰æ‹©ä¸€æ¡å»ºè®®
  3. [ ] é¢„è§ˆåº”ç”¨ç»“æœ
  4. [ ] ç¡®è®¤åº”ç”¨å»ºè®®
  5. [ ] éªŒè¯è¡Œç¨‹æ•°æ®å·²æ›´æ–°
  6. [ ] éªŒè¯å»ºè®®çŠ¶æ€æ›´æ–°ä¸º `applied`
  7. [ ] é‡æ–°è·å–ç»Ÿè®¡ï¼ŒéªŒè¯æ•°é‡å‡å°‘

- [ ] **æµç¨‹2: æŸ¥çœ‹å»ºè®® â†’ å¿½ç•¥å»ºè®® â†’ éªŒè¯ç»“æœ**
  1. [ ] è·å–å»ºè®®åˆ—è¡¨
  2. [ ] é€‰æ‹©ä¸€æ¡å»ºè®®
  3. [ ] å¿½ç•¥å»ºè®®
  4. [ ] éªŒè¯å»ºè®®çŠ¶æ€æ›´æ–°ä¸º `dismissed`
  5. [ ] é‡æ–°è·å–ç»Ÿè®¡ï¼ŒéªŒè¯æ•°é‡å‡å°‘

- [ ] **æµç¨‹3: åº”ç”¨å»ºè®® â†’ è§¦å‘æ–°å»ºè®® â†’ æŸ¥çœ‹æ–°å»ºè®®**
  1. [ ] åº”ç”¨ä¸€æ¡å»ºè®®
  2. [ ] æ£€æŸ¥å“åº”ä¸­çš„ `triggeredSuggestions`
  3. [ ] å¦‚æœæœ‰æ–°å»ºè®®ï¼Œè·å–å»ºè®®åˆ—è¡¨éªŒè¯

---

## ğŸ§ª å‰ç«¯ç»„ä»¶é›†æˆæµ‹è¯•

### 6. è¡Œç¨‹è¯¦æƒ…é¡µé›†æˆ

- [ ] **åŠ è½½å»ºè®®æ•°æ®**
  - [ ] é¡µé¢åŠ è½½æ—¶è°ƒç”¨ `getSuggestions`
  - [ ] æ•°æ®æ­£ç¡®æ˜¾ç¤ºåœ¨ `AssistantCenter` ç»„ä»¶ä¸­
  - [ ] ç»Ÿè®¡æ•°æ®æ­£ç¡®æ˜¾ç¤ºåœ¨è§’æ ‡ä¸Š

- [ ] **åº”ç”¨å»ºè®®äº¤äº’**
  - [ ] ç‚¹å‡»"åº”ç”¨"æŒ‰é’®
  - [ ] è°ƒç”¨ `applySuggestion` æ¥å£
  - [ ] æ˜¾ç¤ºåº”ç”¨ç»“æœ
  - [ ] åˆ·æ–°å»ºè®®åˆ—è¡¨

- [ ] **å¿½ç•¥å»ºè®®äº¤äº’**
  - [ ] ç‚¹å‡»"å¿½ç•¥"æŒ‰é’®
  - [ ] è°ƒç”¨ `dismissSuggestion` æ¥å£
  - [ ] å»ºè®®ä»åˆ—è¡¨ä¸­ç§»é™¤
  - [ ] åˆ·æ–°ç»Ÿè®¡

---

## ğŸ› é”™è¯¯å¤„ç†æµ‹è¯•

### 7. é”™è¯¯åœºæ™¯æµ‹è¯•

- [ ] **ç½‘ç»œé”™è¯¯**
  - [ ] æ¥å£è°ƒç”¨å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
  - [ ] ä¸å½±å“å…¶ä»–åŠŸèƒ½

- [ ] **404é”™è¯¯ï¼ˆèµ„æºä¸å­˜åœ¨ï¼‰**
  - [ ] æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
  - [ ] ä¸å´©æºƒ

- [ ] **400é”™è¯¯ï¼ˆå‚æ•°é”™è¯¯ï¼‰**
  - [ ] æ˜¾ç¤ºå…·ä½“çš„éªŒè¯é”™è¯¯
  - [ ] æŒ‡å¯¼ç”¨æˆ·ä¿®æ­£

- [ ] **500é”™è¯¯ï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰**
  - [ ] æ˜¾ç¤ºé€šç”¨é”™è¯¯ä¿¡æ¯
  - [ ] æç¤ºç¨åé‡è¯•

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### 8. æ€§èƒ½éªŒè¯

- [ ] **æ¥å£å“åº”æ—¶é—´**
  - [ ] `getSuggestions` < 500ms
  - [ ] `getSuggestionStats` < 300ms
  - [ ] `applySuggestion` < 1000ms
  - [ ] `dismissSuggestion` < 300ms

- [ ] **å¤§æ•°æ®é‡æµ‹è¯•**
  - [ ] å»ºè®®æ•°é‡ > 100 æ—¶çš„æ€§èƒ½
  - [ ] ä½¿ç”¨åˆ†é¡µå‚æ•°ä¼˜åŒ–

- [ ] **å¹¶å‘æµ‹è¯•**
  - [ ] å¤šä¸ªæ¥å£åŒæ—¶è°ƒç”¨
  - [ ] æ•°æ®ä¸€è‡´æ€§

---

## âœ… æµ‹è¯•ç»“æœ

### æµ‹è¯•é€šè¿‡æƒ…å†µ

| æµ‹è¯•é¡¹ | çŠ¶æ€ | å¤‡æ³¨ |
|--------|------|------|
| GET /suggestions (åŸºç¡€) | â¬œ é€šè¿‡ / â¬œ å¤±è´¥ | |
| GET /suggestions (è¿‡æ»¤) | â¬œ é€šè¿‡ / â¬œ å¤±è´¥ | |
| GET /suggestions/stats | â¬œ é€šè¿‡ / â¬œ å¤±è´¥ | |
| POST /suggestions/:id/apply | â¬œ é€šè¿‡ / â¬œ å¤±è´¥ | |
| POST /suggestions/:id/dismiss | â¬œ é€šè¿‡ / â¬œ å¤±è´¥ | |
| å®Œæ•´æµç¨‹æµ‹è¯• | â¬œ é€šè¿‡ / â¬œ å¤±è´¥ | |
| é”™è¯¯å¤„ç†æµ‹è¯• | â¬œ é€šè¿‡ / â¬œ å¤±è´¥ | |
| æ€§èƒ½æµ‹è¯• | â¬œ é€šè¿‡ / â¬œ å¤±è´¥ | |

### å‘ç°çš„é—®é¢˜

1. 
2. 
3. 

### ä¿®å¤å»ºè®®

1. 
2. 
3. 

---

## ğŸ“ æµ‹è¯•è„šæœ¬

### æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•è„šæœ¬

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹ä»£ç è¿›è¡Œå¿«é€Ÿæµ‹è¯•

const tripId = 'YOUR_TRIP_ID'; // æ›¿æ¢ä¸ºå®é™…çš„è¡Œç¨‹ID

// 1. æµ‹è¯•è·å–å»ºè®®åˆ—è¡¨
async function testGetSuggestions() {
  try {
    const result = await tripsApi.getSuggestions(tripId);
    console.log('âœ… è·å–å»ºè®®åˆ—è¡¨æˆåŠŸ:', result);
    console.log('å»ºè®®æ•°é‡:', result.total);
    console.log('å»ºè®®åˆ—è¡¨:', result.items);
  } catch (error) {
    console.error('âŒ è·å–å»ºè®®åˆ—è¡¨å¤±è´¥:', error);
  }
}

// 2. æµ‹è¯•è·å–å»ºè®®ç»Ÿè®¡
async function testGetSuggestionStats() {
  try {
    const stats = await tripsApi.getSuggestionStats(tripId);
    console.log('âœ… è·å–å»ºè®®ç»Ÿè®¡æˆåŠŸ:', stats);
    console.log('Abuå»ºè®®æ•°:', stats.byPersona.abu.total);
    console.log('Dr.Dreå»ºè®®æ•°:', stats.byPersona.drdre.total);
    console.log('Neptuneå»ºè®®æ•°:', stats.byPersona.neptune.total);
  } catch (error) {
    console.error('âŒ è·å–å»ºè®®ç»Ÿè®¡å¤±è´¥:', error);
  }
}

// 3. æµ‹è¯•åº”ç”¨å»ºè®®ï¼ˆé¢„è§ˆæ¨¡å¼ï¼‰
async function testApplySuggestionPreview(suggestionId, actionId) {
  try {
    const result = await tripsApi.applySuggestion(tripId, suggestionId, {
      actionId: actionId,
      preview: true,
    });
    console.log('âœ… é¢„è§ˆåº”ç”¨å»ºè®®æˆåŠŸ:', result);
    console.log('å˜æ›´æè¿°:', result.appliedChanges);
    console.log('å½±å“åˆ†æ:', result.impact);
  } catch (error) {
    console.error('âŒ é¢„è§ˆåº”ç”¨å»ºè®®å¤±è´¥:', error);
  }
}

// 4. æµ‹è¯•å¿½ç•¥å»ºè®®
async function testDismissSuggestion(suggestionId) {
  try {
    await tripsApi.dismissSuggestion(tripId, suggestionId);
    console.log('âœ… å¿½ç•¥å»ºè®®æˆåŠŸ');
  } catch (error) {
    console.error('âŒ å¿½ç•¥å»ºè®®å¤±è´¥:', error);
  }
}

// è¿è¡Œæµ‹è¯•
// testGetSuggestions();
// testGetSuggestionStats();
// testApplySuggestionPreview('suggestion-id', 'action-id');
// testDismissSuggestion('suggestion-id');
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **APIæ–‡æ¡£**: `åç«¯æ¥å£-å»ºè®®ç³»ç»ŸAPIæ–‡æ¡£.md`
- **å¯¹æ¥æŠ¥å‘Š**: `å»ºè®®ç³»ç»ŸAPIå¯¹æ¥å®ŒæˆæŠ¥å‘Š.md`
- **ç±»å‹å®šä¹‰**: `src/types/suggestion.ts`
- **APIå®ç°**: `src/api/trips.ts`

---

**æµ‹è¯•å®Œæˆæ—¶é—´**: ___________
**æµ‹è¯•äººå‘˜ç­¾å**: ___________

