# 证据与关注队列 - 前端对接完成清单

## ✅ 已完成的工作

### 1. 类型定义 (`src/types/trip.ts`)

- ✅ `EvidenceType` - 证据类型枚举
- ✅ `EvidenceSeverity` - 证据严重程度
- ✅ `EvidenceItem` - 证据项接口
- ✅ `EvidenceListResponse` - 证据列表响应
- ✅ `AttentionItemType` - 关注项类型
- ✅ `AttentionSeverity` - 关注项严重程度
- ✅ `AttentionStatus` - 关注项状态
- ✅ `AttentionItem` - 关注项接口
- ✅ `AttentionQueueResponse` - 关注队列响应

### 2. API 接口 (`src/api/trips.ts`)

- ✅ `getEvidence()` - GET `/trips/:id/evidence`
  - 支持查询参数：`limit`, `offset`, `day`, `type`
- ✅ `getAttentionQueue()` - GET `/trips/attention-queue`
  - 支持查询参数：`limit`, `offset`, `severity`, `type`, `tripId`

### 3. EvidenceDrawer 组件更新 (`src/components/layout/EvidenceDrawer.tsx`)

- ✅ 移除硬编码的证据数据
- ✅ 集成真实 API (`tripsApi.getEvidence`)
- ✅ 添加加载状态显示
- ✅ 添加空状态显示
- ✅ 显示证据严重程度标签
- ✅ 显示关联天数
- ✅ 格式化时间戳显示
- ✅ 支持外部链接跳转

### 4. Dashboard 页面更新 (`src/pages/Dashboard.tsx`)

- ✅ 移除硬编码的关注队列数据
- ✅ 集成真实 API (`tripsApi.getAttentionQueue`)
- ✅ 添加加载状态显示
- ✅ 添加空状态显示
- ✅ 显示严重程度标签和图标
- ✅ 显示状态标签（新/已确认/已解决）
- ✅ 显示 Persona 信息（ABU/DR_DRE/NEPTUNE）
- ✅ 支持点击跳转到相关行程
- ✅ 支持通过 `actionUrl` 跳转

---

## 📋 接口对接状态

| 接口 | 方法 | 路径 | 前端状态 | 后端状态 |
|------|------|------|---------|---------|
| 获取证据列表 | GET | `/trips/:id/evidence` | ✅ 已对接 | ⏳ 待实现 |
| 获取关注队列 | GET | `/trips/attention-queue` | ✅ 已对接 | ⏳ 待实现 |

---

## 🎯 功能流程

### 流程 1: 查看行程证据

1. 用户在行程详情页打开 EvidenceDrawer
2. 切换到"证据"标签页
3. 组件自动调用 `GET /trips/:id/evidence`
4. 显示证据列表（按时间倒序）
5. 用户可以：
   - 查看证据详情（标题、描述、来源）
   - 查看严重程度标签
   - 查看关联天数
   - 点击外部链接查看详情

### 流程 2: 查看关注队列

1. 用户在 Dashboard 页面
2. 页面加载时自动调用 `GET /trips/attention-queue`
3. 显示关注队列列表（按严重程度和创建时间排序）
4. 用户可以：
   - 查看关注项详情（标题、描述、Persona）
   - 查看严重程度和状态
   - 点击"Fix"按钮跳转到相关行程
   - 通过 `actionUrl` 直接跳转到特定页面

---

## 🔧 错误处理

前端已实现错误处理：

```typescript
try {
  const response = await tripsApi.getEvidence(tripId, { limit: 50 });
  setEvidenceItems(response.items || []);
} catch (err: any) {
  console.error('Failed to load evidence:', err);
  setEvidenceItems([]); // 显示空状态
}
```

---

## 📝 注意事项

### 1. 证据列表

- 默认加载 50 条证据
- 支持按天数和类型过滤（通过查询参数）
- 时间戳格式化为本地时间显示
- 支持外部链接跳转

### 2. 关注队列

- 默认加载 20 条关注项
- 支持按严重程度和类型过滤
- 支持按行程ID过滤（查看特定行程的关注项）
- 严重程度颜色映射：
  - `critical` → 红色
  - `high` → 橙色
  - `medium` → 黄色
  - `low` → 蓝色

### 3. Persona 映射

- `ABU` → "安全官 (Abu)"
- `DR_DRE` → "节奏官 (Dr.Dre)"
- `NEPTUNE` → "修复官 (Neptune)"

### 4. 状态显示

- `new` → 显示"新"标签（蓝色背景）
- `acknowledged` → 不显示特殊标签
- `resolved` → 不显示特殊标签

---

## 🚀 下一步

1. **后端实现**：实现 2 个 API 接口
2. **测试**：端到端测试完整流程
3. **优化**：根据实际使用情况优化 UI/UX
4. **扩展**：支持更多过滤条件和排序选项

---

## 📚 相关文档

- `待新增接口规范.md` - 详细接口规范（包含证据与关注队列）

---

## ✅ 检查清单

- [x] 类型定义完整
- [x] API 方法实现
- [x] EvidenceDrawer 组件更新
- [x] Dashboard 页面更新
- [x] 错误处理完善
- [x] 加载状态显示
- [x] 空状态显示
- [ ] 后端接口实现（待后端）
- [ ] 端到端测试（待后端）

---

**状态**: 前端代码已完成，等待后端实现接口即可使用。

