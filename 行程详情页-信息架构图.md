# è¡Œç¨‹è¯¦æƒ…é¡µ - ä¿¡æ¯æ¶æ„å›¾

**ç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**æ–‡ä»¶**: `src/pages/trips/[id].tsx`

---

## ğŸ“‹ ç›®å½•

1. [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
2. [é¡µé¢ç»“æ„](#é¡µé¢ç»“æ„)
3. [æ•°æ®æµæ¶æ„](#æ•°æ®æµæ¶æ„)
4. [ç»„ä»¶å±‚çº§ç»“æ„](#ç»„ä»¶å±‚çº§ç»“æ„)
5. [è§†å›¾åˆ‡æ¢æ¶æ„](#è§†å›¾åˆ‡æ¢æ¶æ„)
6. [æ¥å£è°ƒç”¨æ¶æ„](#æ¥å£è°ƒç”¨æ¶æ„)

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è¡Œç¨‹è¯¦æƒ…é¡µ (TripDetailPage)                    â”‚
â”‚                        src/pages/trips/[id].tsx                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  é¡¶éƒ¨åŒºåŸŸ â”‚        â”‚   ä¸»å†…å®¹åŒº    â”‚      â”‚  å³ä¾§åŠ©æ‰‹åŒº  â”‚
  â”‚ (Header) â”‚        â”‚ (Main Area)  â”‚      â”‚ (Assistant) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“„ é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è¡Œç¨‹è¯¦æƒ…é¡µå¸ƒå±€                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é¡¶éƒ¨æ“ä½œæ  (Top Bar)                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ è¿”å›æŒ‰é’®                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ è¡Œç¨‹ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æ—¥æœŸã€ç±»å‹ï¼‰                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ å¥åº·åº¦æŒ‡æ ‡ (HealthBar)                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ è§†å›¾åˆ‡æ¢ (PersonaModeToggle: Auto/Abu/Dr.Dre/Neptune)        â”‚  â”‚
â”‚  â”‚  â””â”€ æ“ä½œæŒ‰é’®ï¼ˆç¼–è¾‘ã€åˆ†äº«ã€åˆ é™¤ç­‰ï¼‰                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å»ºè®®æç¤ºæ  (SuggestionGuardBar)                                  â”‚  â”‚
â”‚  â”‚  "å‘ç° X æ¡å»ºè®®ï¼Œå·²æ±‡æ€»åœ¨å³ä¾§åŠ©æ‰‹ä¸­å¿ƒ"                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                          â”‚                                       â”‚  â”‚
â”‚  â”‚   ä¸»å†…å®¹åŒºåŸŸ              â”‚        å³ä¾§åŠ©æ‰‹åŒºåŸŸ                   â”‚  â”‚
â”‚  â”‚   (Main Content)         â”‚        (Assistant Center)            â”‚  â”‚
â”‚  â”‚                          â”‚                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ æ ‡ç­¾é¡µå¯¼èˆª          â”‚  â”‚  â”‚  åŠ©æ‰‹ä¸­å¿ƒ (AssistantCenter)    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ (Tabs)             â”‚  â”‚  â”‚  â”œâ”€ å»ºè®®åˆ—è¡¨                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€ æ€»è§ˆ            â”‚  â”‚  â”‚  â”œâ”€ æŒ‰äººæ ¼åˆ†ç±»                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€ è§„åˆ’            â”‚  â”‚  â”‚  â””â”€ æ“ä½œæŒ‰é’®                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€ æ‰§è¡Œ            â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€ å¤ç›˜            â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚  å…³é”®è¯æ® (Evidence Quick Peek) â”‚ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”œâ”€ å‰3æ¡è¯æ®                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ æ ‡ç­¾é¡µå†…å®¹          â”‚  â”‚  â”‚  â””â”€ "æŸ¥çœ‹å…¨éƒ¨"é“¾æ¥              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ (TabsContent)      â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  æ ¹æ® viewMode     â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  æ˜¾ç¤ºä¸åŒè§†å›¾ï¼š     â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ AutoView        â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚    (ç»¼åˆè§†å›¾)       â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ AbuView         â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚    (å®‰å…¨è§†å›¾)       â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ DrDreView       â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚    (èŠ‚å¥è§†å›¾)       â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ NeptuneView     â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚    (ä¿®å¤è§†å›¾)       â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                       â”‚  â”‚
â”‚  â”‚                          â”‚                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è·¯çº¿éª¨æ¶å›¾ (Route Skeleton Map)                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Day 1 ~ Day N åˆ—è¡¨                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ æ¯æ—¥è¡Œç¨‹é¡¹ç»Ÿè®¡                                                â”‚  â”‚
â”‚  â”‚  â””â”€ æ¯æ—¥æŒ‡æ ‡ï¼ˆæ­¥è¡Œã€è½¦ç¨‹ã€ç¼“å†²ã€é£é™©ï¼‰                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®åŠ è½½æµç¨‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¡µé¢åˆå§‹åŒ– (useEffect)
    â”‚
    â–¼
loadTrip() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                â”‚
    â”œâ”€ GET /trips/:id                                â”‚
    â”‚   â””â”€ trip (TripDetail)                        â”‚
    â”‚       â”œâ”€ åŸºæœ¬ä¿¡æ¯                              â”‚
    â”‚       â”œâ”€ statistics                           â”‚
    â”‚       â””â”€ TripDay[]                            â”‚
    â”‚                                                â”‚
    â”œâ”€ loadCountryInfo()                            â”‚
    â”‚   â””â”€ GET /countries                           â”‚
    â”‚                                                â”‚
    â”œâ”€ loadTripState()                              â”‚
    â”‚   â””â”€ GET /trips/:id/state                     â”‚
    â”‚                                                â”‚
    â”œâ”€ checkCollectionStatus()                      â”‚
    â”‚   â””â”€ GET /trips/collected                     â”‚
    â”‚                                                â”‚
    â”œâ”€ Promise.all([                                â”‚
    â”‚     loadEvidence(),        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚     loadSuggestions(),     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
    â”‚     loadConflicts(),       â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚    â”‚
    â”‚   ])                              â”‚   â”‚   â”‚    â”‚
    â”‚                                   â”‚   â”‚   â”‚    â”‚
    â””â”€ setTimeout(() =>                 â”‚   â”‚   â”‚    â”‚
        loadTripMetrics(), 0)           â”‚   â”‚   â”‚    â”‚
                                        â”‚   â”‚   â”‚    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚    â”‚
    â”‚                                       â”‚   â”‚    â”‚
    â–¼                                       â–¼   â–¼    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Evidence    â”‚  â”‚ Suggestions  â”‚  â”‚  Conflicts   â”‚
â”‚  List        â”‚  â”‚ & Stats      â”‚  â”‚  List        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Trip Metrics â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  å¥åº·åº¦æŒ‡æ ‡è®¡ç®—        â”‚
            â”‚  (healthMetrics)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ç»„ä»¶å±‚çº§ç»“æ„

```
TripDetailPage (src/pages/trips/[id].tsx)
â”‚
â”œâ”€ çŠ¶æ€ç®¡ç†
â”‚  â”œâ”€ trip: TripDetail
â”‚  â”œâ”€ viewMode: PersonaMode ('auto' | 'abu' | 'drdre' | 'neptune')
â”‚  â”œâ”€ suggestions: Suggestion[]
â”‚  â”œâ”€ suggestionStats: SuggestionStats
â”‚  â”œâ”€ tripMetrics: TripMetricsResponse
â”‚  â”œâ”€ conflicts: ConflictsResponse
â”‚  â”œâ”€ evidence: EvidenceListResponse
â”‚  â””â”€ ... (å…¶ä»–çŠ¶æ€)
â”‚
â”œâ”€ é¡¶éƒ¨åŒºåŸŸ
â”‚  â”œâ”€ è¿”å›æŒ‰é’® + è¡Œç¨‹æ ‡é¢˜
â”‚  â”œâ”€ HealthBar (å¥åº·åº¦æŒ‡æ ‡)
â”‚  â”œâ”€ PersonaModeToggle (è§†å›¾åˆ‡æ¢)
â”‚  â””â”€ æ“ä½œæŒ‰é’® (ç¼–è¾‘ã€åˆ†äº«ã€åˆ é™¤ç­‰)
â”‚
â”œâ”€ SuggestionGuardBar (å»ºè®®æç¤ºæ )
â”‚
â”œâ”€ ä¸»å†…å®¹åŒºåŸŸ (Grid Layout)
â”‚  â”‚
â”‚  â”œâ”€ å·¦ä¾§ (col-span-8)
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Tabs (æ ‡ç­¾é¡µå¯¼èˆª)
â”‚  â”‚  â”‚  â”œâ”€ "æ€»è§ˆ" (Overview)
â”‚  â”‚  â”‚  â”œâ”€ "è§„åˆ’" (Planning) â† å½“å‰è§†å›¾
â”‚  â”‚  â”‚  â”œâ”€ "æ‰§è¡Œ" (Execution)
â”‚  â”‚  â”‚  â””â”€ "å¤ç›˜" (Review)
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ TabsContent
â”‚  â”‚     â”‚
â”‚  â”‚     â””â”€ æ ¹æ® viewMode æ¡ä»¶æ¸²æŸ“ï¼š
â”‚  â”‚        â”‚
â”‚  â”‚        â”œâ”€ viewMode === 'auto'
â”‚  â”‚        â”‚  â””â”€ AutoView
â”‚  â”‚        â”‚     â”œâ”€ ç»¼åˆæ¦‚è§ˆå¡ç‰‡
â”‚  â”‚        â”‚     â”‚  â”œâ”€ å®‰å…¨è§†è§’ (75åˆ†, 2ä¸ªå…³é”®é—®é¢˜)
â”‚  â”‚        â”‚     â”‚  â”œâ”€ èŠ‚å¥è§†è§’ (80åˆ†, 3ä¸ªè­¦å‘Š)
â”‚  â”‚        â”‚     â”‚  â””â”€ ä¿®å¤è§†è§’ (85åˆ†, 5ä¸ªå»ºè®®)
â”‚  â”‚        â”‚     â”‚
â”‚  â”‚        â”‚     â””â”€ Tabs (å†…éƒ¨æ ‡ç­¾é¡µ)
â”‚  â”‚        â”‚        â”œâ”€ "æ¦‚è§ˆ"
â”‚  â”‚        â”‚        â”‚  â”œâ”€ å…³é”®é—®é¢˜å¡ç‰‡
â”‚  â”‚        â”‚        â”‚  â”œâ”€ å…³é”®æŒ‡æ ‡å¡ç‰‡
â”‚  â”‚        â”‚        â”‚  â””â”€ å¿«é€Ÿæ“ä½œå¡ç‰‡
â”‚  â”‚        â”‚        â”‚
â”‚  â”‚        â”‚        â”œâ”€ "å®‰å…¨" â†’ AbuView
â”‚  â”‚        â”‚        â”œâ”€ "èŠ‚å¥" â†’ DrDreView
â”‚  â”‚        â”‚        â””â”€ "ä¿®å¤" â†’ NeptuneView
â”‚  â”‚        â”‚
â”‚  â”‚        â”œâ”€ viewMode === 'abu'
â”‚  â”‚        â”‚  â””â”€ AbuView
â”‚  â”‚        â”‚     â”œâ”€ å®‰å…¨çŠ¶æ€æ¡
â”‚  â”‚        â”‚     â”œâ”€ è¿è§„åˆ—è¡¨
â”‚  â”‚        â”‚     â”œâ”€ è¡Œç¨‹é¡¹åˆ—è¡¨ (å¸¦é£é™©å¾½ç« )
â”‚  â”‚        â”‚     â””â”€ EvidenceSheet (é£é™©è¯¦æƒ…æŠ½å±‰)
â”‚  â”‚        â”‚
â”‚  â”‚        â”œâ”€ viewMode === 'drdre'
â”‚  â”‚        â”‚  â””â”€ DrDreView
â”‚  â”‚        â”‚     â”œâ”€ æŒ‡æ ‡å¡ç‰‡
â”‚  â”‚        â”‚     â”œâ”€ ä¼˜å…ˆçº§å’Œçº¦æŸè®¾ç½®
â”‚  â”‚        â”‚     â”œâ”€ è¡Œç¨‹é¡¹åˆ—è¡¨ (å¸¦æŒ‡æ ‡)
â”‚  â”‚        â”‚     â””â”€ å€™é€‰æ–¹æ¡ˆåˆ—è¡¨
â”‚  â”‚        â”‚
â”‚  â”‚        â””â”€ viewMode === 'neptune'
â”‚  â”‚           â””â”€ NeptuneView
â”‚  â”‚              â”œâ”€ ä¿®å¤å»ºè®®åˆ—è¡¨
â”‚  â”‚              â”œâ”€ è¡Œç¨‹é¡¹åˆ—è¡¨ (å¸¦ä¿®å¤æ ‡è®°)
â”‚  â”‚              â”œâ”€ AlternativesSheet (æ›¿ä»£æ–¹æ¡ˆæŠ½å±‰)
â”‚  â”‚              â””â”€ PatchSheet (ä¿®å¤è¯¦æƒ…æŠ½å±‰)
â”‚  â”‚
â”‚  â””â”€ å³ä¾§ (col-span-4)
â”‚     â”‚
â”‚     â”œâ”€ AssistantCenter (åŠ©æ‰‹ä¸­å¿ƒ)
â”‚     â”‚  â”œâ”€ Tabs (å…¨éƒ¨/é£é™©/èŠ‚å¥/ä¿®å¤)
â”‚     â”‚  â”œâ”€ SuggestionCard[] (å»ºè®®å¡ç‰‡åˆ—è¡¨)
â”‚     â”‚  â””â”€ æ“ä½œæŒ‰é’® (åº”ç”¨/å¿½ç•¥)
â”‚     â”‚
â”‚     â””â”€ Evidence Quick Peek (å…³é”®è¯æ®)
â”‚        â”œâ”€ å‰3æ¡è¯æ®
â”‚        â””â”€ "View All Evidence" æŒ‰é’®
â”‚
â”œâ”€ è·¯çº¿éª¨æ¶å›¾ (Route Skeleton Map)
â”‚  â””â”€ Day 1 ~ Day N åˆ—è¡¨
â”‚
â””â”€ å¼¹çª—ç»„ä»¶ (Dialog/Sheet)
   â”œâ”€ EditTripDialog
   â”œâ”€ ShareTripDialog
   â”œâ”€ CollaboratorsDialog
   â”œâ”€ CreateItineraryItemDialog
   â”œâ”€ EditItineraryItemDialog
   â”œâ”€ ReplaceItineraryItemDialog
   â”œâ”€ AlertDialog (åˆ é™¤ç¡®è®¤)
   â””â”€ Drawer (å…¨å±€æŠ½å±‰ï¼Œé€šè¿‡ useDrawer)
      â”œâ”€ evidence æ ‡ç­¾é¡µ
      â”œâ”€ risk æ ‡ç­¾é¡µ
      â””â”€ ...
```

---

## ğŸ”€ è§†å›¾åˆ‡æ¢æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è§†å›¾åˆ‡æ¢æµç¨‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æ“ä½œ
    â”‚
    â–¼
PersonaModeToggle (è§†å›¾åˆ‡æ¢ç»„ä»¶)
    â”‚
    â”œâ”€ ç‚¹å‡» "Auto ç»¼åˆ"
    â”‚  â””â”€ setViewMode('auto')
    â”‚
    â”œâ”€ ç‚¹å‡» "å®‰å…¨ (Abu)"
    â”‚  â””â”€ setViewMode('abu')
    â”‚
    â”œâ”€ ç‚¹å‡» "èŠ‚å¥ (Dr.Dre)"
    â”‚  â””â”€ setViewMode('drdre')
    â”‚
    â””â”€ ç‚¹å‡» "ä¿®å¤ (Neptune)"
       â””â”€ setViewMode('neptune')
              â”‚
              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  viewMode çŠ¶æ€   â”‚
        â”‚  æ›´æ–°è§¦å‘é‡æ¸²æŸ“   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ¡ä»¶æ¸²æŸ“ (src/pages/trips/[id].tsx)     â”‚
        â”‚                                         â”‚
        â”‚  {viewMode === 'auto' && <AutoView />}  â”‚
        â”‚  {viewMode === 'abu' && <AbuView />}    â”‚
        â”‚  {viewMode === 'drdre' && <DrDreView />}â”‚
        â”‚  {viewMode === 'neptune' && <NeptuneView/>}â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚          â”‚           â”‚
        â–¼           â–¼          â–¼           â–¼
    AutoView    AbuView   DrDreView  NeptuneView
    (ç»¼åˆè§†å›¾)   (å®‰å…¨è§†å›¾)  (èŠ‚å¥è§†å›¾)  (ä¿®å¤è§†å›¾)
```

---

## ğŸŒ æ¥å£è°ƒç”¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¥å£è°ƒç”¨å…³ç³»å›¾                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TripDetailPage
    â”‚
    â”œâ”€ loadTrip()
    â”‚  â”‚
    â”‚  â”œâ”€ GET /trips/:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚                                â”‚
    â”‚  â”œâ”€ GET /countries                â”‚
    â”‚  â”œâ”€ GET /trips/:id/state          â”‚
    â”‚  â”œâ”€ GET /trips/collected          â”‚
    â”‚  â”‚                                â”‚
    â”‚  â””â”€ Promise.all([                 â”‚
    â”‚       GET /trips/:id/evidence â”€â”€â”€â”€â”¤
    â”‚       GET /trips/:id/suggestions â”€â”¤
    â”‚       GET /trips/:id/suggestions/stats â”€â”¤
    â”‚       GET /trips/:id/conflicts â”€â”€â”€â”¤
    â”‚     ])                            â”‚
    â”‚                                   â”‚
    â””â”€ loadTripMetrics()                â”‚
       â””â”€ GET /trips/:id/metrics â”€â”€â”€â”€â”€â”€â”¤
                                        â”‚
                                        â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   æ•°æ®çŠ¶æ€ç®¡ç†             â”‚
                        â”‚  (useState hooks)         â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚                          â”‚
        â–¼                               â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HealthBar   â”‚              â”‚ AutoView     â”‚          â”‚ AssistantCenterâ”‚
â”‚  (è®¡ç®—å¥åº·åº¦) â”‚              â”‚ (ä½¿ç”¨ç¡¬ç¼–ç )  â”‚          â”‚ (ä½¿ç”¨suggestions)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                               â”‚                          â”‚
        â”‚                               â”‚                          â”‚
        â–¼                               â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ healthMetrics       â”‚      â”‚ overallMetrics       â”‚  â”‚ SuggestionCard[] â”‚
â”‚ (åŸºäº tripMetrics   â”‚      â”‚ (ç¡¬ç¼–ç æ•°æ®)          â”‚  â”‚                  â”‚
â”‚  + conflicts è®¡ç®—)   â”‚      â”‚                      â”‚  â”‚ æ“ä½œè§¦å‘ï¼š        â”‚
â”‚                      â”‚      â”‚ - safetyScore: 75    â”‚  â”‚ - applySuggestionâ”‚
â”‚ - executable: è®¡ç®—   â”‚      â”‚ - rhythmScore: 80    â”‚  â”‚ - dismissSuggestionâ”‚
â”‚ - buffer: è®¡ç®—       â”‚      â”‚ - readinessScore: 85 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - risk: è®¡ç®—         â”‚      â”‚ - criticalIssues: 2  â”‚
â”‚ - cost: è®¡ç®—         â”‚      â”‚ - warnings: 3        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ - suggestions: 5     â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚                       â”‚
                â–¼                       â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  AbuView     â”‚      â”‚ DrDreView    â”‚      â”‚ NeptuneView  â”‚
        â”‚ (ä½¿ç”¨ç¡¬ç¼–ç )  â”‚      â”‚ (ä½¿ç”¨ç¡¬ç¼–ç )  â”‚      â”‚ (ä½¿ç”¨ç¡¬ç¼–ç )  â”‚
        â”‚              â”‚      â”‚              â”‚      â”‚              â”‚
        â”‚ - gatingStatusâ”‚     â”‚ - metrics    â”‚      â”‚ - repairs    â”‚
        â”‚ - violations â”‚      â”‚ - metricsByItemâ”‚    â”‚ - alternativesâ”‚
        â”‚ - riskMap    â”‚      â”‚              â”‚      â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                       â”‚                       â”‚
                â”‚                       â”‚                       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                        âš ï¸ æœªå¯¹æ¥çš„æ¥å£ï¼š
                        â”œâ”€ GET /trips/:id/risk-assessment
                        â”œâ”€ GET /trips/:id/violations
                        â”œâ”€ GET /trips/:id/items/:itemId/risk
                        â”œâ”€ GET /trips/:id/repairs
                        â”œâ”€ GET /trips/:id/items/:itemId/alternatives
                        â”œâ”€ POST /trips/:id/repairs/:repairId/apply
                        â””â”€ GET /trips/:id/overall-metrics
```

---

## ğŸ“Š æ•°æ®çŠ¶æ€ç®¡ç†æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   çŠ¶æ€ç®¡ç†æ¶æ„                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TripDetailPage State
â”‚
â”œâ”€ æ ¸å¿ƒæ•°æ®çŠ¶æ€
â”‚  â”œâ”€ trip: TripDetail | null
â”‚  â”œâ”€ loading: boolean
â”‚  â”œâ”€ error: string | null
â”‚  â””â”€ viewMode: PersonaMode
â”‚
â”œâ”€ API æ•°æ®çŠ¶æ€
â”‚  â”œâ”€ evidence: EvidenceListResponse | null
â”‚  â”œâ”€ suggestions: Suggestion[]
â”‚  â”œâ”€ suggestionStats: SuggestionStats | null
â”‚  â”œâ”€ tripMetrics: TripMetricsResponse | null
â”‚  â”œâ”€ conflicts: ConflictsResponse | null
â”‚  â”œâ”€ tripState: TripState | null
â”‚  â””â”€ dayMetricsMap: Map<string, DayMetricsResponse>
â”‚
â”œâ”€ UI çŠ¶æ€
â”‚  â”œâ”€ editDialogOpen: boolean
â”‚  â”œâ”€ shareDialogOpen: boolean
â”‚  â”œâ”€ collaboratorsDialogOpen: boolean
â”‚  â”œâ”€ createItemDialogOpen: boolean
â”‚  â”œâ”€ editItemDialogOpen: boolean
â”‚  â”œâ”€ replaceDialogOpen: boolean
â”‚  â”œâ”€ deleteDialogOpen: boolean
â”‚  â”œâ”€ editingItem: ItineraryItem | null
â”‚  â”œâ”€ replacingItem: ItineraryItem | null
â”‚  â”œâ”€ selectedDayId: string | null
â”‚  â””â”€ actionLoading: string | null
â”‚
â””â”€ è®¡ç®—çŠ¶æ€ï¼ˆDerived Stateï¼‰
   â””â”€ healthMetrics
      â”œâ”€ executable: number (è®¡ç®—å¾—å‡º)
      â”œâ”€ buffer: number (è®¡ç®—å¾—å‡º)
      â”œâ”€ risk: number (è®¡ç®—å¾—å‡º)
      â””â”€ cost: number (è®¡ç®—å¾—å‡º)
```

---

## ğŸ¯ è§†å›¾ç»„ä»¶æ•°æ®ä¾èµ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               è§†å›¾ç»„ä»¶æ•°æ®ä¾èµ–å…³ç³»                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TripDetailPage
    â”‚
    â”‚ props: trip
    â”‚
    â”œâ”€ AutoView
    â”‚  â”‚
    â”‚  â”œâ”€ props: trip
    â”‚  â”‚
    â”‚  â”œâ”€ å†…éƒ¨çŠ¶æ€: activeTab
    â”‚  â”‚
    â”‚  â”œâ”€ ç¡¬ç¼–ç æ•°æ®:
    â”‚  â”‚  â”œâ”€ overallMetrics (safetyScore, rhythmScoreç­‰)
    â”‚  â”‚  â”œâ”€ å…³é”®é—®é¢˜åˆ—è¡¨
    â”‚  â”‚  â””â”€ å…³é”®æŒ‡æ ‡
    â”‚  â”‚
    â”‚  â””â”€ å­è§†å›¾:
    â”‚     â”œâ”€ AbuView (å½“åˆ‡æ¢åˆ°"å®‰å…¨"æ ‡ç­¾)
    â”‚     â”œâ”€ DrDreView (å½“åˆ‡æ¢åˆ°"èŠ‚å¥"æ ‡ç­¾)
    â”‚     â””â”€ NeptuneView (å½“åˆ‡æ¢åˆ°"ä¿®å¤"æ ‡ç­¾)
    â”‚
    â”œâ”€ AbuView
    â”‚  â”‚
    â”‚  â”œâ”€ props: trip, onItemClick
    â”‚  â”‚
    â”‚  â”œâ”€ å†…éƒ¨çŠ¶æ€:
    â”‚  â”‚  â”œâ”€ selectedItem
    â”‚  â”‚  â””â”€ evidenceSheetOpen
    â”‚  â”‚
    â”‚  â””â”€ ç¡¬ç¼–ç æ•°æ®:
    â”‚     â”œâ”€ gatingStatus
    â”‚     â”œâ”€ violations
    â”‚     â””â”€ riskMap
    â”‚
    â”œâ”€ DrDreView
    â”‚  â”‚
    â”‚  â”œâ”€ props: trip, onItemClick
    â”‚  â”‚
    â”‚  â”œâ”€ å†…éƒ¨çŠ¶æ€:
    â”‚  â”‚  â”œâ”€ priorities
    â”‚  â”‚  â”œâ”€ constraints
    â”‚  â”‚  â”œâ”€ lockedItems
    â”‚  â”‚  â”œâ”€ candidates
    â”‚  â”‚  â””â”€ showCandidates
    â”‚  â”‚
    â”‚  â””â”€ ç¡¬ç¼–ç æ•°æ®:
    â”‚     â”œâ”€ metrics
    â”‚     â””â”€ metricsByItem
    â”‚     âš ï¸ æ³¨æ„: tripMetrics å·²è·å–ä½†æœªä½¿ç”¨
    â”‚
    â””â”€ NeptuneView
       â”‚
       â”œâ”€ props: trip, onItemClick
       â”‚
       â”œâ”€ å†…éƒ¨çŠ¶æ€:
       â”‚  â”œâ”€ selectedItem
       â”‚  â”œâ”€ alternativesSheetOpen
       â”‚  â”œâ”€ selectedRepair
       â”‚  â””â”€ patchSheetOpen
       â”‚
       â””â”€ ç¡¬ç¼–ç æ•°æ®:
          â”œâ”€ repairs
          â””â”€ alternatives
```

---

## ğŸ“‹ å¼¹çª—æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¼¹çª—ç»„ä»¶æ¶æ„                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TripDetailPage
    â”‚
    â”œâ”€ å·²å¯¹æ¥å¼¹çª— (Dialog)
    â”‚  â”œâ”€ EditTripDialog
    â”‚  â”‚  â””â”€ æ•°æ®æº: trip (æ¥è‡ª API)
    â”‚  â”‚
    â”‚  â”œâ”€ ShareTripDialog
    â”‚  â”‚  â””â”€ æ•°æ®æº: API
    â”‚  â”‚
    â”‚  â”œâ”€ CollaboratorsDialog
    â”‚  â”‚  â””â”€ æ•°æ®æº: API
    â”‚  â”‚
    â”‚  â”œâ”€ CreateItineraryItemDialog
    â”‚  â”‚  â””â”€ æ•°æ®æº: API
    â”‚  â”‚
    â”‚  â”œâ”€ EditItineraryItemDialog
    â”‚  â”‚  â””â”€ æ•°æ®æº: editingItem (æ¥è‡ª trip)
    â”‚  â”‚
    â”‚  â”œâ”€ ReplaceItineraryItemDialog
    â”‚  â”‚  â””â”€ æ•°æ®æº: API
    â”‚  â”‚
    â”‚  â””â”€ AlertDialog (åˆ é™¤ç¡®è®¤)
    â”‚     â””â”€ æ— æ•°æ®å±•ç¤ºï¼Œä»…ç¡®è®¤æ“ä½œ
    â”‚
    â””â”€ ç¡¬ç¼–ç å¼¹çª— (Sheetï¼Œåœ¨è§†å›¾ç»„ä»¶å†…)
       â”‚
       â”œâ”€ AbuView
       â”‚  â””â”€ EvidenceSheet (é£é™©è¯¦æƒ…æŠ½å±‰)
       â”‚     â”œâ”€ æ•°æ®æº: riskMap (ç¡¬ç¼–ç )
       â”‚     â””â”€ æ•°æ®æº: violations (ç¡¬ç¼–ç )
       â”‚
       â”œâ”€ NeptuneView
       â”‚  â”œâ”€ AlternativesSheet (æ›¿ä»£æ–¹æ¡ˆæŠ½å±‰)
       â”‚  â”‚  â””â”€ æ•°æ®æº: alternatives (ç¡¬ç¼–ç )
       â”‚  â”‚
       â”‚  â””â”€ PatchSheet (ä¿®å¤è¯¦æƒ…æŠ½å±‰)
       â”‚     â””â”€ æ•°æ®æº: repairs (ç¡¬ç¼–ç )
       â”‚
       â””â”€ Drawer (å…¨å±€æŠ½å±‰ï¼Œé€šè¿‡ useDrawer)
          â”œâ”€ evidence æ ‡ç­¾é¡µ
          â”œâ”€ risk æ ‡ç­¾é¡µ
          â””â”€ ... (å…¶ä»–æ ‡ç­¾é¡µ)
```

---

## ğŸ”„ å®Œæ•´æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®Œæ•´æ•°æ®æµç¨‹å›¾                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¡µé¢åŠ è½½
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  useEffect è§¦å‘          â”‚
â”‚  loadTrip()             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ å¹¶è¡ŒåŠ è½½
    â”‚  â”‚
    â”‚  â”œâ”€ GET /trips/:id
    â”‚  â”‚  â””â”€ trip
    â”‚  â”‚
    â”‚  â”œâ”€ GET /trips/:id/evidence
    â”‚  â”‚  â””â”€ evidence
    â”‚  â”‚
    â”‚  â”œâ”€ GET /trips/:id/suggestions
    â”‚  â”‚  â””â”€ suggestions
    â”‚  â”‚
    â”‚  â”œâ”€ GET /trips/:id/suggestions/stats
    â”‚  â”‚  â””â”€ suggestionStats
    â”‚  â”‚
    â”‚  â””â”€ GET /trips/:id/conflicts
    â”‚     â””â”€ conflicts
    â”‚
    â””â”€ å»¶è¿ŸåŠ è½½
       â”‚
       â””â”€ GET /trips/:id/metrics
          â””â”€ tripMetrics
             â”‚
             â””â”€ è§¦å‘è®¡ç®—
                â”‚
                â””â”€ healthMetrics (å¥åº·åº¦æŒ‡æ ‡)
                   â”œâ”€ executable (åŸºäº tripMetrics)
                   â”œâ”€ buffer (åŸºäº tripMetrics)
                   â”œâ”€ risk (åŸºäº conflicts)
                   â””â”€ cost (åŸºäº trip.statistics)

æ•°æ®ä¼ é€’
    â”‚
    â”œâ”€ trip â†’ æ‰€æœ‰è§†å›¾ç»„ä»¶
    â”‚
    â”œâ”€ suggestions â†’ AssistantCenter
    â”‚
    â”œâ”€ suggestionStats â†’ SuggestionGuardBar
    â”‚
    â”œâ”€ evidence â†’ Evidence Quick Peek
    â”‚
    â”œâ”€ tripMetrics â†’ HealthBar (é€šè¿‡ healthMetrics è®¡ç®—)
    â”‚
    â””â”€ conflicts â†’ HealthBar (é€šè¿‡ healthMetrics è®¡ç®—)

è§†å›¾æ¸²æŸ“
    â”‚
    â”œâ”€ HealthBar
    â”‚  â””â”€ æ˜¾ç¤º healthMetrics (è®¡ç®—æ•°æ®)
    â”‚
    â”œâ”€ SuggestionGuardBar
    â”‚  â””â”€ æ˜¾ç¤º suggestionStats (APIæ•°æ®)
    â”‚
    â”œâ”€ AssistantCenter
    â”‚  â””â”€ æ˜¾ç¤º suggestions (APIæ•°æ®)
    â”‚
    â”œâ”€ AutoView
    â”‚  â””â”€ æ˜¾ç¤º overallMetrics (ç¡¬ç¼–ç æ•°æ®)
    â”‚     â”œâ”€ å®‰å…¨è§†è§’: 75åˆ†, 2ä¸ªå…³é”®é—®é¢˜
    â”‚     â”œâ”€ èŠ‚å¥è§†è§’: 80åˆ†, 3ä¸ªè­¦å‘Š
    â”‚     â””â”€ ä¿®å¤è§†è§’: 85åˆ†, 5ä¸ªå»ºè®®
    â”‚
    â”œâ”€ AbuView
    â”‚  â””â”€ æ˜¾ç¤º gatingStatus, violations, riskMap (ç¡¬ç¼–ç æ•°æ®)
    â”‚
    â”œâ”€ DrDreView
    â”‚  â””â”€ æ˜¾ç¤º metrics, metricsByItem (ç¡¬ç¼–ç æ•°æ®)
    â”‚
    â””â”€ NeptuneView
       â””â”€ æ˜¾ç¤º repairs, alternatives (ç¡¬ç¼–ç æ•°æ®)
```

---

## ğŸ“ˆ ä¿¡æ¯æ¶æ„å±‚æ¬¡ç»“æ„

```
Level 1: é¡µé¢å±‚çº§
â”œâ”€ TripDetailPage (src/pages/trips/[id].tsx)
   â”‚
   â”œâ”€ Level 2: åŒºåŸŸå±‚çº§
   â”‚  â”œâ”€ é¡¶éƒ¨åŒºåŸŸ (Header Area)
   â”‚  â”œâ”€ å»ºè®®æç¤ºæ  (Suggestion Bar)
   â”‚  â”œâ”€ ä¸»å†…å®¹åŒºåŸŸ (Main Content Area)
   â”‚  â”œâ”€ å³ä¾§åŠ©æ‰‹åŒºåŸŸ (Assistant Area)
   â”‚  â””â”€ è·¯çº¿éª¨æ¶å›¾ (Route Skeleton)
   â”‚     â”‚
   â”‚     â”œâ”€ Level 3: ç»„ä»¶å±‚çº§
   â”‚     â”‚  â”œâ”€ HealthBar
   â”‚     â”‚  â”œâ”€ PersonaModeToggle
   â”‚     â”‚  â”œâ”€ Tabs (æ€»è§ˆ/è§„åˆ’/æ‰§è¡Œ/å¤ç›˜)
   â”‚     â”‚  â”œâ”€ AssistantCenter
   â”‚     â”‚  â”œâ”€ Evidence Quick Peek
   â”‚     â”‚  â””â”€ è§†å›¾ç»„ä»¶ (AutoView/AbuView/DrDreView/NeptuneView)
   â”‚     â”‚     â”‚
   â”‚     â”‚     â”œâ”€ Level 4: å­ç»„ä»¶å±‚çº§
   â”‚     â”‚     â”‚  â”œâ”€ AutoView
   â”‚     â”‚     â”‚  â”‚  â”œâ”€ ç»¼åˆæ¦‚è§ˆå¡ç‰‡
   â”‚     â”‚     â”‚  â”‚  â””â”€ å†…éƒ¨Tabs (æ¦‚è§ˆ/å®‰å…¨/èŠ‚å¥/ä¿®å¤)
   â”‚     â”‚     â”‚  â”‚
   â”‚     â”‚     â”‚  â”œâ”€ AbuView
   â”‚     â”‚     â”‚  â”‚  â”œâ”€ å®‰å…¨çŠ¶æ€æ¡
   â”‚     â”‚     â”‚  â”‚  â”œâ”€ è¿è§„åˆ—è¡¨å¡ç‰‡
   â”‚     â”‚     â”‚  â”‚  â””â”€ è¡Œç¨‹é¡¹åˆ—è¡¨ (å¸¦é£é™©å¾½ç« )
   â”‚     â”‚     â”‚  â”‚
   â”‚     â”‚     â”‚  â”œâ”€ DrDreView
   â”‚     â”‚     â”‚  â”‚  â”œâ”€ æŒ‡æ ‡å¡ç‰‡
   â”‚     â”‚     â”‚  â”‚  â”œâ”€ ä¼˜å…ˆçº§è®¾ç½®
   â”‚     â”‚     â”‚  â”‚  â”œâ”€ çº¦æŸè®¾ç½®
   â”‚     â”‚     â”‚  â”‚  â””â”€ è¡Œç¨‹é¡¹åˆ—è¡¨ (å¸¦æŒ‡æ ‡)
   â”‚     â”‚     â”‚  â”‚
   â”‚     â”‚     â”‚  â””â”€ NeptuneView
   â”‚     â”‚     â”‚     â”œâ”€ ä¿®å¤å»ºè®®åˆ—è¡¨
   â”‚     â”‚     â”‚     â””â”€ è¡Œç¨‹é¡¹åˆ—è¡¨ (å¸¦ä¿®å¤æ ‡è®°)
   â”‚     â”‚     â”‚
   â”‚     â”‚     â””â”€ Level 5: å¼¹çª—å±‚çº§
   â”‚     â”‚        â”œâ”€ Dialog (ç¼–è¾‘ã€åˆ†äº«ã€åä½œè€…ç­‰)
   â”‚     â”‚        â”œâ”€ Sheet (EvidenceSheet, AlternativesSheet, PatchSheet)
   â”‚     â”‚        â””â”€ Drawer (å…¨å±€æŠ½å±‰)
   â”‚     â”‚
   â”‚     â””â”€ Level 6: æ•°æ®å±‚çº§
   â”‚        â”œâ”€ API æ•°æ® (trip, suggestions, metricsç­‰)
   â”‚        â”œâ”€ ç¡¬ç¼–ç æ•°æ® (overallMetrics, violationsç­‰)
   â”‚        â””â”€ è®¡ç®—æ•°æ® (healthMetrics)
```

---

## ğŸ”— å…³é”®æ•°æ®æµè·¯å¾„

### è·¯å¾„1: å¥åº·åº¦æŒ‡æ ‡æ•°æ®æµ

```
GET /trips/:id/metrics
    â”‚
    â–¼
tripMetrics (TripMetricsResponse)
    â”‚
    â”œâ”€ summary.totalBuffer
    â”œâ”€ summary.totalFatigue
    â””â”€ ...
    â”‚
GET /trips/:id/conflicts
    â”‚
    â–¼
conflicts (ConflictsResponse)
    â”‚
    â”œâ”€ conflicts[].severity
    â””â”€ total
    â”‚
GET /trips/:id
    â”‚
    â–¼
trip.statistics
    â”‚
    â”œâ”€ budgetUsed
    â””â”€ totalBudget
    â”‚
    â–¼
healthMetrics è®¡ç®—å‡½æ•°
    â”‚
    â”œâ”€ executable = f(avgBuffer, avgFatigue)
    â”œâ”€ buffer = f(totalBuffer, totalDays)
    â”œâ”€ risk = f(conflicts)
    â””â”€ cost = f(budgetUsed, totalBudget)
    â”‚
    â–¼
HealthBar ç»„ä»¶
    â”‚
    â””â”€ æ˜¾ç¤ºå¥åº·åº¦æŒ‡æ ‡
```

### è·¯å¾„2: å»ºè®®æ•°æ®æµ

```
GET /trips/:id/suggestions
    â”‚
    â–¼
suggestions (Suggestion[])
    â”‚
    â”œâ”€ ä¼ é€’ç»™ AssistantCenter
    â”‚  â””â”€ æ˜¾ç¤ºå»ºè®®åˆ—è¡¨
    â”‚
GET /trips/:id/suggestions/stats
    â”‚
    â–¼
suggestionStats (SuggestionStats)
    â”‚
    â”œâ”€ ä¼ é€’ç»™ SuggestionGuardBar
    â”‚  â””â”€ æ˜¾ç¤ºå»ºè®®ç»Ÿè®¡æ‘˜è¦
    â”‚
    â”œâ”€ ä¼ é€’ç»™ SuggestionBadge (åœ¨Dayå¡ç‰‡ä¸Š)
    â”‚  â””â”€ æ˜¾ç¤ºæ¯æ—¥å»ºè®®æ•°é‡
    â”‚
    â””â”€ âš ï¸ åº”è¯¥ä¼ é€’ç»™ AutoView
       â””â”€ ä½†å½“å‰æœªä½¿ç”¨ï¼ˆä½¿ç”¨ç¡¬ç¼–ç çš„ suggestions: 5ï¼‰
```

### è·¯å¾„3: è§†å›¾æ•°æ®æµï¼ˆç¡¬ç¼–ç ï¼‰

```
AutoView
    â”‚
    â”œâ”€ overallMetrics (ç¡¬ç¼–ç )
    â”‚  â”œâ”€ safetyScore: 75
    â”‚  â”œâ”€ rhythmScore: 80
    â”‚  â”œâ”€ readinessScore: 85
    â”‚  â”œâ”€ criticalIssues: 2
    â”‚  â”œâ”€ warnings: 3
    â”‚  â””â”€ suggestions: 5
    â”‚
    â””â”€ å…³é”®é—®é¢˜åˆ—è¡¨ (ç¡¬ç¼–ç )
       â”œâ”€ "å¤œé—´å¾’æ­¥é£é™©"
       â””â”€ "ç¼“å†²æ—¶é—´ä¸è¶³"

AbuView
    â”‚
    â”œâ”€ gatingStatus: 'WARN' (ç¡¬ç¼–ç )
    â”œâ”€ violations: [...] (ç¡¬ç¼–ç )
    â””â”€ riskMap: {...} (ç¡¬ç¼–ç )

DrDreView
    â”‚
    â”œâ”€ metrics: {...} (ç¡¬ç¼–ç )
    â””â”€ metricsByItem: {...} (ç¡¬ç¼–ç )
    â”‚
    âš ï¸ tripMetrics å·²è·å–ä½†æœªä½¿ç”¨

NeptuneView
    â”‚
    â”œâ”€ repairs: [...] (ç¡¬ç¼–ç )
    â””â”€ alternatives: {...} (ç¡¬ç¼–ç )
```

---

## ğŸ“Š æ•°æ®çŠ¶æ€å¯¹æ¯”è¡¨

| æ•°æ®é¡¹ | æ¥æºç±»å‹ | çŠ¶æ€ | ä½ç½® |
|--------|----------|------|------|
| å¥åº·åº¦æŒ‡æ ‡ | è®¡ç®—æ•°æ® | âœ… å·²å®ç° | healthMetrics (åŸºäºAPIæ•°æ®) |
| å»ºè®®åˆ—è¡¨ | APIæ•°æ® | âœ… å·²å¯¹æ¥ | suggestions (ä»APIè·å–) |
| å»ºè®®ç»Ÿè®¡ | APIæ•°æ® | âœ… å·²å¯¹æ¥ | suggestionStats (ä»APIè·å–) |
| è¯æ®åˆ—è¡¨ | APIæ•°æ® | âœ… å·²å¯¹æ¥ | evidence (ä»APIè·å–) |
| è¡Œç¨‹æŒ‡æ ‡ | APIæ•°æ® | âœ… å·²å¯¹æ¥ | tripMetrics (ä»APIè·å–) |
| å†²çªåˆ—è¡¨ | APIæ•°æ® | âœ… å·²å¯¹æ¥ | conflicts (ä»APIè·å–) |
| AutoViewç»¼åˆæŒ‡æ ‡ | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | overallMetrics |
| AutoViewå…³é”®é—®é¢˜ | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | å…³é”®é—®é¢˜åˆ—è¡¨ |
| AutoViewå…³é”®æŒ‡æ ‡ | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | å…³é”®æŒ‡æ ‡åˆ—è¡¨ |
| AbuViewå®‰å…¨æ•°æ® | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | gatingStatus, violations, riskMap |
| DrDreViewæŒ‡æ ‡æ•°æ® | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | metrics, metricsByItem |
| NeptuneViewä¿®å¤æ•°æ® | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | repairs, alternatives |

---

## ğŸ¨ è§†è§‰å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è§†è§‰å±‚æ¬¡ç»“æ„ (Z-Index)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: èƒŒæ™¯å±‚
â””â”€ é¡µé¢èƒŒæ™¯è‰²

Layer 2: å†…å®¹å±‚
â”œâ”€ é¡¶éƒ¨æ“ä½œæ 
â”œâ”€ å»ºè®®æç¤ºæ 
â”œâ”€ ä¸»å†…å®¹åŒºåŸŸ
â”œâ”€ å³ä¾§åŠ©æ‰‹åŒºåŸŸ
â””â”€ è·¯çº¿éª¨æ¶å›¾

Layer 3: å¡ç‰‡å±‚
â”œâ”€ Card ç»„ä»¶ (å„ç§å¡ç‰‡)
â”œâ”€ Tabs ç»„ä»¶
â””â”€ è§†å›¾ç»„ä»¶å†…å®¹

Layer 4: äº¤äº’å±‚
â”œâ”€ Button ç»„ä»¶
â”œâ”€ Badge ç»„ä»¶
â””â”€ å…¶ä»–äº¤äº’å…ƒç´ 

Layer 5: å¼¹çª—å±‚ (z-index: 50+)
â”œâ”€ Dialog (z-index: 50)
â”œâ”€ Sheet (z-index: 50)
â””â”€ Drawer (z-index: 50)
   â””â”€ Portal æ¸²æŸ“

Layer 6: ä¸‹æ‹‰èœå•å±‚ (z-index: 50)
â””â”€ DropdownMenu (Portal æ¸²æŸ“)

Layer 7: æç¤ºå±‚ (z-index: 100+)
â””â”€ Toast (å¦‚æœ‰)
```

---

## ğŸ”„ äº¤äº’æµç¨‹

```
ç”¨æˆ·æ“ä½œæµç¨‹
    â”‚
    â”œâ”€ æŸ¥çœ‹å¥åº·åº¦
    â”‚  â””â”€ HealthBar æ˜¾ç¤º (åŸºäºè®¡ç®—æ•°æ®)
    â”‚
    â”œâ”€ æŸ¥çœ‹å»ºè®®
    â”‚  â”œâ”€ ç‚¹å‡» SuggestionGuardBar
    â”‚  â”‚  â””â”€ æ»šåŠ¨åˆ° AssistantCenter
    â”‚  â”‚
    â”‚  â””â”€ åœ¨ AssistantCenter ä¸­
    â”‚     â”œâ”€ ç‚¹å‡»å»ºè®®å¡ç‰‡
    â”‚     â”‚  â””â”€ setDrawerTab('risk') + setDrawerOpen(true)
    â”‚     â”‚
    â”‚     â””â”€ ç‚¹å‡»æ“ä½œæŒ‰é’®
    â”‚        â”œâ”€ applySuggestion() â†’ POST /trips/:id/suggestions/:id/apply
    â”‚        â””â”€ dismissSuggestion() â†’ POST /trips/:id/suggestions/:id/dismiss
    â”‚
    â”œâ”€ åˆ‡æ¢è§†å›¾
    â”‚  â””â”€ PersonaModeToggle
    â”‚     â”œâ”€ setViewMode('auto') â†’ æ˜¾ç¤º AutoView
    â”‚     â”œâ”€ setViewMode('abu') â†’ æ˜¾ç¤º AbuView
    â”‚     â”œâ”€ setViewMode('drdre') â†’ æ˜¾ç¤º DrDreView
    â”‚     â””â”€ setViewMode('neptune') â†’ æ˜¾ç¤º NeptuneView
    â”‚
    â”œâ”€ æŸ¥çœ‹è¯¦æƒ…ï¼ˆè§†å›¾ç»„ä»¶å†…ï¼‰
    â”‚  â”‚
    â”‚  â”œâ”€ AbuView
    â”‚  â”‚  â””â”€ ç‚¹å‡»è¡Œç¨‹é¡¹
    â”‚  â”‚     â””â”€ EvidenceSheet æ‰“å¼€ (æ˜¾ç¤ºç¡¬ç¼–ç çš„é£é™©æ•°æ®)
    â”‚  â”‚
    â”‚  â”œâ”€ DrDreView
    â”‚  â”‚  â””â”€ ç‚¹å‡»"é‡æ–°ç”Ÿæˆ"
    â”‚  â”‚     â””â”€ handleRegenerate() (ä½¿ç”¨ç¡¬ç¼–ç çš„å€™é€‰æ–¹æ¡ˆ)
    â”‚  â”‚
    â”‚  â””â”€ NeptuneView
    â”‚     â”œâ”€ ç‚¹å‡»è¡Œç¨‹é¡¹
    â”‚     â”‚  â””â”€ AlternativesSheet æ‰“å¼€ (æ˜¾ç¤ºç¡¬ç¼–ç çš„æ›¿ä»£æ–¹æ¡ˆ)
    â”‚     â”‚
    â”‚     â””â”€ ç‚¹å‡»ä¿®å¤å»ºè®®
    â”‚        â””â”€ PatchSheet æ‰“å¼€ (æ˜¾ç¤ºç¡¬ç¼–ç çš„ä¿®å¤è¯¦æƒ…)
    â”‚           â””â”€ ç‚¹å‡»"åº”ç”¨ä¿®å¤"
    â”‚              â””â”€ handleApplyRepair() (ä»… console.logï¼Œæœªå®ç°)
    â”‚
    â””â”€ ç¼–è¾‘æ“ä½œ
       â”œâ”€ ç¼–è¾‘è¡Œç¨‹ â†’ EditTripDialog
       â”œâ”€ åˆ›å»ºè¡Œç¨‹é¡¹ â†’ CreateItineraryItemDialog
       â”œâ”€ ç¼–è¾‘è¡Œç¨‹é¡¹ â†’ EditItineraryItemDialog
       â”œâ”€ æ›¿æ¢è¡Œç¨‹é¡¹ â†’ ReplaceItineraryItemDialog
       â””â”€ åˆ é™¤è¡Œç¨‹ â†’ AlertDialog
```

---

## ğŸ“ å¸ƒå±€ç½‘æ ¼ç³»ç»Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¸ƒå±€ç½‘æ ¼ç³»ç»Ÿ (Tailwind Grid)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸»å†…å®¹åŒºåŸŸ (Grid: grid-cols-12)
â”‚
â”œâ”€ å·¦ä¾§å†…å®¹åŒº (col-span-12 lg:col-span-8)
â”‚  â”‚
â”‚  â””â”€ æ ‡ç­¾é¡µå†…å®¹
â”‚     â””â”€ è§†å›¾ç»„ä»¶ (AutoView/AbuView/DrDreView/NeptuneView)
â”‚
â””â”€ å³ä¾§åŠ©æ‰‹åŒº (col-span-12 lg:col-span-4)
   â”‚
   â”œâ”€ AssistantCenter
   â””â”€ Evidence Quick Peek

AutoView å†…éƒ¨å¸ƒå±€
â”‚
â”œâ”€ ç»¼åˆæ¦‚è§ˆå¡ç‰‡
â”‚  â””â”€ Grid: grid-cols-1 md:grid-cols-3
â”‚     â”œâ”€ å®‰å…¨è§†è§’å¡ç‰‡
â”‚     â”œâ”€ èŠ‚å¥è§†è§’å¡ç‰‡
â”‚     â””â”€ ä¿®å¤è§†è§’å¡ç‰‡
â”‚
â””â”€ æ¦‚è§ˆæ ‡ç­¾é¡µ
   â””â”€ Grid: grid-cols-1 lg:grid-cols-2
      â”œâ”€ å…³é”®é—®é¢˜å¡ç‰‡
      â””â”€ å…³é”®æŒ‡æ ‡å¡ç‰‡
```

---

## ğŸ” å…³é”®æ•°æ®æ˜ å°„å…³ç³»

```
API æ•°æ® â†’ ç»„ä»¶ä½¿ç”¨

trip
  â”œâ”€ TripDetailPage (ä¸»è¦æ•°æ®æº)
  â”œâ”€ AutoView (é€šè¿‡ props)
  â”œâ”€ AbuView (é€šè¿‡ props)
  â”œâ”€ DrDreView (é€šè¿‡ props)
  â””â”€ NeptuneView (é€šè¿‡ props)

suggestions
  â””â”€ AssistantCenter (æ˜¾ç¤ºå»ºè®®åˆ—è¡¨)

suggestionStats
  â”œâ”€ SuggestionGuardBar (æ˜¾ç¤ºç»Ÿè®¡æ‘˜è¦)
  â”œâ”€ SuggestionBadge (åœ¨Dayå¡ç‰‡ä¸Šæ˜¾ç¤ºæ•°é‡)
  â””â”€ âš ï¸ AutoView (æœªä½¿ç”¨ï¼Œä½¿ç”¨ç¡¬ç¼–ç çš„ suggestions: 5)

tripMetrics
  â”œâ”€ HealthBar (é€šè¿‡ healthMetrics è®¡ç®—)
  â””â”€ âš ï¸ DrDreView (æœªä½¿ç”¨ï¼Œä½¿ç”¨ç¡¬ç¼–ç çš„ metrics)

conflicts
  â””â”€ HealthBar (é€šè¿‡ healthMetrics è®¡ç®—)

evidence
  â””â”€ Evidence Quick Peek (æ˜¾ç¤ºå‰3æ¡)
```

---

## ğŸ¯ æ”¹è¿›å»ºè®®æ¶æ„

```
å½“å‰æ¶æ„é—®é¢˜
    â”‚
    â”œâ”€ AutoView æ•°æ®ç¡¬ç¼–ç 
    â”‚  â””â”€ æ”¹è¿›: ä¼ å…¥ tripMetrics, suggestionStats, violations, repairs
    â”‚
    â”œâ”€ AbuView æ•°æ®ç¡¬ç¼–ç 
    â”‚  â””â”€ æ”¹è¿›: å¯¹æ¥ GET /trips/:id/risk-assessment, /violations
    â”‚
    â”œâ”€ DrDreView æ•°æ®ç¡¬ç¼–ç 
    â”‚  â””â”€ æ”¹è¿›: ä½¿ç”¨å·²è·å–çš„ tripMetricsï¼Œå¯¹æ¥å•é¡¹æŒ‡æ ‡æ¥å£
    â”‚
    â””â”€ NeptuneView æ•°æ®ç¡¬ç¼–ç 
       â””â”€ æ”¹è¿›: å¯¹æ¥ GET /trips/:id/repairs, /alternatives

æ”¹è¿›åçš„æ•°æ®æµ
    â”‚
    â”œâ”€ TripDetailPage
    â”‚  â”œâ”€ åŠ è½½æ‰€æœ‰å¿…è¦æ•°æ®
    â”‚  â”‚  â”œâ”€ tripMetrics
    â”‚  â”‚  â”œâ”€ suggestionStats
    â”‚  â”‚  â”œâ”€ violations (æ–°å¢)
    â”‚  â”‚  â””â”€ repairs (æ–°å¢)
    â”‚  â”‚
    â”‚  â””â”€ ä¼ é€’ç»™è§†å›¾ç»„ä»¶
    â”‚     â”œâ”€ AutoView (trip, tripMetrics, suggestionStats, violations, repairs)
    â”‚     â”œâ”€ AbuView (trip, violations, riskMap)
    â”‚     â”œâ”€ DrDreView (trip, tripMetrics, metricsByItem)
    â”‚     â””â”€ NeptuneView (trip, repairs, alternatives)
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**ç»´æŠ¤è€…**: å‰ç«¯å›¢é˜Ÿ

