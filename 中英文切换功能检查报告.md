# 中英文切换功能检查报告

**日期**: 2025-01-01  
**检查范围**: 整个前端项目的国际化支持情况

---

## 一、已实现的功能

### ✅ 1. i18n 基础设施

- **配置文件**: `src/i18n/config.ts`
  - ✅ 使用 `i18next` 和 `react-i18next`
  - ✅ 支持中文 (zh) 和英文 (en)
  - ✅ 自动语言检测（localStorage + navigator）
  - ✅ 语言偏好保存到 localStorage

- **翻译文件**:
  - ✅ `src/locales/zh/translation.json` - 中文翻译
  - ✅ `src/locales/en/translation.json` - 英文翻译

- **初始化**: ✅ 在 `src/main.tsx` 中已导入 i18n 配置

---

### ✅ 2. 语言切换组件

- **组件**: `src/components/common/LanguageSwitcher.tsx`
  - ✅ 功能完整，支持中英文切换
  - ⚠️ **问题**: 只在 `WebsiteNavbar` 中使用，未在 Dashboard 相关组件中使用

---

## 二、已使用翻译的页面/组件

### ✅ 网站页面（Website Pages）

- `src/pages/website/*` - 大部分已使用 `useTranslation`
- `src/components/layout/WebsiteNavbar.tsx` - 已使用翻译 + LanguageSwitcher

### ✅ 部分功能页面

- `src/pages/plan-studio/index.tsx` - 已使用 `useTranslation`
- `src/pages/trips/[id].tsx` - 已使用 `useTranslation`
- `src/components/common/PersonaModeToggle.tsx` - 已使用翻译
- `src/pages/Preferences.tsx` - 已使用翻译

---

## 三、需要修复的问题

### ❌ 1. Dashboard 页面（严重）

**文件**: `src/pages/Dashboard.tsx`

**问题**: 
- ❌ 未导入 `useTranslation`
- ❌ 大量硬编码的中文/英文文本

**硬编码文本清单**:
```
- "欢迎回来，{userName}" (第296行)
- "Today: {needsAttention} trip needs attention" (第298行)
- "{ready} trips ready" (第300行)
- "{blockers} blocker" (第302行)
- "Continue Last" (第307行)
- "Create Trip" (第311行)
- "继续上次" (第324行)
- "最近一次编辑的行程" (第325行)
- "Continue Planning" (第352行)
- "需要处理" (第372行)
- "需要您关注的问题" (第373行)
- "暂无需要关注的事项" (第385行)
- "一切都很顺利！" (第386行)
- "严重"/"高"/"中"/"低" (第446-451行)
- "新" (第455行)
- "Fix" (第487行)
- "路线模板" (第500行)
- "快速开始您的旅程" (第501行)
- "暂无模板" (第509行)
- "路线模板正在准备中" (第510行)
- "天" (第532行)
- "Preview" (第544行)
- "使用模板" (第551行)
- "风险概览" (第585行)
- "时间窗冲突" (第591行)
- "缺少缓冲可能导致延误连锁反应" (第596行)
- "Open Risk Drawer" (第608行)
- "准备度" (第618行)
- "blockers" (第624行)
- "Continue Last Trip" (第630行)
```

**修复方案**:
1. 导入 `useTranslation`
2. 在翻译文件中添加 `dashboard` 节点
3. 替换所有硬编码文本为翻译 key

---

### ❌ 2. SidebarNavigation 组件

**文件**: `src/components/layout/SidebarNavigation.tsx`

**问题**:
- ❌ 未导入 `useTranslation`
- ❌ 导航项标签硬编码为中文

**硬编码文本清单**:
```typescript
const navItems: NavItem[] = [
  { key: 'home', label: '工作台', ... },
  { key: 'trips', label: '行程库', ... },
  { key: 'plan-studio', label: '规划工作台', ... },
  { key: 'execute', label: '执行模式', ... },
  { key: 'trails', label: '徒步', ... },
  { key: 'readiness', label: '准备度', ... },
  { key: 'insights', label: '复盘', ... },
  { key: 'settings', label: '设置', ... },
];
```

**修复方案**:
1. 导入 `useTranslation`
2. 在翻译文件中添加 `sidebar` 节点
3. 使用 `t('sidebar.{key}')` 替换硬编码标签

---

### ❌ 3. Header 组件

**文件**: `src/components/layout/Header.tsx`

**问题**:
- ✅ 已导入 `useTranslation`，但未完全使用
- ❌ 导航项标签硬编码为中文

**硬编码文本清单**:
```typescript
const navItems = [
  { path: '/dashboard/trips', label: '我的行程', ... },
  { path: '/route-philosophy', label: '路线哲学', ... },
  { path: '/dashboard/professional', label: '专业工具', ... },
  { path: '/dashboard/share', label: '分享&社区', ... },
];
```

**修复方案**:
1. 在翻译文件中添加 `header.nav` 节点
2. 使用 `t('header.nav.{key}')` 替换硬编码标签

---

### ❌ 4. 缺少语言切换器

**问题**: 
- ✅ `LanguageSwitcher` 组件存在
- ✅ 在 `WebsiteNavbar` 中使用
- ❌ **未在 Dashboard 布局中使用**

**需要添加位置**:
- `src/components/layout/Header.tsx` - Dashboard 页面的 Header
- 或 `src/components/layout/DashboardLayout.tsx` - 全局布局

---

### ⚠️ 5. 其他可能的问题

**需要检查的文件**:
- `src/components/plan-studio/PlanStudioSidebar.tsx` - 可能包含硬编码文本
- `src/components/layout/GlobalCommandBar.tsx` - 搜索框 placeholder 等
- `src/pages/plan-studio/*Tab.tsx` - 各个 Tab 组件
- `src/components/trips/views/*.tsx` - 三视图组件

---

## 四、翻译文件缺失的 Key

需要在 `src/locales/zh/translation.json` 和 `src/locales/en/translation.json` 中添加：

### 4.1 Dashboard 相关

```json
{
  "dashboard": {
    "welcome": "欢迎回来，{{userName}}",
    "stats": {
      "needsAttention": "Today: {{count}} trip needs attention",
      "tripsReady": "{{count}} trips ready",
      "blockers": "{{count}} blocker"
    },
    "continueLast": "Continue Last",
    "createTrip": "Create Trip",
    "continueCard": {
      "title": "继续上次",
      "description": "最近一次编辑的行程",
      "continuePlanning": "Continue Planning"
    },
    "attentionQueue": {
      "title": "需要处理",
      "description": "需要您关注的问题",
      "empty": "暂无需要关注的事项",
      "emptyDescription": "一切都很顺利！",
      "severity": {
        "critical": "严重",
        "high": "高",
        "medium": "中",
        "low": "低"
      },
      "status": {
        "new": "新"
      },
      "fix": "Fix"
    },
    "templates": {
      "title": "路线模板",
      "description": "快速开始您的旅程",
      "empty": "暂无模板",
      "emptyDescription": "路线模板正在准备中",
      "days": "天",
      "preview": "Preview",
      "useTemplate": "使用模板"
    },
    "riskOverview": {
      "title": "风险概览",
      "timeWindowConflict": "时间窗冲突",
      "bufferInsufficient": "缺少缓冲可能导致延误连锁反应",
      "openDrawer": "Open Risk Drawer"
    },
    "readiness": {
      "title": "准备度",
      "blockers": "blockers",
      "continueLastTrip": "Continue Last Trip"
    }
  }
}
```

### 4.2 Sidebar 相关

```json
{
  "sidebar": {
    "home": "工作台",
    "trips": "行程库",
    "planStudio": "规划工作台",
    "execute": "执行模式",
    "trails": "徒步",
    "readiness": "准备度",
    "insights": "复盘",
    "settings": "设置"
  }
}
```

### 4.3 Header 相关

```json
{
  "header": {
    "nav": {
      "trips": "我的行程",
      "routePhilosophy": "路线哲学",
      "professional": "专业工具",
      "share": "分享&社区"
    }
  }
}
```

---

## 五、修复优先级

### P0 - 必须修复（影响核心功能）

1. **Dashboard 页面国际化**
   - 添加 `useTranslation`
   - 添加翻译 key
   - 替换所有硬编码文本

2. **SidebarNavigation 国际化**
   - 添加 `useTranslation`
   - 添加翻译 key
   - 替换导航项标签

3. **在 Dashboard 布局中添加语言切换器**
   - 在 Header 或 GlobalCommandBar 中添加 LanguageSwitcher

### P1 - 重要修复

4. **Header 组件导航项国际化**
   - 添加翻译 key
   - 替换硬编码标签

5. **PlanStudioSidebar 组件检查**
   - 检查是否有硬编码文本
   - 如需要，添加翻译

### P2 - 可选优化

6. **其他组件的硬编码文本**
   - 逐步替换剩余的硬编码文本

---

## 六、修复步骤建议

### 步骤1: 添加翻译文件内容

在 `src/locales/zh/translation.json` 和 `src/locales/en/translation.json` 中添加缺失的翻译 key

### 步骤2: 修复 Dashboard 页面

1. 导入 `useTranslation`
2. 替换所有硬编码文本
3. 测试语言切换功能

### 步骤3: 修复 SidebarNavigation

1. 导入 `useTranslation`
2. 使用 `t('sidebar.{key}')` 替换标签
3. 测试语言切换

### 步骤4: 添加语言切换器

1. 在 Header 或合适位置添加 `LanguageSwitcher` 组件
2. 测试切换功能

### 步骤5: 修复 Header 导航

1. 添加翻译 key
2. 替换硬编码标签
3. 测试

---

## 七、测试清单

- [ ] Dashboard 页面所有文本支持中英文切换
- [ ] Sidebar 导航项支持中英文切换
- [ ] Header 导航项支持中英文切换
- [ ] 语言切换器在 Dashboard 布局中可见且可用
- [ ] 切换语言后，所有文本立即更新
- [ ] 语言偏好正确保存到 localStorage
- [ ] 刷新页面后，语言偏好保持

---

## 八、相关文件清单

### 需要修改的文件

1. `src/pages/Dashboard.tsx` - 添加 useTranslation，替换硬编码文本
2. `src/components/layout/SidebarNavigation.tsx` - 添加 useTranslation，替换标签
3. `src/components/layout/Header.tsx` - 添加翻译 key，替换标签，添加 LanguageSwitcher
4. `src/locales/zh/translation.json` - 添加 Dashboard、Sidebar、Header 相关翻译
5. `src/locales/en/translation.json` - 添加对应英文翻译

### 需要检查的文件

- `src/components/plan-studio/PlanStudioSidebar.tsx`
- `src/components/layout/GlobalCommandBar.tsx`
- `src/pages/plan-studio/*Tab.tsx`
- `src/components/trips/views/*.tsx`

---

**报告状态**: 待修复  
**修复优先级**: P0

