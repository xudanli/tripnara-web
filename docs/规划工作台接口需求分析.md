# è§„åˆ’å·¥ä½œå°æ¥å£éœ€æ±‚åˆ†æ

> ç”Ÿæˆæ—¶é—´: 2025-01-XX  
> åˆ†æèŒƒå›´: è§„åˆ’å·¥ä½œå°æ¨¡å—çš„æ¥å£å®Œæ•´æ€§å’ŒåŠŸèƒ½è¦†ç›–

---

## ğŸ“‹ ç›®å½•

1. [å½“å‰æ¥å£çŠ¶æ€](#å½“å‰æ¥å£çŠ¶æ€)
2. [å·²å®ç°æ¥å£è¯¦æƒ…](#å·²å®ç°æ¥å£è¯¦æƒ…)
3. [ç¼ºå¤±æ¥å£åˆ†æ](#ç¼ºå¤±æ¥å£åˆ†æ)
4. [åŠŸèƒ½ä½¿ç”¨æƒ…å†µ](#åŠŸèƒ½ä½¿ç”¨æƒ…å†µ)
5. [æ¥å£éœ€æ±‚æ¸…å•](#æ¥å£éœ€æ±‚æ¸…å•)
6. [ä¼˜å…ˆçº§å»ºè®®](#ä¼˜å…ˆçº§å»ºè®®)

---

## å½“å‰æ¥å£çŠ¶æ€

### å·²å®ç°çš„æ¥å£

æ ¹æ® `src/api/planning-workbench.ts` æ–‡ä»¶ï¼Œå½“å‰å·²å®ç°ä»¥ä¸‹æ¥å£ï¼š

| æ–¹æ³• | è·¯å¾„ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| POST | `/planning-workbench/execute` | âœ… å·²å®ç° | æ‰§è¡Œè§„åˆ’å·¥ä½œå°æµç¨‹ï¼ˆä¸»å…¥å£ï¼‰ |
| GET | `/planning-workbench/state/:planId` | âœ… å·²å®ç° | è·å–è§„åˆ’çŠ¶æ€ |

### æ–‡æ¡£ä¸­è®°å½•ä½†æœªå®ç°çš„æ¥å£

æ ¹æ® `docs/API-æ¥å£å¯¹æ¥æƒ…å†µ.md` æ–‡æ¡£ï¼Œä»¥ä¸‹æ¥å£åœ¨æ–‡æ¡£ä¸­è®°å½•ä½†ä»£ç ä¸­æœªå®ç°ï¼š

| æ–¹æ³• | è·¯å¾„ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| GET | `/planning-workbench/trips/:tripId` | âŒ æœªå®ç° | è·å–å·¥ä½œå°æ•°æ® |
| POST | `/planning-workbench/trips/:tripId/actions` | âŒ æœªå®ç° | æ‰§è¡Œå·¥ä½œå°æ“ä½œ |

---

## å·²å®ç°æ¥å£è¯¦æƒ…

### 1. POST `/planning-workbench/execute`

**åŠŸèƒ½**: æ‰§è¡Œè§„åˆ’å·¥ä½œå°æµç¨‹ï¼Œæ”¯æŒç”Ÿæˆæ–¹æ¡ˆã€å¯¹æ¯”æ–¹æ¡ˆã€æäº¤æ–¹æ¡ˆã€è°ƒæ•´æ–¹æ¡ˆç­‰æ“ä½œã€‚

**è¯·æ±‚å‚æ•°**:
```typescript
interface ExecutePlanningWorkbenchRequest {
  context: PlanningContext;        // è§„åˆ’ä¸Šä¸‹æ–‡ï¼ˆç›®çš„åœ°ã€å¤©æ•°ã€çº¦æŸç­‰ï¼‰
  tripId?: string;                 // è¡Œç¨‹ IDï¼ˆå¯é€‰ï¼‰
  existingPlanState?: any;         // ç°æœ‰ PlanStateï¼ˆå¯é€‰ï¼Œç”¨äºå¢é‡æ›´æ–°ï¼‰
  userAction?: UserAction;         // ç”¨æˆ·æ“ä½œç±»å‹
}

type UserAction = 'generate' | 'compare' | 'commit' | 'adjust';
```

**å“åº”æ•°æ®**:
```typescript
interface ExecutePlanningWorkbenchResponse {
  planState: PlanState;            // è§„åˆ’çŠ¶æ€
  uiOutput: UIOutput;              // UI è¾“å‡ºï¼ˆä¸‰äººæ ¼è¯„ä¼°ç»“æœï¼‰
}
```

**å½“å‰ä½¿ç”¨æƒ…å†µ**:
- âœ… `PlanningWorkbenchTab.tsx` - ä½¿ç”¨ `userAction: 'generate'`ã€`'compare'`ã€`'commit'`ã€`'adjust'`ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… `OptimizeTab.tsx` - ä½¿ç”¨ `userAction: 'generate'`
- âœ… å·²æ”¯æŒæ‰€æœ‰ 4 ç§æ“ä½œç±»å‹

### 2. GET `/planning-workbench/state/:planId`

**åŠŸèƒ½**: æ ¹æ® planId è·å–å½“å‰çš„ PlanStateã€‚

**å½“å‰ä½¿ç”¨æƒ…å†µ**:
- âŒ å‰ç«¯ä»£ç ä¸­æœªæ‰¾åˆ°è°ƒç”¨æ­¤æ¥å£çš„åœ°æ–¹

---

## ç¼ºå¤±æ¥å£åˆ†æ

### 1. å¯¹æ¯”æ–¹æ¡ˆåŠŸèƒ½ï¼ˆCompareï¼‰

**éœ€æ±‚åœºæ™¯**:
- ç”¨æˆ·å¸Œæœ›å¯¹æ¯”å¤šä¸ªè§„åˆ’æ–¹æ¡ˆ
- éœ€è¦æŸ¥çœ‹ä¸åŒæ–¹æ¡ˆçš„å·®å¼‚ï¼ˆé¢„ç®—ã€è·¯çº¿ã€æ—¶é—´ç­‰ï¼‰
- éœ€è¦æ”¯æŒæ–¹æ¡ˆåˆ—è¡¨å’Œæ–¹æ¡ˆè¯¦æƒ…

**ç¼ºå¤±çš„æ¥å£**:
- âŒ `GET /planning-workbench/trips/:tripId/plans` - è·å–æ–¹æ¡ˆåˆ—è¡¨
- âŒ `GET /planning-workbench/plans/:planId` - è·å–æ–¹æ¡ˆè¯¦æƒ…
- âŒ `POST /planning-workbench/plans/compare` - å¯¹æ¯”å¤šä¸ªæ–¹æ¡ˆ
- âŒ `POST /planning-workbench/execute` (userAction: 'compare') - è™½ç„¶æ¥å£å­˜åœ¨ï¼Œä½†éœ€è¦æ”¯æŒå¯¹æ¯”é€»è¾‘

**ç›¸å…³ä»£ç ä½ç½®**:
- `src/pages/plan-studio/WhatIfTab.tsx` - æœ‰å¯¹æ¯”åœºæ™¯çš„ UIï¼Œä½†ä½¿ç”¨çš„æ˜¯å…¶ä»–æ¥å£

### 2. æäº¤æ–¹æ¡ˆåŠŸèƒ½ï¼ˆCommitï¼‰

**éœ€æ±‚åœºæ™¯**:
- ç”¨æˆ·ç¡®è®¤è§„åˆ’æ–¹æ¡ˆåï¼Œéœ€è¦å°†æ–¹æ¡ˆæäº¤å¹¶ä¿å­˜åˆ°è¡Œç¨‹
- éœ€è¦å°† `PlanState` è½¬æ¢ä¸º `TripDetail` å¹¶ä¿å­˜
- å¯èƒ½éœ€è¦æ”¯æŒéƒ¨åˆ†æäº¤ï¼ˆåªæäº¤éƒ¨åˆ†å¤©æ•°ï¼‰

**ç¼ºå¤±çš„æ¥å£**:
- âŒ `POST /planning-workbench/plans/:planId/commit` - æäº¤æ–¹æ¡ˆåˆ°è¡Œç¨‹
- âŒ `POST /planning-workbench/execute` (userAction: 'commit') - è™½ç„¶æ¥å£å­˜åœ¨ï¼Œä½†éœ€è¦å®ç°æäº¤é€»è¾‘

**ç›¸å…³ä»£ç ä½ç½®**:
- `src/pages/trips/new.tsx` - åˆ›å»ºè¡Œç¨‹æ—¶å¯èƒ½éœ€è¦æ­¤åŠŸèƒ½
- `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - è§„åˆ’å·¥ä½œå°é¡µé¢éœ€è¦æäº¤æŒ‰é’®

### 3. è°ƒæ•´æ–¹æ¡ˆåŠŸèƒ½ï¼ˆAdjustï¼‰

**éœ€æ±‚åœºæ™¯**:
- ç”¨æˆ·åŸºäºç°æœ‰æ–¹æ¡ˆè¿›è¡Œè°ƒæ•´ï¼ˆä¿®æ”¹çº¦æŸã€æ·»åŠ /åˆ é™¤åœ°ç‚¹ç­‰ï¼‰
- éœ€è¦æ”¯æŒå¢é‡æ›´æ–°
- éœ€è¦é‡æ–°è¯„ä¼°è°ƒæ•´åçš„æ–¹æ¡ˆ

**ç¼ºå¤±çš„æ¥å£**:
- âŒ `POST /planning-workbench/plans/:planId/adjust` - è°ƒæ•´æ–¹æ¡ˆ
- âŒ `POST /planning-workbench/execute` (userAction: 'adjust') - è™½ç„¶æ¥å£å­˜åœ¨ï¼Œä½†éœ€è¦å®ç°è°ƒæ•´é€»è¾‘

**ç›¸å…³ä»£ç ä½ç½®**:
- `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - å¯èƒ½éœ€è¦è°ƒæ•´åŠŸèƒ½
- `src/pages/plan-studio/OptimizeTab.tsx` - ä¼˜åŒ–æ ‡ç­¾é¡µå¯èƒ½éœ€è¦è°ƒæ•´åŠŸèƒ½

### 4. è·å–å·¥ä½œå°æ•°æ®

**éœ€æ±‚åœºæ™¯**:
- æ‰“å¼€è§„åˆ’å·¥ä½œå°æ—¶ï¼Œéœ€è¦åŠ è½½å·²æœ‰çš„è§„åˆ’æ•°æ®
- éœ€è¦è·å–å½“å‰è¡Œç¨‹çš„è§„åˆ’å†å²
- éœ€è¦è·å–è§„åˆ’çŠ¶æ€å’Œç‰ˆæœ¬ä¿¡æ¯

**ç¼ºå¤±çš„æ¥å£**:
- âŒ `GET /planning-workbench/trips/:tripId` - è·å–å·¥ä½œå°æ•°æ®ï¼ˆæ–‡æ¡£ä¸­æœ‰è®°å½•ä½†æœªå®ç°ï¼‰

**ç›¸å…³ä»£ç ä½ç½®**:
- `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - æ‰“å¼€é¡µé¢æ—¶éœ€è¦åŠ è½½æ•°æ®

### 5. æ–¹æ¡ˆç®¡ç†åŠŸèƒ½

**éœ€æ±‚åœºæ™¯**:
- ç”¨æˆ·å¯èƒ½éœ€è¦æŸ¥çœ‹å†å²æ–¹æ¡ˆ
- éœ€è¦æ”¯æŒæ–¹æ¡ˆç‰ˆæœ¬ç®¡ç†
- éœ€è¦æ”¯æŒæ–¹æ¡ˆåˆ é™¤å’Œæ¢å¤

**ç¼ºå¤±çš„æ¥å£**:
- âŒ `GET /planning-workbench/trips/:tripId/plans` - è·å–æ–¹æ¡ˆåˆ—è¡¨
- âŒ `GET /planning-workbench/plans/:planId` - è·å–æ–¹æ¡ˆè¯¦æƒ…
- âŒ `DELETE /planning-workbench/plans/:planId` - åˆ é™¤æ–¹æ¡ˆ
- âŒ `POST /planning-workbench/plans/:planId/restore` - æ¢å¤æ–¹æ¡ˆ

---

## åŠŸèƒ½ä½¿ç”¨æƒ…å†µ

### å‰ç«¯ä»£ç ä¸­çš„ä½¿ç”¨æƒ…å†µ

#### âœ… å·²ä½¿ç”¨çš„åŠŸèƒ½

1. **ç”Ÿæˆæ–¹æ¡ˆï¼ˆGenerateï¼‰**
   - `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - æ‰§è¡Œè§„åˆ’ âœ…
   - `src/pages/plan-studio/OptimizeTab.tsx` - æ‰§è¡Œè§„åˆ’å·¥ä½œå° âœ…

2. **å¯¹æ¯”æ–¹æ¡ˆï¼ˆCompareï¼‰**
   - `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - å·²æ·»åŠ å¯¹æ¯”æŒ‰é’®å’Œå¯¹è¯æ¡† âœ…
   - æ³¨æ„ï¼šå¯¹æ¯”åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒè·å–æ–¹æ¡ˆåˆ—è¡¨æ‰èƒ½å®Œæ•´å®ç°

3. **æäº¤æ–¹æ¡ˆï¼ˆCommitï¼‰**
   - `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - å·²æ·»åŠ æäº¤æŒ‰é’®å’Œç¡®è®¤å¯¹è¯æ¡† âœ…
   - æ”¯æŒå°†è§„åˆ’æ–¹æ¡ˆæäº¤åˆ°è¡Œç¨‹

4. **è°ƒæ•´æ–¹æ¡ˆï¼ˆAdjustï¼‰**
   - `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - å·²æ·»åŠ è°ƒæ•´æŒ‰é’®å’Œç¡®è®¤å¯¹è¯æ¡† âœ…
   - æ”¯æŒåŸºäºç°æœ‰æ–¹æ¡ˆè¿›è¡Œè°ƒæ•´

#### âš ï¸ éƒ¨åˆ†å®ç°çš„åŠŸèƒ½

1. **è·å–è§„åˆ’çŠ¶æ€**
   - `getState` æ¥å£å·²å®ç°ï¼Œä½†å‰ç«¯ä»£ç ä¸­æœªè°ƒç”¨
   - å¯ä»¥ç”¨äºåŠ è½½å·²æœ‰è§„åˆ’çŠ¶æ€

---

## æ¥å£éœ€æ±‚æ¸…å•

### é«˜ä¼˜å…ˆçº§ï¼ˆP0 - æ ¸å¿ƒåŠŸèƒ½ï¼‰

#### 1. æäº¤æ–¹æ¡ˆæ¥å£
```
POST /planning-workbench/plans/:planId/commit
```
**åŠŸèƒ½**: å°†è§„åˆ’æ–¹æ¡ˆæäº¤å¹¶ä¿å­˜åˆ°è¡Œç¨‹  
**è¯·æ±‚å‚æ•°**:
```typescript
{
  planId: string;
  tripId: string;
  options?: {
    partialCommit?: boolean;      // æ˜¯å¦éƒ¨åˆ†æäº¤
    commitDays?: number[];         // è¦æäº¤çš„å¤©æ•°ï¼ˆå¦‚æœéƒ¨åˆ†æäº¤ï¼‰
  };
}
```
**å“åº”æ•°æ®**:
```typescript
{
  success: true;
  data: {
    tripId: string;
    planId: string;
    committedAt: string;
    changes: {
      added: number;
      modified: number;
      removed: number;
    };
  };
}
```

#### 2. è·å–å·¥ä½œå°æ•°æ®æ¥å£
```
GET /planning-workbench/trips/:tripId
```
**åŠŸèƒ½**: è·å–æŒ‡å®šè¡Œç¨‹çš„è§„åˆ’å·¥ä½œå°æ•°æ®  
**å“åº”æ•°æ®**:
```typescript
{
  success: true;
  data: {
    tripId: string;
    currentPlan?: PlanState;
    planHistory: PlanState[];
    status: 'DRAFT' | 'PROPOSED' | 'NEED_CONFIRM' | 'LOCKED';
  };
}
```

### ä¸­ä¼˜å…ˆçº§ï¼ˆP1 - é‡è¦åŠŸèƒ½ï¼‰

#### 3. å¯¹æ¯”æ–¹æ¡ˆæ¥å£
```
POST /planning-workbench/plans/compare
```
**åŠŸèƒ½**: å¯¹æ¯”å¤šä¸ªè§„åˆ’æ–¹æ¡ˆ  
**è¯·æ±‚å‚æ•°**:
```typescript
{
  planIds: string[];              // è¦å¯¹æ¯”çš„æ–¹æ¡ˆ ID åˆ—è¡¨ï¼ˆè‡³å°‘ 2 ä¸ªï¼‰
  compareFields?: string[];      // è¦å¯¹æ¯”çš„å­—æ®µï¼ˆé¢„ç®—ã€è·¯çº¿ã€æ—¶é—´ç­‰ï¼‰
}
```
**å“åº”æ•°æ®**:
```typescript
{
  success: true;
  data: {
    plans: PlanState[];
    differences: {
      field: string;
      plan1Value: any;
      plan2Value: any;
      impact: 'low' | 'medium' | 'high';
    }[];
    summary: {
      bestBudget: string;
      bestRoute: string;
      bestTime: string;
    };
  };
}
```

#### 4. è°ƒæ•´æ–¹æ¡ˆæ¥å£
```
POST /planning-workbench/plans/:planId/adjust
```
**åŠŸèƒ½**: åŸºäºç°æœ‰æ–¹æ¡ˆè¿›è¡Œè°ƒæ•´  
**è¯·æ±‚å‚æ•°**:
```typescript
{
  planId: string;
  adjustments: {
    type: 'add_place' | 'remove_place' | 'modify_constraint' | 'change_day';
    data: any;
  }[];
  regenerate?: boolean;          // æ˜¯å¦é‡æ–°ç”Ÿæˆæ–¹æ¡ˆ
}
```
**å“åº”æ•°æ®**:
```typescript
{
  success: true;
  data: {
    newPlanState: PlanState;
    uiOutput: UIOutput;
    changes: {
      type: string;
      description: string;
    }[];
  };
}
```

#### 5. è·å–æ–¹æ¡ˆåˆ—è¡¨æ¥å£
```
GET /planning-workbench/trips/:tripId/plans
```
**åŠŸèƒ½**: è·å–æŒ‡å®šè¡Œç¨‹çš„æ‰€æœ‰è§„åˆ’æ–¹æ¡ˆ  
**æŸ¥è¯¢å‚æ•°**:
```typescript
{
  status?: 'DRAFT' | 'PROPOSED' | 'LOCKED';
  limit?: number;
  offset?: number;
}
```
**å“åº”æ•°æ®**:
```typescript
{
  success: true;
  data: {
    plans: PlanState[];
    total: number;
    hasMore: boolean;
  };
}
```

### ä½ä¼˜å…ˆçº§ï¼ˆP2 - å¢å¼ºåŠŸèƒ½ï¼‰

#### 6. è·å–æ–¹æ¡ˆè¯¦æƒ…æ¥å£
```
GET /planning-workbench/plans/:planId
```
**åŠŸèƒ½**: è·å–æŒ‡å®šæ–¹æ¡ˆçš„è¯¦ç»†ä¿¡æ¯

#### 7. åˆ é™¤æ–¹æ¡ˆæ¥å£
```
DELETE /planning-workbench/plans/:planId
```
**åŠŸèƒ½**: åˆ é™¤æŒ‡å®šçš„è§„åˆ’æ–¹æ¡ˆ

#### 8. æ¢å¤æ–¹æ¡ˆæ¥å£
```
POST /planning-workbench/plans/:planId/restore
```
**åŠŸèƒ½**: æ¢å¤å·²åˆ é™¤çš„æ–¹æ¡ˆ

#### 9. æ–¹æ¡ˆç‰ˆæœ¬ç®¡ç†æ¥å£
```
GET /planning-workbench/plans/:planId/versions
```
**åŠŸèƒ½**: è·å–æ–¹æ¡ˆçš„ç‰ˆæœ¬å†å²

---

## ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼ˆç«‹å³å®ç°ï¼‰

1. âœ… **POST `/planning-workbench/execute`** - å·²å®ç°ï¼Œä½†éœ€è¦å®Œå–„ `commit`ã€`compare`ã€`adjust` æ“ä½œçš„æ”¯æŒ
2. ğŸ”´ **POST `/planning-workbench/plans/:planId/commit`** - æäº¤æ–¹æ¡ˆåŠŸèƒ½ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
3. ğŸ”´ **GET `/planning-workbench/trips/:tripId`** - è·å–å·¥ä½œå°æ•°æ®ï¼ˆé¡µé¢åŠ è½½å¿…éœ€ï¼‰

### ç¬¬äºŒé˜¶æ®µï¼ˆè¿‘æœŸå®ç°ï¼‰

4. ğŸŸ¡ **POST `/planning-workbench/plans/compare`** - å¯¹æ¯”æ–¹æ¡ˆåŠŸèƒ½ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
5. ğŸŸ¡ **POST `/planning-workbench/plans/:planId/adjust`** - è°ƒæ•´æ–¹æ¡ˆåŠŸèƒ½ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
6. ğŸŸ¡ **GET `/planning-workbench/trips/:tripId/plans`** - è·å–æ–¹æ¡ˆåˆ—è¡¨ï¼ˆé‡è¦åŠŸèƒ½ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼ˆæœªæ¥å¢å¼ºï¼‰

7. ğŸŸ¢ **GET `/planning-workbench/plans/:planId`** - è·å–æ–¹æ¡ˆè¯¦æƒ…
8. ğŸŸ¢ **DELETE `/planning-workbench/plans/:planId`** - åˆ é™¤æ–¹æ¡ˆ
9. ğŸŸ¢ **POST `/planning-workbench/plans/:planId/restore`** - æ¢å¤æ–¹æ¡ˆ
10. ğŸŸ¢ **GET `/planning-workbench/plans/:planId/versions`** - æ–¹æ¡ˆç‰ˆæœ¬ç®¡ç†

---

## æ¥å£å®ç°å»ºè®®

### 1. ç»Ÿä¸€æ¥å£è®¾è®¡

å»ºè®®æ‰€æœ‰è§„åˆ’å·¥ä½œå°ç›¸å…³çš„æ¥å£éƒ½éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

- **ç»Ÿä¸€å“åº”æ ¼å¼**: ä½¿ç”¨ `ApiResponseWrapper<T>` åŒ…è£…å“åº”
- **ç»Ÿä¸€é”™è¯¯å¤„ç†**: ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯ç å’Œé”™è¯¯æ¶ˆæ¯æ ¼å¼
- **ç»Ÿä¸€è®¤è¯**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦è®¤è¯ï¼ˆBearer Tokenï¼‰

### 2. æ¥å£è·¯å¾„è§„èŒƒ

å»ºè®®ä½¿ç”¨ä»¥ä¸‹è·¯å¾„è§„èŒƒï¼š

```
/planning-workbench/
  â”œâ”€â”€ execute                    # æ‰§è¡Œè§„åˆ’å·¥ä½œå°æµç¨‹ï¼ˆä¸»å…¥å£ï¼‰
  â”œâ”€â”€ state/:planId              # è·å–è§„åˆ’çŠ¶æ€
  â”œâ”€â”€ trips/:tripId              # è·å–å·¥ä½œå°æ•°æ®
  â”œâ”€â”€ trips/:tripId/plans        # è·å–æ–¹æ¡ˆåˆ—è¡¨
  â””â”€â”€ plans/
      â”œâ”€â”€ :planId                # è·å–æ–¹æ¡ˆè¯¦æƒ…
      â”œâ”€â”€ :planId/commit         # æäº¤æ–¹æ¡ˆ
      â”œâ”€â”€ :planId/adjust         # è°ƒæ•´æ–¹æ¡ˆ
      â”œâ”€â”€ :planId/versions       # æ–¹æ¡ˆç‰ˆæœ¬å†å²
      â”œâ”€â”€ compare                 # å¯¹æ¯”æ–¹æ¡ˆ
      â””â”€â”€ :planId/restore         # æ¢å¤æ–¹æ¡ˆ
```

### 3. æ•°æ®æ¨¡å‹å»ºè®®

å»ºè®®ä½¿ç”¨ä»¥ä¸‹æ•°æ®æ¨¡å‹ï¼š

```typescript
// è§„åˆ’æ–¹æ¡ˆ
interface Plan {
  planId: string;
  planVersion: number;
  tripId: string;
  status: 'DRAFT' | 'PROPOSED' | 'NEED_CONFIRM' | 'LOCKED';
  planState: PlanState;
  uiOutput: UIOutput;
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}

// æ–¹æ¡ˆå¯¹æ¯”ç»“æœ
interface PlanComparison {
  plans: Plan[];
  differences: PlanDifference[];
  summary: ComparisonSummary;
}

// æ–¹æ¡ˆè°ƒæ•´ç»“æœ
interface PlanAdjustment {
  planId: string;
  newPlanState: PlanState;
  uiOutput: UIOutput;
  changes: AdjustmentChange[];
}
```

---

## å‰ç«¯é›†æˆå»ºè®®

### 1. æ›´æ–° API å®¢æˆ·ç«¯

åœ¨ `src/api/planning-workbench.ts` ä¸­æ·»åŠ æ–°çš„æ¥å£æ–¹æ³•ï¼š

```typescript
export const planningWorkbenchApi = {
  // ç°æœ‰æ¥å£
  execute: async (data: ExecutePlanningWorkbenchRequest): Promise<ExecutePlanningWorkbenchResponse> => { ... },
  getState: async (planId: string): Promise<PlanState> => { ... },
  
  // æ–°å¢æ¥å£
  getWorkbenchData: async (tripId: string): Promise<WorkbenchData> => { ... },
  commitPlan: async (planId: string, tripId: string, options?: CommitOptions): Promise<CommitResult> => { ... },
  comparePlans: async (planIds: string[], options?: CompareOptions): Promise<PlanComparison> => { ... },
  adjustPlan: async (planId: string, adjustments: Adjustment[]): Promise<PlanAdjustment> => { ... },
  getPlans: async (tripId: string, options?: GetPlansOptions): Promise<Plan[]> => { ... },
};
```

### 2. æ›´æ–°å‰ç«¯ç»„ä»¶

åœ¨ä»¥ä¸‹ç»„ä»¶ä¸­é›†æˆæ–°æ¥å£ï¼š

- `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - æ·»åŠ æäº¤ã€å¯¹æ¯”ã€è°ƒæ•´åŠŸèƒ½
- `src/pages/plan-studio/OptimizeTab.tsx` - é›†æˆå¯¹æ¯”å’Œè°ƒæ•´åŠŸèƒ½
- `src/pages/plan-studio/WhatIfTab.tsx` - ä½¿ç”¨è§„åˆ’å·¥ä½œå°çš„å¯¹æ¯”æ¥å£

---

## æ€»ç»“

### å½“å‰çŠ¶æ€

- âœ… **å·²å®ç°**: 2 ä¸ªæ¥å£ï¼ˆexecute, getStateï¼‰
- âœ… **å‰ç«¯æ”¯æŒ**: execute æ¥å£çš„æ‰€æœ‰ 4 ç§ userActionï¼ˆgenerate, compare, commit, adjustï¼‰éƒ½å·²åœ¨å‰ç«¯å®ç°
- âŒ **ç¼ºå¤±**: 8+ ä¸ªæ¥å£ï¼ˆä¸“é—¨çš„ commit, compare, adjust æ¥å£ï¼ŒgetWorkbenchData ç­‰ï¼‰
- âš ï¸ **éƒ¨åˆ†å®ç°**: å¯¹æ¯”åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒè·å–æ–¹æ¡ˆåˆ—è¡¨æ‰èƒ½å®Œæ•´å®ç°

### å…³é”®ç¼ºå¤±

1. **æäº¤æ–¹æ¡ˆåŠŸèƒ½** - ç”¨æˆ·æ— æ³•å°†è§„åˆ’æ–¹æ¡ˆä¿å­˜åˆ°è¡Œç¨‹
2. **è·å–å·¥ä½œå°æ•°æ®** - é¡µé¢åŠ è½½æ—¶æ— æ³•è·å–å·²æœ‰æ•°æ®
3. **å¯¹æ¯”æ–¹æ¡ˆåŠŸèƒ½** - ç”¨æˆ·æ— æ³•å¯¹æ¯”å¤šä¸ªæ–¹æ¡ˆ
4. **è°ƒæ•´æ–¹æ¡ˆåŠŸèƒ½** - ç”¨æˆ·æ— æ³•åŸºäºç°æœ‰æ–¹æ¡ˆè¿›è¡Œè°ƒæ•´

### å»ºè®®è¡ŒåŠ¨

1. **ç«‹å³å®ç°**: æäº¤æ–¹æ¡ˆæ¥å£ã€è·å–å·¥ä½œå°æ•°æ®æ¥å£
2. **è¿‘æœŸå®ç°**: å¯¹æ¯”æ–¹æ¡ˆæ¥å£ã€è°ƒæ•´æ–¹æ¡ˆæ¥å£ã€è·å–æ–¹æ¡ˆåˆ—è¡¨æ¥å£
3. **æœªæ¥å¢å¼º**: æ–¹æ¡ˆç®¡ç†åŠŸèƒ½ï¼ˆåˆ é™¤ã€æ¢å¤ã€ç‰ˆæœ¬ç®¡ç†ï¼‰

---

**æ–‡æ¡£ç»´æŠ¤**: è¯·åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£ä»¥åæ˜ æœ€æ–°çš„æ¥å£å®ç°çŠ¶æ€ã€‚
