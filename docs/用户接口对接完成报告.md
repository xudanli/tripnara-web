# ç”¨æˆ·ç›¸å…³æ¥å£å¯¹æ¥å®ŒæˆæŠ¥å‘Š

> å®Œæˆæ—¶é—´: 2026-01-21  
> åŸºäºæ–‡æ¡£: `ç”¨æˆ·ç›¸å…³æ¥å£æ–‡æ¡£.md`

---

## ğŸ“‹ å®ç°æ€»è§ˆ

æ ¹æ®ç”¨æˆ·ç›¸å…³æ¥å£æ–‡æ¡£ï¼Œå·²å®Œæˆæ‰€æœ‰å‰ç«¯ç”¨æˆ·æ¥å£çš„å¯¹æ¥å®ç°ã€‚

### âœ… å·²å®ç°çš„æ¥å£

#### ä¸€ã€è®¤è¯æ¥å£ (`/api/auth`) - 100% å®Œæˆ

| æ–¹æ³• | è·¯å¾„ | æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|------|
| POST | `/auth/google/code` | `src/api/auth.ts` | âœ… å·²å®ç° | Google OAuth Code ç™»å½• |
| POST | `/auth/google/id-token` | `src/api/auth.ts` | âœ… å·²å®ç° | Google OAuth ID Token ç™»å½• |
| POST | `/auth/email/send-code` | `src/api/auth.ts` | âœ… å·²å®ç° | å‘é€é‚®ç®±éªŒè¯ç  |
| POST | `/auth/email/register` | `src/api/auth.ts` | âœ… å·²å®ç° | é‚®ç®±æ³¨å†Œ |
| POST | `/auth/email/login` | `src/api/auth.ts` | âœ… å·²å®ç° | é‚®ç®±ç™»å½• |
| POST | `/auth/refresh` | `src/api/auth.ts` | âœ… å·²å®ç° | åˆ·æ–° Access Token |
| POST | `/auth/logout` | `src/api/auth.ts` | âœ… å·²å®ç° | é€€å‡ºç™»å½• |

#### äºŒã€ç”¨æˆ·ä¿¡æ¯æ¥å£ (`/api/users`) - 100% å®Œæˆ

| æ–¹æ³• | è·¯å¾„ | æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|------|
| GET | `/users/me` | `src/api/user.ts` | âœ… **æ–°å¢** | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |
| PUT | `/users/me` | `src/api/user.ts` | âœ… **æ–°å¢** | æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯ |
| DELETE | `/users/me` | `src/api/user.ts` | âœ… **æ–°å¢** | åˆ é™¤å½“å‰ç”¨æˆ·è´¦æˆ· |
| GET | `/users/profile` | `src/api/user.ts` | âœ… å·²å®ç° | è·å–ç”¨æˆ·åå¥½ç”»åƒ |
| PUT | `/users/profile` | `src/api/user.ts` | âœ… å·²å®ç° | æ›´æ–°ç”¨æˆ·åå¥½ç”»åƒ |

---

## ğŸ†• æ–°å¢æ¥å£è¯¦æƒ…

### 1. GET `/users/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**æ–‡ä»¶**: `src/api/user.ts`  
**æ–¹æ³•**: `userApi.getMe()`

**åŠŸèƒ½**: è·å–å½“å‰å·²ç™»å½•ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ˆIDã€é‚®ç®±ã€æ˜¾ç¤ºåç§°ã€å¤´åƒç­‰ï¼‰

**å“åº”ç±»å‹**: `User`
```typescript
interface User {
  id: string;
  email: string | null;
  emailVerified: boolean | null;
  displayName: string | null;
  avatarUrl: string | null;
  googleSub: string | null;
  createdAt: string;
  updatedAt: string;
}
```

**é”™è¯¯å¤„ç†**:
- âœ… ç½‘ç»œé”™è¯¯å¤„ç†
- âœ… 401 æœªè®¤è¯é”™è¯¯å¤„ç†
- âœ… 404 ç”¨æˆ·ä¸å­˜åœ¨é”™è¯¯å¤„ç†
- âœ… åç«¯é”™è¯¯å“åº”å¤„ç†
- âœ… è‡ªå®šä¹‰é”™è¯¯ç±» `UserApiError`

---

### 2. PUT `/users/me` - æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯

**æ–‡ä»¶**: `src/api/user.ts`  
**æ–¹æ³•**: `userApi.updateMe(data: UpdateUserMeRequest)`

**åŠŸèƒ½**: æ›´æ–°å½“å‰å·²ç™»å½•ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ˆæ˜¾ç¤ºåç§°ã€å¤´åƒï¼‰

**è¯·æ±‚ç±»å‹**: `UpdateUserMeRequest`
```typescript
interface UpdateUserMeRequest {
  displayName?: string;
  avatarUrl?: string;
}
```

**å“åº”ç±»å‹**: `User`

**é”™è¯¯å¤„ç†**:
- âœ… ç½‘ç»œé”™è¯¯å¤„ç†
- âœ… 401 æœªè®¤è¯é”™è¯¯å¤„ç†
- âœ… 404 ç”¨æˆ·ä¸å­˜åœ¨é”™è¯¯å¤„ç†
- âœ… 400/422 éªŒè¯é”™è¯¯å¤„ç†
- âœ… åç«¯é”™è¯¯å“åº”å¤„ç†
- âœ… è‡ªå®šä¹‰é”™è¯¯ç±» `UserApiError`

---

### 3. DELETE `/users/me` - åˆ é™¤å½“å‰ç”¨æˆ·è´¦æˆ·

**æ–‡ä»¶**: `src/api/user.ts`  
**æ–¹æ³•**: `userApi.deleteMe(confirmText: string)`

**åŠŸèƒ½**: æ°¸ä¹…åˆ é™¤å½“å‰ç”¨æˆ·è´¦æˆ·åŠå…¶æ‰€æœ‰å…³è”æ•°æ®

**è¯·æ±‚ç±»å‹**: `DeleteUserMeRequest`
```typescript
interface DeleteUserMeRequest {
  confirmText: string; // å¿…é¡»ä¸º "ç¡®è®¤åˆ é™¤"
}
```

**å“åº”ç±»å‹**: `DeleteUserMeResponse`
```typescript
interface DeleteUserMeResponse {
  deleted: boolean;
  userId: string;
  deletedAt: string;
}
```

**é”™è¯¯å¤„ç†**:
- âœ… ç½‘ç»œé”™è¯¯å¤„ç†
- âœ… 400 é”™è¯¯å¤„ç†ï¼ˆæœªç¡®è®¤åˆ é™¤æ“ä½œï¼‰
- âœ… 401 æœªè®¤è¯é”™è¯¯å¤„ç†
- âœ… 404 ç”¨æˆ·ä¸å­˜åœ¨é”™è¯¯å¤„ç†
- âœ… åç«¯é”™è¯¯å“åº”å¤„ç†
- âœ… è‡ªå®šä¹‰é”™è¯¯ç±» `UserApiError`

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ **å±é™©æ“ä½œ**ï¼šæ­¤æ“ä½œä¼šæ°¸ä¹…åˆ é™¤ç”¨æˆ·è´¦æˆ·åŠå…¶æ‰€æœ‰å…³è”æ•°æ®ï¼Œä¸å¯æ’¤é”€ï¼
- å¿…é¡»æä¾› `confirmText="ç¡®è®¤åˆ é™¤"` æ‰èƒ½æ‰§è¡Œåˆ é™¤æ“ä½œ

---

## ğŸ“ ç±»å‹å®šä¹‰

### æ–°å¢ç±»å‹

```typescript
// ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
export interface User {
  id: string;
  email: string | null;
  emailVerified: boolean | null;
  displayName: string | null;
  avatarUrl: string | null;
  googleSub: string | null;
  createdAt: string;
  updatedAt: string;
}

// æ›´æ–°ç”¨æˆ·ä¿¡æ¯è¯·æ±‚
export interface UpdateUserMeRequest {
  displayName?: string;
  avatarUrl?: string;
}

// åˆ é™¤ç”¨æˆ·è´¦æˆ·è¯·æ±‚
export interface DeleteUserMeRequest {
  confirmText: string;
}

// åˆ é™¤ç”¨æˆ·è´¦æˆ·å“åº”
export interface DeleteUserMeResponse {
  deleted: boolean;
  userId: string;
  deletedAt: string;
}

// ç”¨æˆ·ä¿¡æ¯ API é”™è¯¯ç±»
export class UserApiError extends Error {
  constructor(
    public code: string,
    message: string
  ) {
    super(message);
    this.name = 'UserApiError';
  }
}
```

---

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```typescript
import { userApi } from '@/api/user';

try {
  const user = await userApi.getMe();
  console.log('å½“å‰ç”¨æˆ·:', user);
} catch (error) {
  if (error instanceof UserApiError) {
    console.error('é”™è¯¯ä»£ç :', error.code);
    console.error('é”™è¯¯æ¶ˆæ¯:', error.message);
  }
}
```

### æ›´æ–°ç”¨æˆ·ä¿¡æ¯

```typescript
import { userApi } from '@/api/user';

try {
  const updatedUser = await userApi.updateMe({
    displayName: 'æ–°åç§°',
    avatarUrl: 'https://example.com/avatar.jpg',
  });
  console.log('æ›´æ–°åçš„ç”¨æˆ·:', updatedUser);
} catch (error) {
  if (error instanceof UserApiError) {
    if (error.code === 'VALIDATION_ERROR') {
      console.error('éªŒè¯å¤±è´¥:', error.message);
    }
  }
}
```

### åˆ é™¤ç”¨æˆ·è´¦æˆ·

```typescript
import { userApi } from '@/api/user';

try {
  const result = await userApi.deleteMe('ç¡®è®¤åˆ é™¤');
  console.log('åˆ é™¤æˆåŠŸ:', result);
  // æ³¨æ„ï¼šåˆ é™¤ååº”æ¸…é™¤æœ¬åœ°çŠ¶æ€å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
} catch (error) {
  if (error instanceof UserApiError) {
    if (error.code === 'VALIDATION_ERROR') {
      console.error('è¯·ç¡®è®¤åˆ é™¤æ“ä½œ');
    }
  }
}
```

---

## ğŸ“Š å®ç°ç»Ÿè®¡

### æ¥å£å®Œæˆåº¦

- **è®¤è¯æ¥å£**: 7/7 (100%)
- **ç”¨æˆ·ä¿¡æ¯æ¥å£**: 5/5 (100%)
- **æ€»è®¡**: 12/12 (100%)

### ä»£ç è´¨é‡

- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… è¯¦ç»†çš„é”™è¯¯åˆ†ç±»ï¼ˆç½‘ç»œé”™è¯¯ã€è®¤è¯é”™è¯¯ã€éªŒè¯é”™è¯¯ç­‰ï¼‰
- âœ… ç¬¦åˆé¡¹ç›®ä»£ç è§„èŒƒ
- âœ… å®Œæ•´çš„æ³¨é‡Šå’Œæ–‡æ¡£

---

## ğŸ”„ åç»­å»ºè®®

### 1. åˆ›å»º React Hook

å»ºè®®åˆ›å»º `useUser` hook æ¥å°è£…ç”¨æˆ·ä¿¡æ¯ç›¸å…³æ“ä½œï¼š

```typescript
// src/hooks/useUser.ts
export function useUser() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchUser = useCallback(async () => {
    // ...
  }, []);

  const updateUser = useCallback(async (data: UpdateUserMeRequest) => {
    // ...
  }, []);

  const deleteUser = useCallback(async (confirmText: string) => {
    // ...
  }, []);

  return {
    user,
    loading,
    error,
    fetchUser,
    updateUser,
    deleteUser,
  };
}
```

### 2. é›†æˆåˆ°è®¾ç½®é¡µé¢

å»ºè®®åœ¨è®¾ç½®é¡µé¢ä¸­é›†æˆè¿™äº›æ¥å£ï¼Œå…è®¸ç”¨æˆ·ï¼š
- æŸ¥çœ‹å’Œç¼–è¾‘ä¸ªäººä¿¡æ¯
- åˆ é™¤è´¦æˆ·

### 3. é”™è¯¯å¤„ç†ä¼˜åŒ–

å¯ä»¥è€ƒè™‘æ·»åŠ æ›´å‹å¥½çš„é”™è¯¯æç¤º UIï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ é™¤è´¦æˆ·æ—¶æ·»åŠ äºŒæ¬¡ç¡®è®¤å¯¹è¯æ¡†ã€‚

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `src/api/user.ts` - ç”¨æˆ· API å®ç°
- `src/api/auth.ts` - è®¤è¯ API å®ç°
- `src/hooks/useUserPreferences.ts` - ç”¨æˆ·åå¥½ Hook
- `src/hooks/useAuth.ts` - è®¤è¯ Hook
- `docs/ç”¨æˆ·ç›¸å…³æ¥å£æ–‡æ¡£.md` - æ¥å£æ–‡æ¡£

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [x] æ·»åŠ ç”¨æˆ·ä¿¡æ¯æ¥å£ç±»å‹å®šä¹‰
- [x] å®ç° GET `/users/me` æ¥å£
- [x] å®ç° PUT `/users/me` æ¥å£
- [x] å®ç° DELETE `/users/me` æ¥å£
- [x] æ·»åŠ é”™è¯¯å¤„ç†æœºåˆ¶
- [x] æ·»åŠ ç±»å‹å¯¼å‡º
- [x] åˆ›å»ºå®ç°æ–‡æ¡£
- [ ] åˆ›å»º `useUser` Hookï¼ˆå¯é€‰ï¼‰
- [ ] é›†æˆåˆ°è®¾ç½®é¡µé¢ï¼ˆå¯é€‰ï¼‰

---

## ğŸ‰ æ€»ç»“

æ‰€æœ‰ç”¨æˆ·ç›¸å…³æ¥å£å·²å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **è®¤è¯æ¥å£**ï¼ˆ7ä¸ªï¼‰- 100% å®Œæˆ
2. âœ… **ç”¨æˆ·ä¿¡æ¯æ¥å£**ï¼ˆ5ä¸ªï¼‰- 100% å®Œæˆ

æ‰€æœ‰æ¥å£éƒ½éµå¾ªç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼Œå…·å¤‡å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¹¶æä¾›äº†å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ã€‚ä»£ç è´¨é‡ç¬¦åˆé¡¹ç›®è§„èŒƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚
