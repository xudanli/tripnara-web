# 预算功能页面展示设计方案

> 生成时间: 2025-01-XX  
> 设计范围: 行程详情页、执行页面、规划工作台页面  
> 参考实现: `src/pages/trips/[id].tsx`、`src/pages/plan-studio/PlanningWorkbenchTab.tsx`、`src/pages/trips/budget.tsx`

---

## 📋 设计概览

本文档设计预算功能在以下三个关键页面中的展示位置和交互方式：

1. **行程详情页** (`src/pages/trips/[id].tsx`)
2. **执行页面** (行程详情页的"执行"标签页)
3. **规划工作台页面** (`src/pages/plan-studio/PlanningWorkbenchTab.tsx`)

---

## 🎯 设计原则

1. **渐进式展示**：从概览到详情，从总览到执行
2. **上下文相关**：根据页面场景展示最相关的预算信息
3. **可操作性**：关键位置提供快速操作入口
4. **一致性**：统一的视觉风格和交互模式
5. **TripNARA 集成**：预算评估结果与三人格决策系统集成

---

## 📄 一、行程详情页（Trip Detail Page）

### 1.1 总览标签页（Overview Tab）

#### ✅ 已实现
- **预算标签页**：独立的预算管理页面（第1557-1560行）
- **行程健康度卡片**：预算维度显示（第1645-1684行）
  - 预算维度可点击跳转到预算标签页
  - 显示预算健康度分数（0-100）
  - 显示预算相关问题列表

#### 🔧 建议增强

**1. 预算概览卡片（新增）**
- **位置**：总览标签页左侧区域，行程信息卡片下方
- **组件**：`BudgetOverviewCard`
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ 预算概览                    [设置] │
  ├─────────────────────────────────┤
  │ 总预算: ¥10,000                │
  │ 已支出: ¥3,500  (35%)           │
  │ 剩余: ¥6,500                    │
  │                                 │
  │ [进度条: ████████░░░░░░░░]      │
  │                                 │
  │ 今日支出: ¥500                 │
  │ 日均支出: ¥350                 │
  │                                 │
  │ [查看详情 →]                    │
  └─────────────────────────────────┘
  ```
- **交互**：
  - 点击"设置"按钮：打开预算约束设置对话框
  - 点击"查看详情"：跳转到预算标签页
  - 进度条颜色：绿色（<60%）、黄色（60-80%）、红色（>80%）

**2. 预算预警提示（新增）**
- **位置**：总览标签页顶部，行程健康度卡片下方
- **触发条件**：
  - 预算使用率超过预警阈值（默认80%）
  - 预算不足风险（预计总支出超过预算）
  - 预算约束未设置
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ ⚠️ 预算预警                      │
  │ 当前预算使用率已达 85%，建议检查 │
  │ 预算明细或调整预算约束。         │
  │ [查看预算详情] [设置预算约束]   │
  └─────────────────────────────────┘
  ```

**3. 行程健康度卡片增强**
- **当前实现**：已显示预算维度分数和问题列表
- **建议增强**：
  - 预算维度显示预算使用率百分比
  - 点击预算维度时，高亮显示预算相关问题
  - 添加预算评估状态图标（✓ 通过 / ⚠️ 警告 / ✗ 拒绝）

---

### 1.2 规划标签页（Plan Tab）

#### ✅ 已实现
- 无预算相关展示

#### 🔧 建议新增

**1. 每日预算概览（新增）**
- **位置**：每日行程卡片（`DayItineraryCard`）右上角
- **展示内容**：
  ```
  Day 1 - 2025-01-15
  ┌─────────────────────────────────┐
  │ 📍 地点1  [预算: ¥500/¥800]     │
  │ 📍 地点2  [预算: ¥300/¥500]     │
  │                                 │
  │ 当日预算: ¥1,300 / ¥1,500     │
  │ [进度条]                        │
  └─────────────────────────────────┘
  ```
- **交互**：
  - 点击预算信息：展开当日预算明细
  - 超预算时显示警告图标

**2. 行程项预算标签（新增）**
- **位置**：每个行程项（`ItineraryItem`）卡片中
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ 🏛️ 景点名称                      │
  │ 时间: 10:00 - 12:00            │
  │ 💰 预算: ¥200                  │
  │ [其他信息...]                   │
  └─────────────────────────────────┘
  ```
- **交互**：
  - 点击预算标签：显示该行程项的预算详情
  - 预算超支时显示红色警告

---

### 1.3 执行标签页（Execute Tab）

#### ✅ 当前状态
- 执行标签页仅在 `IN_PROGRESS` 或 `COMPLETED` 状态时显示（第1543-1548行）

#### 🔧 建议新增

**1. 实时预算监控卡片（新增）**
- **位置**：执行标签页顶部，当日行程卡片上方
- **组件**：`BudgetMonitorCard`
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ 💰 实时预算监控                  │
  ├─────────────────────────────────┤
  │ 今日已支出: ¥850                │
  │ 今日预算: ¥1,000               │
  │ 剩余: ¥150  (85% 已使用)        │
  │                                 │
  │ [进度条: ████████████░░]        │
  │                                 │
  │ 预计今日总支出: ¥1,200          │
  │ ⚠️ 预计超支 ¥200                │
  │                                 │
  │ [查看明细] [调整预算]           │
  └─────────────────────────────────┘
  ```
- **数据来源**：`GET /trips/:id/budget/monitor`（实时监控接口）
- **更新频率**：每5秒自动刷新
- **交互**：
  - 超支预警时显示警告提示
  - 点击"查看明细"：跳转到预算标签页的监控标签
  - 点击"调整预算"：打开预算约束设置对话框

**2. 支出记录快速添加（新增）**
- **位置**：执行标签页，每个行程项卡片中
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ ✅ 已完成 - 景点名称             │
  │ 时间: 10:00 - 12:00            │
  │ 💰 实际支出: ¥180  [编辑]      │
  │ 预算: ¥200  (节省 ¥20)         │
  └─────────────────────────────────┘
  ```
- **交互**：
  - 点击"编辑"：快速编辑实际支出金额
  - 显示预算对比（节省/超支）

**3. 预算执行统计（新增）**
- **位置**：执行标签页底部
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ 📊 预算执行统计                  │
  ├─────────────────────────────────┤
  │ 总预算: ¥10,000                │
  │ 已支出: ¥3,500  (35%)          │
  │ 预计总支出: ¥9,800             │
  │ 预计节省: ¥200                 │
  │                                 │
  │ 分类占比:                       │
  │ 住宿: 40%  ████████            │
  │ 交通: 25%  █████               │
  │ 餐饮: 20%  ████                │
  │ 活动: 10%  ██                  │
  │ 其他: 5%   █                   │
  │                                 │
  │ [查看详细统计]                  │
  └─────────────────────────────────┘
  ```
- **数据来源**：`GET /trips/:id/budget/statistics`

---

### 1.4 预算标签页（Budget Tab）

#### ✅ 已实现
- 完整的预算管理页面（`TripBudgetPage`）
- 5个子标签页：概览、明细、趋势、统计、监控

#### 🔧 建议优化

**1. 预算约束快速设置**
- **位置**：预算标签页顶部，概览卡片上方
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ ⚙️ 预算约束设置                  │
  │ 当前状态: 已设置 / 未设置        │
  │ 总预算: ¥10,000                │
  │ [编辑约束] [删除约束]           │
  └─────────────────────────────────┘
  ```

**2. 预算评估结果展示**
- **位置**：预算标签页顶部，约束设置下方
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ ✅ 预算评估通过                  │
  │ 当前方案符合预算约束             │
  │                                 │
  │ Abu: 预算合理性 ✓               │
  │ Dr.Dre: 预算节奏 ✓              │
  │ Neptune: 预算结构 ✓            │
  │                                 │
  │ [查看评估详情] [查看决策日志]   │
  └─────────────────────────────────┘
  ```
- **数据来源**：`GET /planning-workbench/plans/:planId/budget-evaluation`

---

## 📄 二、执行页面（Execute Page）

> 注：执行页面是行程详情页的一个标签页，已在上述"1.3 执行标签页"中设计

### 2.1 执行页面特殊需求

**1. 离线支持**
- 预算数据本地缓存
- 支出记录离线保存
- 网络恢复后自动同步

**2. 快速操作**
- 一键记录支出
- 语音输入支出金额
- 拍照记录收据（未来功能）

**3. 实时提醒**
- 预算超支提醒（推送通知）
- 每日预算使用率提醒
- 预算不足预警

---

## 📄 三、规划工作台页面（Planning Workbench Page）

### 3.1 方案预览区域

#### ✅ 已实现
- 预算评估结果卡片（第1167-1470行）
- 预算评估裁决显示
- 应用优化建议按钮
- 查看决策日志按钮

#### 🔧 建议增强

**1. 预算评估结果卡片增强**
- **当前实现**：显示裁决、违规项、建议
- **建议增强**：
  ```
  ┌─────────────────────────────────┐
  │ 💰 预算评估结果                  │
  ├─────────────────────────────────┤
  │ 裁决: ⚠️ 需要调整                │
  │ 置信度: 85%                     │
  │                                 │
  │ 📊 预算对比:                    │
  │ 总预算: ¥10,000                │
  │ 预计支出: ¥11,200              │
  │ 超支: ¥1,200  (12%)            │
  │                                 │
  │ ⚠️ 违规项:                      │
  │ • 住宿超支 ¥800                 │
  │ • 交通超支 ¥400                │
  │                                 │
  │ 💡 优化建议:                    │
  │ • 调整住宿档位（节省 ¥600）     │
  │ • 优化交通方案（节省 ¥300）     │
  │                                 │
  │ [应用优化建议] [查看决策日志]   │
  └─────────────────────────────────┘
  ```

**2. 三人格预算评估展示**
- **位置**：预算评估结果卡片下方
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ 👤 三人格预算评估                │
  ├─────────────────────────────────┤
  │ [Abu] 预算合理性: ⚠️ 需要调整   │
  │ "住宿预算超支，建议调整档位"    │
  │                                 │
  │ [Dr.Dre] 预算节奏: ✓ 合理       │
  │ "日均支出在合理范围内"          │
  │                                 │
  │ [Neptune] 预算结构: ⚠️ 需优化   │
  │ "建议优化交通方案以节省成本"    │
  └─────────────────────────────────┘
  ```
- **数据来源**：`GET /planning-workbench/budget/decision-log`

**3. 预算约束设置集成**
- **位置**：规划工作台顶部，执行按钮旁边
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ [执行规划] [设置预算约束]       │
  └─────────────────────────────────┘
  ```
- **交互**：
  - 点击"设置预算约束"：打开预算约束设置对话框
  - 设置后自动应用到规划上下文

---

### 3.2 方案对比区域

#### 🔧 建议新增

**1. 预算对比维度**
- **位置**：方案对比结果中
- **展示内容**：
  ```
  ┌─────────────────────────────────┐
  │ 📊 方案对比 - 预算维度            │
  ├─────────────────────────────────┤
  │ 方案A: ¥9,800  (节省 ¥200)     │
  │ 方案B: ¥10,500 (超支 ¥500)      │
  │ 方案C: ¥9,500  (节省 ¥500)      │
  │                                 │
  │ [按预算排序] [查看详情]         │
  └─────────────────────────────────┘
  ```

---

### 3.3 意图设置标签页（Intent Tab）

#### ✅ 已实现
- 预算设置（`totalBudget` 字段）

#### 🔧 建议增强

**1. 预算约束详细设置**
- **当前实现**：仅设置总预算
- **建议增强**：
  ```
  ┌─────────────────────────────────┐
  │ 💰 预算约束设置                  │
  ├─────────────────────────────────┤
  │ 总预算: ¥10,000  [必填]         │
  │ 货币: CNY                       │
  │                                 │
  │ 日均预算: ¥500  [可选]          │
  │                                 │
  │ 分类预算限制:                   │
  │ 住宿: ¥4,000                   │
  │ 交通: ¥2,500                   │
  │ 餐饮: ¥2,000                   │
  │ 活动: ¥1,000                   │
  │ 其他: ¥500                     │
  │                                 │
  │ 预警阈值: 80%                  │
  │                                 │
  │ [保存] [重置]                   │
  └─────────────────────────────────┘
  ```
- **数据来源**：`POST /trips/:id/budget/constraint`

---

## 📊 四、预算展示优先级

### 4.1 展示优先级矩阵

| 页面 | 位置 | 优先级 | 展示内容 | 数据来源 |
|------|------|--------|----------|----------|
| 行程详情页 | 总览标签页 | 🔴 高 | 预算概览卡片 | `GET /trips/:id/budget/summary` |
| 行程详情页 | 总览标签页 | 🔴 高 | 预算预警提示 | `GET /trips/:id/budget/monitor` |
| 行程详情页 | 规划标签页 | 🟡 中 | 每日预算概览 | `GET /trips/:id/budget/details` |
| 行程详情页 | 执行标签页 | 🔴 高 | 实时预算监控 | `GET /trips/:id/budget/monitor` |
| 行程详情页 | 执行标签页 | 🟡 中 | 支出记录快速添加 | `POST /trips/:id/budget/details` |
| 规划工作台 | 方案预览 | 🔴 高 | 预算评估结果 | `GET /planning-workbench/plans/:planId/budget-evaluation` |
| 规划工作台 | 方案预览 | 🟡 中 | 三人格预算评估 | `GET /planning-workbench/budget/decision-log` |
| 规划工作台 | 意图设置 | 🟡 中 | 预算约束详细设置 | `POST /trips/:id/budget/constraint` |

---

## 🎨 五、视觉设计规范

### 5.1 颜色规范

- **预算正常**：绿色 (`bg-green-500`, `text-green-600`)
- **预算警告**：黄色 (`bg-yellow-500`, `text-yellow-600`)
- **预算超支**：红色 (`bg-red-500`, `text-red-600`)
- **预算节省**：蓝色 (`bg-blue-500`, `text-blue-600`)

### 5.2 图标规范

- **预算总览**：`Wallet` (lucide-react)
- **预算监控**：`Activity` (lucide-react)
- **预算统计**：`BarChart3` (lucide-react)
- **预算趋势**：`TrendingUp` (lucide-react)
- **预算设置**：`Settings2` (lucide-react)
- **预算警告**：`AlertTriangle` (lucide-react)

### 5.3 组件规范

- **卡片组件**：使用 `Card`、`CardHeader`、`CardTitle`、`CardContent`
- **按钮组件**：使用 `Button`（primary/outline/ghost 变体）
- **进度条**：使用 `Progress` 组件
- **徽章**：使用 `Badge` 组件显示状态

---

## 🔄 六、交互流程

### 6.1 预算设置流程

```
用户进入行程详情页
  ↓
点击"设置预算约束"
  ↓
打开预算约束设置对话框
  ↓
填写总预算、分类预算、预警阈值
  ↓
保存预算约束
  ↓
自动刷新预算概览卡片
  ↓
显示预算评估结果（如有方案）
```

### 6.2 预算监控流程

```
用户进入执行标签页
  ↓
自动加载实时预算监控数据
  ↓
每5秒自动刷新监控数据
  ↓
检测到预算超支
  ↓
显示预算预警提示
  ↓
用户点击"查看明细"
  ↓
跳转到预算标签页的监控标签
```

### 6.3 预算评估流程

```
用户在规划工作台生成方案
  ↓
自动调用预算评估接口
  ↓
显示预算评估结果卡片
  ↓
用户查看三人格评估意见
  ↓
用户选择应用优化建议
  ↓
生成新方案并重新评估预算
```

---

## 📝 七、实施建议

### 7.1 实施优先级

**Phase 1（高优先级）**：
1. ✅ 行程详情页总览标签页 - 预算概览卡片
2. ✅ 行程详情页总览标签页 - 预算预警提示
3. ✅ 执行标签页 - 实时预算监控卡片
4. ✅ 规划工作台 - 预算评估结果卡片增强

**Phase 2（中优先级）**：
5. 规划标签页 - 每日预算概览
6. 执行标签页 - 支出记录快速添加
7. 规划工作台 - 三人格预算评估展示
8. 意图设置标签页 - 预算约束详细设置

**Phase 3（低优先级）**：
9. 规划标签页 - 行程项预算标签
10. 执行标签页 - 预算执行统计
11. 规划工作台 - 方案对比预算维度

### 7.2 技术实现

**组件创建**：
- `BudgetOverviewCard.tsx` - 预算概览卡片
- `BudgetMonitorCard.tsx` - 实时预算监控卡片
- `BudgetAlertBanner.tsx` - 预算预警提示
- `BudgetEvaluationCard.tsx` - 预算评估结果卡片（增强版）
- `PersonaBudgetEvaluation.tsx` - 三人格预算评估展示

**API 集成**：
- 使用现有预算 API（`src/api/trips.ts`、`src/api/planning-workbench.ts`）
- 添加数据缓存和自动刷新逻辑
- 实现错误处理和降级策略

**状态管理**：
- 使用 React Hooks（`useState`、`useEffect`）
- 实现数据共享（通过 Context 或 Props）

---

## ✅ 八、验收标准

### 8.1 功能验收

1. ✅ 预算概览卡片正确显示预算数据
2. ✅ 预算预警提示在超支时正确显示
3. ✅ 实时预算监控每5秒自动刷新
4. ✅ 预算评估结果正确显示三人格评估意见
5. ✅ 预算约束设置功能正常

### 8.2 交互验收

1. ✅ 点击预算相关按钮正确跳转
2. ✅ 预算数据更新后界面自动刷新
3. ✅ 预算超支时显示警告提示
4. ✅ 预算设置对话框正常打开和关闭

### 8.3 性能验收

1. ✅ 预算数据加载时间 < 500ms
2. ✅ 实时监控刷新不影响页面性能
3. ✅ 预算评估接口响应时间 < 2s

---

## 📚 九、参考文档

- `docs/预算功能接口需求清单.md` - 预算接口完整清单
- `docs/预算功能完整实现总结.md` - 预算功能实现总结
- `src/pages/trips/budget.tsx` - 预算页面实现
- `src/pages/plan-studio/PlanningWorkbenchTab.tsx` - 规划工作台实现
- `src/api/planning-workbench.ts` - 规划工作台 API
- `src/api/trips.ts` - 行程 API
