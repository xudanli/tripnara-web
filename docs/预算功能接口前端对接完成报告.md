# é¢„ç®—åŠŸèƒ½æ¥å£å‰ç«¯å¯¹æ¥å®ŒæˆæŠ¥å‘Š

> ç”Ÿæˆæ—¶é—´: 2025-01-XX  
> å¯¹æ¥çŠ¶æ€: âœ… å·²å®Œæˆ  
> åŸºäºæ–‡æ¡£: [é¢„ç®—åŠŸèƒ½æ¥å£å®ç°æ€»ç»“](./é¢„ç®—åŠŸèƒ½æ¥å£å®ç°æ€»ç»“.md)

---

## ğŸ“‹ å¯¹æ¥æ¦‚è§ˆ

æ ¹æ®åç«¯å®ç°çš„é¢„ç®—åŠŸèƒ½æ¥å£ï¼Œå‰ç«¯å·²å®Œæˆæ‰€æœ‰æ¥å£çš„å¯¹æ¥å·¥ä½œï¼ŒåŒ…æ‹¬ç±»å‹å®šä¹‰ã€API è°ƒç”¨æ–¹æ³•ç­‰ã€‚

### âœ… å·²å¯¹æ¥çš„æ¥å£ï¼ˆ13ä¸ªï¼‰

#### é¢„ç®—çº¦æŸç®¡ç†æ¥å£ï¼ˆ3ä¸ªï¼‰
1. âœ… **POST /trips/:id/budget/constraint** - è®¾ç½®é¢„ç®—çº¦æŸ
2. âœ… **GET /trips/:id/budget/constraint** - è·å–é¢„ç®—çº¦æŸ
3. âœ… **DELETE /trips/:id/budget/constraint** - åˆ é™¤é¢„ç®—çº¦æŸ

#### é¢„ç®—æŸ¥è¯¢ä¸åˆ†ææ¥å£ï¼ˆ5ä¸ªï¼‰
4. âœ… **GET /trips/:id/budget/summary** - è·å–é¢„ç®—æ‘˜è¦ï¼ˆå·²å¢å¼ºï¼Œæ”¯æŒæ—¶é—´èŒƒå›´å’Œåˆ†ç±»ç­›é€‰ï¼‰
5. âœ… **GET /trips/:id/budget/details** - è·å–é¢„ç®—æ˜ç»†ï¼ˆæ–°å¢ï¼‰
6. âœ… **GET /trips/:id/budget/trends** - è·å–é¢„ç®—è¶‹åŠ¿ï¼ˆæ–°å¢ï¼‰
7. âœ… **GET /trips/:id/budget/report** - è·å–é¢„ç®—æŠ¥å‘Šï¼ˆå·²å­˜åœ¨ï¼‰
8. âœ… **GET /trips/:id/budget/statistics** - è·å–é¢„ç®—æ‰§è¡Œç»Ÿè®¡ï¼ˆæ–°å¢ï¼‰

#### é¢„ç®—å†³ç­–é—¨æ§æ¥å£ï¼ˆ2ä¸ªï¼‰
9. âœ… **POST /planning-workbench/budget/evaluate** - é¢„ç®—åˆç†æ€§è¯„ä¼°ï¼ˆæ–°å¢ï¼‰
10. âœ… **GET /planning-workbench/budget/decision-log** - é¢„ç®—å†³ç­–æ—¥å¿—ï¼ˆæ–°å¢ï¼‰

#### é¢„ç®—ä¼˜åŒ–å»ºè®®æ¥å£ï¼ˆ1ä¸ªï¼‰
11. âœ… **POST /planning-workbench/budget/apply-optimization** - åº”ç”¨ä¼˜åŒ–å»ºè®®ï¼ˆæ–°å¢ï¼‰

#### é¢„ç®—æ‰§è¡Œç›‘æ§æ¥å£ï¼ˆ1ä¸ªï¼‰
12. âœ… **GET /trips/:id/budget/monitor** - å®æ—¶é¢„ç®—ç›‘æ§ï¼ˆæ–°å¢ï¼‰

#### è§„åˆ’å·¥ä½œå°é›†æˆæ¥å£ï¼ˆ1ä¸ªï¼‰
13. âœ… **GET /planning-workbench/plans/:planId/budget-evaluation** - è§„åˆ’å·¥ä½œå°é¢„ç®—è¯„ä¼°ç»“æœï¼ˆæ–°å¢ï¼‰

---

## ğŸ“ æ–‡ä»¶å˜æ›´

### ä¿®æ”¹çš„æ–‡ä»¶

#### 1. **src/types/trip.ts**

**æ–°å¢ç±»å‹å®šä¹‰**ï¼š

- `SetBudgetConstraintRequest` - è®¾ç½®é¢„ç®—çº¦æŸè¯·æ±‚
- `SetBudgetConstraintResponse` - è®¾ç½®é¢„ç®—çº¦æŸå“åº”
- `GetBudgetConstraintResponse` - è·å–é¢„ç®—çº¦æŸå“åº”
- `DeleteBudgetConstraintResponse` - åˆ é™¤é¢„ç®—çº¦æŸå“åº”
- `BudgetDetailsItem` - é¢„ç®—æ˜ç»†é¡¹
- `BudgetDetailsResponse` - è·å–é¢„ç®—æ˜ç»†å“åº”
- `BudgetTrendsResponse` - è·å–é¢„ç®—è¶‹åŠ¿å“åº”
- `BudgetStatisticsResponse` - é¢„ç®—æ‰§è¡Œç»Ÿè®¡å“åº”
- `BudgetMonitorResponse` - å®æ—¶é¢„ç®—ç›‘æ§å“åº”
- `BudgetViolation` - é¢„ç®—è¯„ä¼°è¿è§„é¡¹
- `BudgetRecommendation` - é¢„ç®—è¯„ä¼°å»ºè®®
- `BudgetEvaluationResponse` - é¢„ç®—è¯„ä¼°å“åº”
- `BudgetDecisionLogItem` - é¢„ç®—å†³ç­–æ—¥å¿—é¡¹
- `BudgetDecisionLogResponse` - é¢„ç®—å†³ç­–æ—¥å¿—å“åº”
- `ApplyBudgetOptimizationRequest` - åº”ç”¨é¢„ç®—ä¼˜åŒ–å»ºè®®è¯·æ±‚
- `ApplyBudgetOptimizationResponse` - åº”ç”¨é¢„ç®—ä¼˜åŒ–å»ºè®®å“åº”
- `PlanBudgetEvaluationResponse` - è§„åˆ’æ–¹æ¡ˆé¢„ç®—è¯„ä¼°å“åº”

#### 2. **src/api/planning-workbench.ts**

**æ‰©å±•ç±»å‹å®šä¹‰**ï¼š

- `BudgetConstraint` - æ‰©å±•äº†å­—æ®µï¼š
  - `dailyBudget?: number` - æ—¥å‡é¢„ç®—
  - `categoryLimits?: {...}` - åˆ†ç±»é¢„ç®—é™åˆ¶
  - `alertThreshold?: number` - é¢„è­¦é˜ˆå€¼
  - `createdAt?: string` - åˆ›å»ºæ—¶é—´
  - `updatedAt?: string` - æ›´æ–°æ—¶é—´

**æ–°å¢ API æ–¹æ³•**ï¼š

- `evaluateBudget()` - é¢„ç®—åˆç†æ€§è¯„ä¼°
- `getBudgetDecisionLog()` - è·å–é¢„ç®—å†³ç­–æ—¥å¿—
- `applyBudgetOptimization()` - åº”ç”¨é¢„ç®—ä¼˜åŒ–å»ºè®®
- `getPlanBudgetEvaluation()` - è·å–è§„åˆ’æ–¹æ¡ˆé¢„ç®—è¯„ä¼°ç»“æœ

#### 3. **src/api/trips.ts**

**å¢å¼ºç°æœ‰æ–¹æ³•**ï¼š

- `getBudgetSummary()` - æ–°å¢æ”¯æŒæ—¶é—´èŒƒå›´å’Œåˆ†ç±»ç­›é€‰å‚æ•°

**æ–°å¢ API æ–¹æ³•**ï¼š

- `setBudgetConstraint()` - è®¾ç½®é¢„ç®—çº¦æŸ
- `getBudgetConstraint()` - è·å–é¢„ç®—çº¦æŸ
- `deleteBudgetConstraint()` - åˆ é™¤é¢„ç®—çº¦æŸ
- `getBudgetDetails()` - è·å–é¢„ç®—æ˜ç»†
- `getBudgetTrends()` - è·å–é¢„ç®—è¶‹åŠ¿
- `getBudgetStatistics()` - è·å–é¢„ç®—æ‰§è¡Œç»Ÿè®¡
- `getBudgetMonitor()` - è·å–å®æ—¶é¢„ç®—ç›‘æ§

---

## ğŸ”§ æ¥å£ä½¿ç”¨ç¤ºä¾‹

### é¢„ç®—çº¦æŸç®¡ç†

```typescript
import { tripsApi } from '@/api/trips';

// è®¾ç½®é¢„ç®—çº¦æŸ
const constraint = await tripsApi.setBudgetConstraint(tripId, {
  total: 50000,
  currency: 'CNY',
  dailyBudget: 5000,
  categoryLimits: {
    accommodation: 20000,
    transportation: 10000,
    food: 10000,
    activities: 8000,
    other: 2000,
  },
  alertThreshold: 0.8,
});

// è·å–é¢„ç®—çº¦æŸ
const currentConstraint = await tripsApi.getBudgetConstraint(tripId);

// åˆ é™¤é¢„ç®—çº¦æŸ
await tripsApi.deleteBudgetConstraint(tripId);
```

### é¢„ç®—æŸ¥è¯¢ä¸åˆ†æ

```typescript
// è·å–é¢„ç®—æ‘˜è¦ï¼ˆæ”¯æŒç­›é€‰ï¼‰
const summary = await tripsApi.getBudgetSummary(tripId, {
  startDate: '2025-01-01',
  endDate: '2025-01-10',
  category: 'accommodation',
});

// è·å–é¢„ç®—æ˜ç»†
const details = await tripsApi.getBudgetDetails(tripId, {
  startDate: '2025-01-01',
  endDate: '2025-01-10',
  category: 'food',
  limit: 50,
  offset: 0,
});

// è·å–é¢„ç®—è¶‹åŠ¿
const trends = await tripsApi.getBudgetTrends(tripId, {
  startDate: '2025-01-01',
  endDate: '2025-01-10',
  granularity: 'daily',
});

// è·å–é¢„ç®—ç»Ÿè®¡
const statistics = await tripsApi.getBudgetStatistics(tripId);

// è·å–å®æ—¶ç›‘æ§
const monitor = await tripsApi.getBudgetMonitor(tripId, true);
```

### é¢„ç®—å†³ç­–é—¨æ§

```typescript
import { planningWorkbenchApi } from '@/api/planning-workbench';

// é¢„ç®—åˆç†æ€§è¯„ä¼°
const evaluation = await planningWorkbenchApi.evaluateBudget({
  planId: 'plan-123',
  tripId: 'trip-456',
  estimatedCost: 55000,
  categoryBreakdown: {
    accommodation: 22000,
    transportation: 11000,
    food: 11000,
    activities: 9000,
    other: 2000,
  },
  budgetConstraint: {
    total: 50000,
    currency: 'CNY',
  },
});

// è·å–é¢„ç®—å†³ç­–æ—¥å¿—
const decisionLog = await planningWorkbenchApi.getBudgetDecisionLog(
  'plan-123',
  'trip-456',
  {
    limit: 20,
    offset: 0,
  }
);

// è·å–è§„åˆ’æ–¹æ¡ˆé¢„ç®—è¯„ä¼°ç»“æœ
const planEvaluation = await planningWorkbenchApi.getPlanBudgetEvaluation('plan-123');
```

### é¢„ç®—ä¼˜åŒ–å»ºè®®

```typescript
// åº”ç”¨é¢„ç®—ä¼˜åŒ–å»ºè®®
const optimizationResult = await planningWorkbenchApi.applyBudgetOptimization({
  planId: 'plan-123',
  tripId: 'trip-456',
  optimizationIds: ['opt-1', 'opt-2'],
  autoCommit: false,
});
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### ç±»å‹å®šä¹‰éªŒæ”¶

- âœ… æ‰€æœ‰æ–°å¢ç±»å‹å®šä¹‰å·²æ·»åŠ åˆ° `src/types/trip.ts`
- âœ… ç±»å‹å®šä¹‰ä¸åç«¯æ¥å£è§„èŒƒä¸€è‡´
- âœ… ç±»å‹å®šä¹‰åŒ…å«å®Œæ•´çš„å­—æ®µå’Œæ³¨é‡Š

### API æ–¹æ³•éªŒæ”¶

- âœ… æ‰€æœ‰æ–°å¢æ¥å£æ–¹æ³•å·²æ·»åŠ åˆ°å¯¹åº”çš„ API æ–‡ä»¶
- âœ… API æ–¹æ³•åŒ…å«å®Œæ•´çš„å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹
- âœ… API æ–¹æ³•åŒ…å«é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… API æ–¹æ³•æ”¯æŒè¶…æ—¶è®¾ç½®

### æ¥å£å¢å¼ºéªŒæ”¶

- âœ… `getBudgetSummary` æ”¯æŒæ—¶é—´èŒƒå›´å’Œåˆ†ç±»ç­›é€‰å‚æ•°
- âœ… `BudgetConstraint` ç±»å‹å®šä¹‰å·²æ‰©å±•

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é¢„ç®—åŠŸèƒ½æ¥å£éœ€æ±‚æ¸…å•](./é¢„ç®—åŠŸèƒ½æ¥å£éœ€æ±‚æ¸…å•.md) - éœ€æ±‚æ–‡æ¡£
- [é¢„ç®—åŠŸèƒ½æ¥å£å®ç°æ€»ç»“](./é¢„ç®—åŠŸèƒ½æ¥å£å®ç°æ€»ç»“.md) - åç«¯å®ç°æ€»ç»“
- [è§„åˆ’å·¥ä½œå°æ¥å£éœ€æ±‚åˆ†æ](./è§„åˆ’å·¥ä½œå°æ¥å£éœ€æ±‚åˆ†æ.md) - è§„åˆ’å·¥ä½œå°æ¥å£åˆ†æ

---

## ğŸ“ åç»­å·¥ä½œå»ºè®®

### 1. å‰ç«¯ç»„ä»¶é›†æˆ

å»ºè®®åœ¨ä»¥ä¸‹ç»„ä»¶ä¸­é›†æˆæ–°çš„é¢„ç®—æ¥å£ï¼š

- **é¢„ç®—é¡µé¢** (`src/pages/trips/budget.tsx`)
  - é›†æˆé¢„ç®—æ˜ç»†æŸ¥è¯¢
  - é›†æˆé¢„ç®—è¶‹åŠ¿å±•ç¤º
  - é›†æˆé¢„ç®—ç»Ÿè®¡å±•ç¤º
  - é›†æˆå®æ—¶ç›‘æ§

- **è§„åˆ’å·¥ä½œå°** (`src/pages/plan-studio/PlanningWorkbenchTab.tsx`)
  - é›†æˆé¢„ç®—è¯„ä¼°ç»“æœå±•ç¤º
  - é›†æˆé¢„ç®—å†³ç­–æ—¥å¿—
  - é›†æˆé¢„ç®—ä¼˜åŒ–å»ºè®®åº”ç”¨

- **æ„å›¾è®¾ç½®é¡µé¢** (`src/pages/plan-studio/IntentTab.tsx`)
  - ä½¿ç”¨æ–°çš„é¢„ç®—çº¦æŸè®¾ç½®æ¥å£
  - æ›¿æ¢ç°æœ‰çš„ `updateIntent` è°ƒç”¨

### 2. é”™è¯¯å¤„ç†å¢å¼º

å»ºè®®ä¸ºæ‰€æœ‰æ–°å¢æ¥å£æ·»åŠ ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ï¼š

- ç½‘ç»œé”™è¯¯æç¤º
- è¶…æ—¶é”™è¯¯æç¤º
- ä¸šåŠ¡é”™è¯¯æç¤ºï¼ˆå¦‚é¢„ç®—èŒƒå›´éªŒè¯å¤±è´¥ï¼‰

### 3. ç±»å‹å¯¼å‡º

å»ºè®®åœ¨ `src/types/trip.ts` ä¸­ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰é¢„ç®—ç›¸å…³ç±»å‹ï¼Œæ–¹ä¾¿å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-XX  
**ç»´æŠ¤è€…**: å‰ç«¯å¼€å‘å›¢é˜Ÿ
