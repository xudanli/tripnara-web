# 行程详情页「规划」Tab：用户故事与人机交互设计方案

**文档类型**：产品说明 + 人机交互 + 视觉设计 + 体验设计  
**版本**：1.1  
**编制**：产品经理 + 人机交互设计专家 + 视觉设计师 + 体验设计师  
**最后更新**：2026-02-15  
**上位文档**：`tripnara-interaction-philosophy-prd.md`（交互哲学 PRD，遇冲突以该文档为准）

---

## 一、三层 Tab 结构现状

| 层级 | 位置 | Tab 项 | 功能定位 |
|------|------|--------|----------|
| **第一层** | 行程主视图 | 总览 / **规划** / 执行 / 复盘 / 预算 | 行程维度的大模块切分 |
| **第二层** | 规划 Tab 内 | 安全 / 节奏 / 修复 / **优化** | 规划阶段的不同视角与能力 |
| **第三层** | 优化 Tab 内 | 评估 / 协商 / 团队 / 实时 | 优化相关具体操作与工具 |

---

## 二、产品经理：规划 Tab 用户故事

### 2.1 核心用户角色与心智

| 角色 | 典型身份 | 进入规划 Tab 时的主要问题 |
|------|----------|---------------------------|
| **快速检查者** | 忙人、首次使用 | 「我的行程有没有问题？能不能走？」 |
| **问题解决者** | 已有明确问题 | 「哪里有问题？怎么改？」 |
| **深度优化者** | 进阶用户、团队规划 | 「怎么让行程更好？多人怎么达成共识？」 |

### 2.2 底线用户故事（P0）

#### US-P01：看一眼有没有问题
> 作为**快速检查者**，我希望进入规划 Tab 后，在**不点击任何子 Tab** 的情况下，能在一屏内看到「行程能不能走、有没有明显问题」，这样我就不需要逐层点开才能判断。

**验收标准**：  
- 综合视图（状态 + 安全/节奏/修复分数）在首屏可见  
- 有/无问题的结论清晰（如：良好 / 可优化 / 需修复）

---

#### US-P02：有问题时快速定位
> 作为**问题解决者**，当综合视图提示「有 X 个问题」时，我希望点击「查看问题」后，能直接看到**问题类型**（安全 / 节奏 / 可执行性），并能在该视角下采取修复动作，而不需要自己猜该点哪个 Tab。

**验收标准**：  
- 「查看问题」可展开详情  
- 展开后默认聚焦到**问题最严重的视角**（如安全最差则默认展示安全 Tab）  
- 每个视角内有明确的问题列表与操作入口（应用建议、调整时间等）

---

#### US-P03：无问题时也能深入分析
> 作为**深度优化者**，当综合视图显示「当前无明显问题」时，我仍然希望有入口能进入安全/节奏/修复的详细分析，以便做进一步微调或理解评分依据。

**验收标准**：  
- 「查看分析」可展开详情 Tab  
- 展开后能看到安全 / 节奏 / 修复 / 优化四个视角的入口

---

### 2.3 进阶用户故事（P1）

#### US-P11：团队与协商
> 作为**团队规划者**，我希望在规划 Tab 的「优化」子 Tab 内，能找到团队管理、协商、权重设置等与多人协作相关的能力，并且流程清晰：创建团队 → 设置权重 → 协商 → 查看结论。

#### US-P12：实时状态与反馈
> 作为**执行中用户**，在执行阶段进入规划 Tab 时，我希望能看到与当前行程相关的实时信息（天气、路况、疲劳等）和反馈入口，以便在途中微调规划。

#### US-P13：评估与一键优化
> 作为**深度优化者**，我希望能在「优化」子 Tab 内完成「评估计划 → 调整权重（可选）→ 一键优化 → 对比方案 → 采纳」的完整闭环，而不会被其他 Tab 干扰。

---

### 2.4 用户故事优先级小结

| 用户故事 | 角色 | 优先级 | 当前 Tab 路径 |
|----------|------|--------|---------------|
| US-P01 | 快速检查者 | P0 | 第一层 规划 → 首屏综合视图 |
| US-P02 | 问题解决者 | P0 | 第一层 规划 → 查看问题 → 第二层 安全/节奏/修复 |
| US-P03 | 深度优化者 | P0 | 第一层 规划 → 查看分析 → 第二层 安全/节奏/修复 |
| US-P11 | 团队规划者 | P1 | 规划 → 优化 → 第三层 团队/协商 |
| US-P12 | 执行中用户 | P1 | 规划 → 优化 → 第三层 实时 |
| US-P13 | 深度优化者 | P1 | 规划 → 优化 → 第三层 评估/优化 |

---

## 三、人机交互设计专家：设计方案

### 3.1 问题诊断

| 问题 | 表现 | 影响 |
|------|------|------|
| **认知负担高** | 三层 Tab 同时可见，概念多（安全/节奏/修复/优化 + 评估/协商/团队/实时） | 用户不知从何入手，易迷失 |
| **路径不清晰** | 底线场景需穿越 2–3 层才能抵达 | 违背「一屏给结论」原则 |
| **层级语义不清** | 第二层「优化」与第三层「优化」同名；「修复」与「优化」边界模糊 | 增加心智负担 |
| **按需展示不足** | 所有能力平铺，无渐进披露 | 简单用户也被迫面对复杂界面 |

---

### 3.2 设计原则

1. **一屏给结论**：进入规划 Tab 即看到综合结论，不依赖子 Tab。
2. **问题驱动展开**：有问题时按类型引导进入对应视角；无问题时提供「查看分析」入口。
3. **渐进披露**：常用能力前置，高级能力折叠或后置。
4. **层级语义明确**：每层 Tab 的命名与职责清晰，避免重复与歧义。

---

### 3.3 推荐信息架构（IA）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 第一层：行程维度（保持不变）                                                  │
│ 总览 | 规划 | [执行] | [复盘] | 预算                                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 规划 Tab 内容                                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│ 【固定可见】综合视图卡片                                                       │
│ ├─ 状态：良好 / 可优化 / 需修复（含整体健康度 %）                              │
│ ├─ 指标：安全 X · 节奏 Y · 准备度 Z                                          │
│ └─ 行动：[查看问题] 或 [查看分析]（点击后展开下方）                            │
├─────────────────────────────────────────────────────────────────────────────┤
│ 【按需展开】详情区（用户点击后显示，可收起）                                    │
│                                                                             │
│ 方案 A（推荐）：二段式，第二层收缩为 2 个 Tab                                  │
│ ├─ Tab 1「问题与改进」：合并 安全 | 节奏 | 修复 三个视角（内部用子区或折叠展示） │
│ └─ Tab 2「智能优化」：评估 | 协商 | 团队 | 实时（即当前第三层内容）             │
│                                                                             │
│ 方案 B（渐进式）：保持四视角，但默认折叠                                       │
│ ├─ 安全 | 节奏 | 修复 | 智能优化（4 个 Tab，仅在有问题的视角默认选中）         │
│ └─ 「智能优化」内保持 评估 | 协商 | 团队 | 实时                                │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 3.4 具体设计建议

#### 3.4.1 第一层（行程维度）

- **保持现状**：总览 / 规划 / 执行 / 复盘 / 预算。
- **规划 Tab 心智**：回答「行程能不能走、有没有问题、怎么改」。

---

#### 3.4.2 第二层（规划视角）—— 简化方案

**现状**：安全 | 节奏 | 修复 | 优化（4 个平铺）。

**建议**：

| 方案 | 结构 | 适用场景 |
|------|------|----------|
| **A：二段式** | 「问题与改进」+「智能优化」 | 强调简单，希望第二层只有 2 个选择 |
| **B：四段式收缩** | 保持 4 个，但「智能优化」替代原「优化」命名，且默认折叠 | 保持能力完整，减少默认认知负担 |

**命名调整**：  
- 原「优化」→「智能优化」或「计划优化」，与第三层「评估/协商/团队/实时」区分。  
- 原「修复」可考虑与「节奏」合并为「节奏与可执行性」，减少 Tab 数量（可选）。

---

#### 3.4.3 第三层（优化工具）—— 工具化呈现

**现状**：评估 | 协商 | 团队 | 实时，外加 一键优化、评估、权重、优化、协商 等按钮。

**建议**：

1. **主流程前置**：  
   - 默认 Tab 为「评估」，配合「点击评估开始分析」类引导。  
   - 「一键优化」作为评估完成后的主操作，放在显著位置。

2. **操作流线性化**：  
   - 评估 → 优化 → 协商（如需）→ 团队（如需）→ 实时（执行中）。  
   - 用步骤指示或面包屑提示当前所处阶段，减少「不知道该点哪」的困惑。

3. **按钮与 Tab 去重**：  
   - Tab「评估」与按钮「评估」功能一致时，仅保留一处，避免重复入口。  
   - 其他操作（权重、协商）可作为 Tab 内顶部操作栏，而非独立 Tab 或重复按钮。

---

#### 3.4.4 底线场景的交互流（目标状态）

```
用户进入「规划」Tab
        │
        ▼
┌───────────────────────────────┐
│ 综合视图：状态 + 安全/节奏/准备度 │
│ [查看问题] 或 [查看分析]       │
└───────────────────────────────┘
        │
        │ 无点击 → 停留在此，满足 US-P01
        │
        │ 点击「查看问题」或「查看分析」
        ▼
┌───────────────────────────────┐
│ [收起详情]                     │
│ 安全 | 节奏 | 修复 | 智能优化   │  ← 第二层
│ ─────────────────────────────│
│ [对应视角的详细内容]             │
│ 或 智能优化内：评估|协商|团队|实时 │  ← 第三层
└───────────────────────────────┘
```

---

### 3.5 实施优先级建议

| 阶段 | 内容 | 对应用户故事 |
|------|------|--------------|
| **Phase 1（已完成）** | 综合视图 + 按需展开 4 视角 + 收起详情 | US-P01, US-P02, US-P03 |
| **Phase 2（已完成）** | 第二层「优化」改名为「智能优化」；第三层增加流程指引、评估空态优化、展开动效 | US-P11, US-P13 |
| **Phase 3** | 第二层收缩为「问题与改进」+「智能优化」（方案 A）或保持四段式优化命名（方案 B） | 全量 |

---

## 四、视觉设计师：视觉规范与层次

### 4.1 设计目标

- **一眼能辨**：状态好坏通过色彩与图形快速传达，无需逐字阅读。
- **层次分明**：综合视图 > 详情区 > Tab 内容，通过间距、字重、色块区分。
- **情感一致**：良好=安心、可优化=关注、需修复=警惕，色彩与图标语义统一。

---

### 4.2 色彩语义（与产品逻辑一致）

| 状态 | 主色 | 背景 | 用途 |
|------|------|------|------|
| **良好** | 绿（如 `#16a34a` 或 design token） | 浅绿背景 `bg-green-50` | 综合视图「行程状态：良好」、100% 分数 |
| **可优化** | 黄/琥珀（如 `#d97706`） | 浅黄背景 `bg-yellow-50` | 「行程状态：可优化」、60–89 分 |
| **需修复** | 红（如 `#dc2626`） | 浅红背景 `bg-red-50` | 「行程状态：需修复」、&lt;60 分 |
| **安全视角** | 人设色 `persona-abu` | 对应浅色背景 | 安全 Tab、安全相关图标 |
| **节奏视角** | 人设色 `persona-dre` | 对应浅色背景 | 节奏 Tab |
| **修复视角** | 人设色 `persona-neptune` | 对应浅色背景 | 修复 Tab |
| **智能优化** | 主品牌色 `primary` | `bg-primary/10` | 优化 Tab、主操作按钮 |

**原则**：同一语义在同一场景下仅使用一套色彩，避免混用（如不要同时用红和黄表示「需修复」）。

---

### 4.3 视觉层次与排版

| 层级 | 元素 | 字号 | 字重 | 行高 | 建议 |
|------|------|------|------|------|------|
| **L0** | 综合视图整体卡片 | — | — | — | 使用边框或轻阴影区分于背景，`border` 或 `shadow-sm` |
| **L1** | 「综合视图」标题、状态文案 | `text-sm` | `font-medium` | 1.25 | 左对齐，与数据同行时可略小 |
| **L2** | 状态徽章（良好/可优化/需修复） | `text-xs` | `font-medium` | 1.2 | 配合 emoji 或小图标（🟢🟡🔴），圆角 `rounded` |
| **L3** | 指标文本（安全 X · 节奏 Y） | `text-xs` | `font-normal` | 1.2 | `text-muted-foreground`，紧凑排列 |
| **L4** | 行动按钮（查看问题/查看分析） | `text-xs` | `font-normal` | — | `variant="ghost"` `size="sm"`，与正文视觉权重相近，不抢主结论 |

**原则**：结论（状态 + 分数）最醒目，操作入口可点击但不喧宾夺主。

---

### 4.4 间距与留白

| 区域 | 内边距 | 说明 |
|------|--------|------|
| 综合视图卡片 | `p-4` | 内容不过密，呼吸感 |
| 综合视图内「状态 + 指标 + 按钮」 | `gap-4` | 横向 flex 时，`gap-4` 保证分组清晰 |
| 详情区与综合视图之间 | `mt-4` 或 `space-y-4` | 展开后与综合视图有明显分隔 |
| 第二层 Tab 列表 | `p-1` `h-11` | 与第一层 Tab 高度一致，形成统一节奏 |
| Tab 与内容区 | `mt-4` | Tab 切换后内容区留白，不贴边 |

---

### 4.5 图标与符号

| 场景 | 建议图标 | 说明 |
|------|----------|------|
| 综合视图模块 | `Eye` | 表示「总览 / 综合分析」 |
| 安全 | `Shield` | 防护、合规 |
| 节奏 | `Activity` | 心跳、节奏 |
| 修复 | `RefreshCw` | 修复、刷新 |
| 智能优化 | `Zap` | 效率、一键 |
| 收起详情 | `ChevronUp` | 折叠方向 |
| 状态良好 | 🟢 或 `CheckCircle2` | 正向反馈 |
| 状态可优化 | 🟡 或 `AlertCircle` | 需关注 |
| 状态需修复 | 🔴 或 `AlertTriangle` | 需行动 |

**原则**：同一概念全局统一图标，避免同一语义在综合视图与详情区使用不同图标。

---

### 4.6 状态与反馈的视觉表达

| 场景 | 视觉处理 |
|------|----------|
| 加载中 | 使用 `Spinner` + 「加载安全数据...」等文案，不遮挡综合视图 |
| 空状态 | 图标 + 简短文案（如「暂无安全数据」），`text-muted-foreground` |
| 展开/收起 | 展开时详情区有轻微「进入」感（可选 `animate-in`），收起时平滑收缩 |
| Tab 切换 | 激活 Tab 使用背景色 + 底部分割线，与未激活形成对比 |
| 按钮 hover | `hover:bg-xxx` `hover:text-xxx`，保持与语义色一致 |

---

### 4.7 响应式与折叠

- **桌面**：综合视图单行横向布局，指标与按钮同一行。
- **移动端**：综合视图可改为两行（状态+指标一行，按钮一行），或纵向堆叠；第二层 Tab 可横向滚动或改为下拉选择。

---

## 五、体验设计师：体验流与情感设计

### 5.1 体验目标

- **零思考进入**：进入规划 Tab 即获得结论，不依赖额外学习。
- **有反馈、可预期**：每次操作都有清晰反馈，用户知道「发生了什么、下一步能做什么」。
- **情绪匹配**：良好时给安心感，有问题时给方向感而非焦虑感。

---

### 5.2 关键触点体验设计

#### 触点 1：首次进入规划 Tab

| 要素 | 设计要点 |
|------|----------|
| **首屏焦点** | 综合视图卡片处于首屏上半部分，避免被页头或 Tab 挤压 |
| **默认状态** | 详情区折叠，减少干扰；有问题时可自动展开（已在 Phase 1 实现） |
| **引导** | 无问题时「查看分析」、有问题时「查看问题」，文案直接对应下一步动作 |

---

#### 触点 2：点击「查看问题」/「查看分析」

| 要素 | 设计要点 |
|------|----------|
| **展开动效** | 详情区平滑展开（200–300ms），避免突兀弹出 |
| **默认聚焦** | 有问题时默认选中问题最严重的 Tab（如安全最差则选安全），减少二次选择 |
| **收起入口** | 「收起详情」置于详情区顶部右侧，随时可退回简洁视图 |

---

#### 触点 3：在第二层 Tab 间切换

| 要素 | 设计要点 |
|------|----------|
| **切换反馈** | Tab 激活态清晰（背景色 + 下划线或底部分割线） |
| **内容加载** | 若内容需请求，展示骨架屏或局部 loading，不整页白屏 |
| **记忆** | 同一会话内切换 Tab 后，返回时尽量保持上次选中（可选） |

---

#### 触点 4：第三层「智能优化」内操作

| 要素 | 设计要点 |
|------|----------|
| **主流程可见** | 评估 → 优化 → 协商 的步骤在界面有体现（步骤条或面包屑） |
| **操作反馈** | 评估/优化请求中：按钮 loading、禁用重复提交；完成后：成功 toast + 结果区域更新 |
| **错误处理** | 网络/接口失败时，toast + 重试按钮，不静默失败 |

---

### 5.3 微交互与动效

| 场景 | 建议 |
|------|------|
| 综合视图展开/收起 | `transition-all duration-200`，高度或 opacity 平滑变化 |
| Tab 切换 | 激活态 `transition-colors`，内容区可选用 `fade-in`（可选） |
| 按钮点击 | 按下态 `active:scale-[0.98]`（可选），释放后恢复 |
| 成功操作 | `toast.success` 配合简短文案（如「建议已应用」） |
| 列表项 hover | 行背景轻微高亮，表明可点击 |

**原则**：动效轻量、有目的，不干扰阅读和决策。

---

### 5.4 情感与文案设计

| 状态 | 情感目标 | 文案方向 |
|------|----------|----------|
| **良好** | 安心、可放心出发 | 「行程状态：良好」「当前无明显问题」 |
| **可优化** | 关注但不焦虑 | 「行程状态：可优化」「有少量优化空间」 |
| **需修复** | 明确、可行动 | 「行程状态：需修复」「查看问题」 |
| **空状态** | 不责备、引导行动 | 「暂无安全数据」而非「数据加载失败」 |
| **加载中** | 减少等待焦虑 | 「加载安全数据...」等具体说明，配合进度或骨架屏 |

**原则**：避免负面、指责性表述；强调「可做什么」而非「不能做什么」。

---

### 5.5 无障碍与包容性

| 维度 | 设计要点 |
|------|----------|
| **色觉** | 不只依靠颜色区分状态，配合图标（🟢🟡🔴）或形状/纹理 |
| **焦点顺序** | Tab、按钮、表单控件符合逻辑焦點顺序，键盘可操作 |
| **屏幕阅读器** | 状态、分数、按钮有清晰的 `aria-label` 或可读文案 |
| **对比度** | 正文、状态文字与背景对比度 ≥ 4.5:1（WCAG AA） |
| **触控** | 按钮、Tab 点击区域 ≥ 44×44px，便于触屏使用 |

---

### 5.6 体验验收清单（与用户故事联动）

| 用户故事 | 体验验收点 |
|----------|------------|
| US-P01 | 进入规划 Tab 后 3 秒内能完成「有没有问题」的判断 |
| US-P02 | 从「查看问题」到看到具体问题列表 ≤ 2 次点击 |
| US-P03 | 「查看分析」入口始终可见，不因状态变化消失 |
| US-P11 | 团队相关入口在「智能优化」内可被发现，路径不超过 3 层 |
| US-P13 | 评估完成→优化→采纳，每步有明确反馈与下一步提示 |

---

## 六、术语表（产品与设计对齐）

| 术语 | 含义 | 对应能力/组件 |
|------|------|---------------|
| **综合视图** | 一屏内展示行程整体健康度、安全/节奏/准备度分数 | AutoOverview |
| **安全视角** | 合规、风险、可执行性门控 | AbuView |
| **节奏视角** | 疲劳、缓冲、行程节奏 | DrDreView |
| **修复视角** | 准备度、替代方案、修复建议 | NeptuneView |
| **智能优化** | 评估、协商、团队、实时等优化相关能力 | OptimizationDashboard |
| **按需展开** | 默认折叠，用户主动点击后才显示详情 | showPlanDetailTabs |

---

## 七、附录：与现有实现的映射

| 设计概念 | 代码/组件 |
|----------|-----------|
| 第一层 Tab | `[id].tsx` TabsList: overview / plan / optimize（仅 PLANNING）/ execute / insights / budget |
| 综合视图 | `AutoOverview.tsx` |
| 第二层 3 视角（规划内） | `[id].tsx` planViewTab: abu / dre / neptune |
| 第三层 优化工具 | `OptimizationDashboard.tsx` activeTab: evaluation / negotiation / team / realtime |
| 按需展开逻辑 | `showPlanDetailTabs` 状态 |

---

## 八、跨职能协作要点

| 角色 | 输出 | 与其他角色的衔接 |
|------|------|-------------------|
| **产品经理** | 用户故事、验收标准 | 为人机交互提供场景，为视觉/体验提供「为什么这样设计」 |
| **人机交互** | 信息架构、交互流、层级 | 为视觉提供结构（哪块是重点、如何分组），为体验提供触点 |
| **视觉设计师** | 色彩、排版、图标、间距 | 实现人机交互的层级，支撑体验的情感与可读性 |
| **体验设计师** | 触点设计、微交互、文案、无障碍 | 将产品目标落地为具体体验，验证视觉与交互是否达成情感目标 |

**协作建议**：优先锁定「底线场景」（US-P01～P03）的完整链路，确保产品→交互→视觉→体验四者一致后，再迭代进阶场景。

---

## 九、产品经理决策：智能优化 Tab 的展示条件（已决）

**决策人**：Danny（产品经理）  
**决策结论**：**方案 A — 仅规划中展示**

### 9.1 决策内容

- **展示条件**：`trip.status === 'PLANNING'` 时，智能优化作为第一层独立 Tab 显示
- **非 PLANNING 时**：智能优化 Tab 隐藏；若用户当前在智能优化 Tab，自动切回「规划」Tab

### 9.2 其他方案（供日后迭代参考）

| 方案 | 展示条件 | 适用场景 |
|------|----------|----------|
| A（已采用） | 仅 PLANNING | 心智清晰、Tab 数量可控 |
| B | PLANNING + IN_PROGRESS | 执行中可访问实时、反馈 |
| C | 除 CANCELLED 外 | 用户随时可进 |
| D | 与执行/复盘同逻辑 | 规则一致 |
