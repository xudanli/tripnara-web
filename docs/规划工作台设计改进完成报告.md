# 规划工作台设计改进完成报告

> 完成时间: 2025-01-XX  
> 基于: 产品经理 Danny 的设计评估

---

## 📋 改进概览

根据产品经理的评估，对规划工作台页面进行了全面改进，使其更符合 **TripNARA 产品哲学**：**决策优先、可执行优先、安全与可达性门控优先、解释与责任优先**。

---

## ✅ 完成的改进

### 1. Tab 名称修改

**问题**: Tab 名称"规划工作台"与页面整体名称重复，造成混淆

**改进**:
- ✅ Tab 名称改为 **"决策评估"**（中文）
- ✅ Tab 名称改为 **"Decision Evaluation"**（英文）
- ✅ 页面标题保持为"规划工作台"，但 Tab 名称更具体

**文件修改**:
- `src/locales/zh/translation.json`
- `src/locales/en/translation.json`

---

### 2. 空状态重新设计

**问题**:
- ❌ 显示空白卡片占位符，用户不理解用途
- ❌ 缺少三人格决策系统的说明
- ❌ 缺少决策流程的引导

**改进**:
- ✅ **移除空白卡片占位符**
- ✅ **添加三人格介绍卡片**：
  - Abu（🐻‍❄️）：评估路线的安全性与可达性
  - Dr.Dre（🐕）：评估节奏与体感，确保行程舒适
  - Neptune（🦦）：提供空间结构修复与替代方案
- ✅ **添加决策流程说明**：
  1. 生成方案 → 触发 Should-Exist Gate 评估
  2. 三人格独立评估 → 提供决策依据
  3. 综合决策 → 决定是否允许/需要调整
- ✅ **主操作按钮突出显示**：居中、大尺寸、清晰

**代码位置**: `src/pages/plan-studio/PlanningWorkbenchTab.tsx` (第 243-370 行)

---

### 3. 操作按钮分层设计

**问题**:
- ❌ 4 个操作按钮平级展示，缺少优先级
- ❌ 不符合 Should-Exist Gate 流程逻辑

**改进**:
- ✅ **主操作区**（空状态时）：
  - 只显示"生成方案"按钮（Primary，大尺寸，居中）
  
- ✅ **次要操作区**（生成后显示）：
  - "对比方案"（Secondary，小尺寸）
  - "调整方案"（Secondary，小尺寸）
  - 仅在生成方案后显示
  
- ✅ **提交操作**（条件显示）：
  - 仅在综合决策为 `ALLOW` 或 `NEED_CONFIRM` 时显示
  - 使用 Primary 样式，突出显示
  - 如果决策为 `REJECT`，不显示提交按钮

**代码位置**: `src/pages/plan-studio/PlanningWorkbenchTab.tsx` (第 372-436 行)

---

### 4. 结果展示信息层次增强

**问题**:
- ❌ 信息层次不清晰
- ❌ 缺少决策可解释性入口

**改进**:
- ✅ **第一层：综合决策**（最显眼）
  - 使用 `border-2 shadow-lg` 突出显示
  - 标题使用 `text-xl`
  - 添加"查看决策日志"按钮（CardFooter）
  
- ✅ **第二层：三人格评估结果**
  - 横向排列（`grid-cols-1 lg:grid-cols-3`）
  - 使用 `PersonaCard` 组件展示
  - 每个卡片包含：状态、解释、证据、建议
  
- ✅ **第三层：技术信息**（可折叠）
  - 使用 `Collapsible` 组件
  - 默认折叠（`defaultOpen={false}`）
  - 包含：规划 ID、版本、状态、时间戳

**代码位置**: `src/pages/plan-studio/PlanningWorkbenchTab.tsx` (第 457-550 行)

---

### 5. 决策可解释性入口

**问题**:
- ❌ 缺少决策日志入口
- ❌ 缺少证据链入口

**改进**:
- ✅ **综合决策卡片**中添加"查看决策日志"按钮
- ✅ 三人格卡片中已包含证据列表（`PersonaCard` 组件）
- ✅ 技术信息可折叠，减少干扰

**代码位置**: `src/pages/plan-studio/PlanningWorkbenchTab.tsx` (第 497-504 行)

---

## 📊 改进前后对比

### 改进前

```
┌─────────────────────────────────────┐
│ 规划工作台                          │
│ 做决策与做取舍的地方...              │
├─────────────────────────────────────┤
│ [生成方案] [对比] [提交] [调整]     │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 点击"生成方案"按钮开始...            │
└─────────────────────────────────────┘

┌──────────┐  ┌──────────┐
│          │  │          │  ← 空白卡片
└──────────┘  └──────────┘
```

### 改进后

```
┌─────────────────────────────────────┐
│ 决策评估                            │
│ 做决策与做取舍的地方...              │
├─────────────────────────────────────┤
│ 行程：IS, 6天                       │
├─────────────────────────────────────┤
│ ┌────┐ ┌────┐ ┌────┐               │
│ │Abu │ │Dre │ │Nep │  ← 三人格介绍 │
│ └────┘ └────┘ └────┘               │
├─────────────────────────────────────┤
│ 决策流程：                          │
│ 1. 生成方案 → Gate 评估             │
│ 2. 三人格评估                       │
│ 3. 综合决策                         │
└─────────────────────────────────────┘

        [生成方案]  ← 主操作按钮

生成后：

┌─────────────────────────────────────┐
│ 综合决策                            │
│ [ALLOW]                            │
│ 方案已通过评估...                   │
│ [查看决策日志]                      │
└─────────────────────────────────────┘

┌────┐ ┌────┐ ┌────┐
│Abu │ │Dre │ │Nep │  ← 三人格评估
└────┘ └────┘ └────┘

┌─────────────────────────────────────┐
│ 操作                                │
│ [对比方案] [调整方案]                │
│ ─────────────────────────────────── │
│      [提交方案到行程]                │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ ▼ 规划状态                          │  ← 可折叠
└─────────────────────────────────────┘
```

---

## 🎯 符合 TripNARA 产品哲学

### ✅ 决策优先

- **空状态**：先说明决策流程，再引导操作
- **结果展示**：综合决策最显眼，三人格评估清晰展示
- **操作引导**：根据决策结果决定是否显示提交按钮

### ✅ 可执行优先

- **操作分层**：主操作突出，次要操作条件显示
- **提交条件**：仅在决策允许时显示提交按钮

### ✅ 安全与可达性门控优先

- **三人格介绍**：明确说明 Abu 负责安全性与可达性评估
- **决策流程**：强调 Should-Exist Gate 评估

### ✅ 解释与责任优先

- **决策日志入口**：综合决策卡片中添加"查看决策日志"按钮
- **证据展示**：三人格卡片中展示证据列表
- **可解释性**：用户可以查看完整的决策过程

---

## 📁 修改的文件

### 核心文件

1. **`src/pages/plan-studio/PlanningWorkbenchTab.tsx`**
   - 重新设计空状态
   - 优化操作按钮布局
   - 增强结果展示层次
   - 添加决策日志入口
   - 添加可折叠技术信息

### 翻译文件

2. **`src/locales/zh/translation.json`**
   - Tab 名称：`workbench: "决策评估"`

3. **`src/locales/en/translation.json`**
   - Tab 名称：`workbench: "Decision Evaluation"`

---

## 🎨 UI 改进细节

### 1. 空状态设计

- **三人格卡片**：使用 `border-2` 突出显示
- **决策流程**：使用数字徽章（`w-6 h-6 rounded-full bg-primary`）
- **主操作按钮**：`size="lg"`，`min-w-[200px]`，居中显示

### 2. 操作按钮布局

- **主操作**：单独一行，居中，大尺寸
- **次要操作**：生成后显示，小尺寸，居中排列
- **提交操作**：条件显示，单独一行，带分隔线

### 3. 结果展示

- **综合决策**：`border-2 shadow-lg`，`text-xl` 标题
- **三人格卡片**：`grid-cols-1 lg:grid-cols-3`，响应式布局
- **技术信息**：可折叠，默认折叠，减少干扰

---

## ✅ 验收标准

### 空状态

- [x] 移除空白卡片占位符
- [x] 展示三人格介绍（Abu/Dr.Dre/Neptune）
- [x] 展示决策流程说明（3 步流程）
- [x] 主操作按钮突出显示（居中、大尺寸）

### 操作流程

- [x] 主操作按钮单独展示（空状态时）
- [x] 次要操作在生成后显示
- [x] 提交操作仅在决策允许时显示
- [x] 操作按钮状态正确（禁用/启用）

### 结果展示

- [x] 综合决策最显眼（`shadow-lg`）
- [x] 三人格评估清晰展示（横向排列）
- [x] 决策日志入口可访问
- [x] 技术信息可折叠

### 信息架构

- [x] 操作区和结果区清晰分离
- [x] 信息层次明确（3 层结构）
- [x] 符合 TripNARA 决策流程

---

## 🚀 后续优化建议

### 高优先级

1. **决策日志功能**
   - 实现"查看决策日志"按钮功能
   - 集成 `EvidenceDrawer` 组件或创建专门的决策日志对话框
   - 展示完整的决策时间线

2. **证据链展示**
   - 在三人格卡片中添加"查看完整证据"按钮
   - 展示证据的完整上下文

### 中优先级

3. **动画效果**
   - 三人格卡片出现时的动画
   - 决策结果展示的过渡效果

4. **示例方案**
   - 添加"查看示例"功能，帮助用户理解

---

## 📝 待确认问题

1. **决策日志数据来源**
   - 规划工作台的决策日志是否需要从 `planState.decision_log_refs` 获取？
   - 还是需要调用其他接口？

2. **证据链数据**
   - 规划工作台的证据是否需要从 `planState.evidence_refs` 获取？
   - 还是使用三人格输出中的 `evidence` 字段？

3. **Tab 名称确认**
   - "决策评估"是否合适？
   - 是否有其他更好的名称建议？

---

## 📚 相关文档

- [规划工作台接口需求分析](./规划工作台接口需求分析.md)
- [规划工作台集成完成报告](./规划工作台集成完成报告.md)
- [规划工作台commit接口对接说明](./规划工作台commit接口对接说明.md)

---

**文档维护**: 请及时更新此文档以反映最新的设计改进。
