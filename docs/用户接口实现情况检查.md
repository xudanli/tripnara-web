# ç”¨æˆ·ç›¸å…³æ¥å£å®ç°æƒ…å†µæ£€æŸ¥

> æ£€æŸ¥æ—¶é—´: 2025-01-21  
> æ£€æŸ¥èŒƒå›´: ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰ API æ¥å£

---

## ğŸ“‹ æ£€æŸ¥ç»“æœæ€»è§ˆ

### âœ… å·²å®ç°çš„æ¥å£

| æ–¹æ³• | è·¯å¾„ | æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|------|
| GET | `/users/profile` | `src/api/user.ts` | âœ… å·²å®ç° | è·å–å½“å‰ç”¨æˆ·çš„åå¥½ç”»åƒ |
| PUT | `/users/profile` | `src/api/user.ts` | âœ… å·²å®ç° | æ›´æ–°ç”¨æˆ·åå¥½ä¿¡æ¯ |

### âŒ æ–‡æ¡£ä¸­è®°å½•ä½†æœªå®ç°çš„æ¥å£

| æ–¹æ³• | è·¯å¾„ | æ–‡æ¡£ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|------|------|----------|------|------|
| GET | `/user/preferences` | `docs/API-æ¥å£å¯¹æ¥æƒ…å†µ.md` | âŒ æœªå®ç° | è·å–ç”¨æˆ·åå¥½ï¼ˆç‹¬ç«‹æ¥å£ï¼‰ |

### âš ï¸ è·¯å¾„ä¸ä¸€è‡´é—®é¢˜

**æ–‡æ¡£ä¸­çš„è·¯å¾„** (`docs/API-æ¥å£å¯¹æ¥æƒ…å†µ.md`):
- GET `/user/profile` (å•æ•°)
- PUT `/user/profile` (å•æ•°)
- GET `/user/preferences` (å•æ•°)

**å®é™…ä»£ç ä¸­çš„è·¯å¾„** (`src/api/user.ts`):
- GET `/users/profile` (å¤æ•°)
- PUT `/users/profile` (å¤æ•°)

**å»ºè®®**: 
- å¦‚æœåç«¯å®é™…ä½¿ç”¨çš„æ˜¯ `/users/profile`ï¼ˆå¤æ•°ï¼‰ï¼Œéœ€è¦æ›´æ–°æ–‡æ¡£
- å¦‚æœåç«¯å®é™…ä½¿ç”¨çš„æ˜¯ `/user/profile`ï¼ˆå•æ•°ï¼‰ï¼Œéœ€è¦ä¿®æ”¹ä»£ç 

---

## ğŸ“ å·²å®ç°æ¥å£è¯¦æƒ…

### 1. GET `/users/profile` - è·å–ç”¨æˆ·åå¥½ç”»åƒ

**æ–‡ä»¶**: `src/api/user.ts`  
**æ–¹æ³•**: `userApi.getProfile()`

**åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·çš„åå¥½ç”»åƒï¼ŒåŒ…æ‹¬ç”¨æˆ·åå¥½é…ç½®ï¼ˆå›½ç±ã€å±…ä½å›½ã€æ ‡ç­¾ã€é¥®é£Ÿé™åˆ¶ç­‰ï¼‰

**å“åº”ç±»å‹**: `UserProfile`
```typescript
interface UserProfile {
  userId: string;
  preferences?: UserPreferences;
  createdAt: string;
  updatedAt: string;
}
```

**é”™è¯¯å¤„ç†**:
- âœ… ç½‘ç»œé”™è¯¯å¤„ç†
- âœ… 401 æœªè®¤è¯é”™è¯¯å¤„ç†
- âœ… åç«¯é”™è¯¯å“åº”å¤„ç†
- âœ… è‡ªå®šä¹‰é”™è¯¯ç±» `UserProfileApiError`

**Hook**: `useUserPreferences` (`src/hooks/useUserPreferences.ts`)

---

### 2. PUT `/users/profile` - æ›´æ–°ç”¨æˆ·åå¥½ä¿¡æ¯

**æ–‡ä»¶**: `src/api/user.ts`  
**æ–¹æ³•**: `userApi.updateProfile(preferences: UserPreferences)`

**åŠŸèƒ½**: æ›´æ–°ç”¨æˆ·åå¥½ä¿¡æ¯

**è¯·æ±‚ç±»å‹**: `UpdateUserProfileRequest`
```typescript
interface UpdateUserProfileRequest {
  preferences?: UserPreferences;
}
```

**å“åº”ç±»å‹**: `UserProfile`

**é”™è¯¯å¤„ç†**:
- âœ… ç½‘ç»œé”™è¯¯å¤„ç†
- âœ… 401 æœªè®¤è¯é”™è¯¯å¤„ç†
- âœ… 400/422 éªŒè¯é”™è¯¯å¤„ç†
- âœ… åç«¯é”™è¯¯å“åº”å¤„ç†
- âœ… è‡ªå®šä¹‰é”™è¯¯ç±» `UserProfileApiError`

**Hook**: `useUserPreferences` (`src/hooks/useUserPreferences.ts`)

---

## ğŸ” ç¼ºå¤±æ¥å£åˆ†æ

### GET `/user/preferences` - è·å–ç”¨æˆ·åå¥½

**æ–‡æ¡£ä½ç½®**: `docs/API-æ¥å£å¯¹æ¥æƒ…å†µ.md` (ç¬¬ 138 è¡Œ)

**é—®é¢˜**: 
- æ–‡æ¡£ä¸­è®°å½•äº†è¿™ä¸ªæ¥å£ï¼Œä½†ä»£ç ä¸­æœªå®ç°
- å½“å‰ `GET /users/profile` æ¥å£å·²ç»è¿”å›äº† `preferences` å­—æ®µ
- è¿™ä¸ªç‹¬ç«‹æ¥å£å¯èƒ½æ˜¯å†—ä½™çš„ï¼Œæˆ–è€…ç”¨äºä¸åŒçš„ç”¨é€”

**å»ºè®®**:
1. **å¦‚æœåç«¯ç¡®å®éœ€è¦è¿™ä¸ªæ¥å£**: éœ€è¦åœ¨ `src/api/user.ts` ä¸­æ·»åŠ å®ç°
2. **å¦‚æœè¿™ä¸ªæ¥å£æ˜¯å†—ä½™çš„**: åº”è¯¥ä»æ–‡æ¡£ä¸­åˆ é™¤
3. **å¦‚æœè·¯å¾„åº”è¯¥æ˜¯ `/users/preferences`**: éœ€è¦ç¡®è®¤åç«¯å®é™…è·¯å¾„

**å¯èƒ½çš„å®ç°**:
```typescript
export const userApi = {
  // ... ç°æœ‰æ–¹æ³•

  /**
   * è·å–ç”¨æˆ·åå¥½ï¼ˆç‹¬ç«‹æ¥å£ï¼‰
   * GET /users/preferences
   */
  getPreferences: async (): Promise<UserPreferences> => {
    try {
      const response = await apiClient.get<SuccessResponse<UserPreferences>>('/users/preferences');
      
      if (!response.data.success) {
        const errorData = response.data as unknown as ErrorResponse;
        throw new UserProfileApiError(
          errorData.error.code,
          errorData.error.message
        );
      }
      
      return response.data.data;
    } catch (error: any) {
      // ... é”™è¯¯å¤„ç†
    }
  },
};
```

---

## ğŸ”— ç›¸å…³æ¥å£ï¼ˆéåŸºç¡€ç”¨æˆ·æ¥å£ï¼‰

ä»¥ä¸‹æ¥å£è™½ç„¶ä¸ç”¨æˆ·ç›¸å…³ï¼Œä½†å±äºå…¶ä»–æ¨¡å—ï¼ˆè§„åˆ’åŠ©æ‰‹ï¼‰ï¼š

| æ–¹æ³• | è·¯å¾„ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|------|
| GET | `/agent/planning-assistant/users/:userId/preferences` | `src/api/assistant.ts` | è·å–ç”¨æˆ·åå¥½æ‘˜è¦ï¼ˆè§„åˆ’åŠ©æ‰‹ï¼‰ |
| POST | `/agent/planning-assistant/users/:userId/preferences/clear` | `src/api/assistant.ts` | æ¸…é™¤ç”¨æˆ·åå¥½ï¼ˆè§„åˆ’åŠ©æ‰‹ï¼‰ |

---

## âœ… è®¤è¯ç›¸å…³æ¥å£

è®¤è¯æ¥å£å·²å®Œæ•´å®ç°ï¼ˆ`src/api/auth.ts`ï¼‰ï¼š

| æ–¹æ³• | è·¯å¾„ | çŠ¶æ€ |
|------|------|------|
| POST | `/auth/google/code` | âœ… å·²å®ç° |
| POST | `/auth/google/id-token` | âœ… å·²å®ç° |
| POST | `/auth/email/send-code` | âœ… å·²å®ç° |
| POST | `/auth/email/login` | âœ… å·²å®ç° |
| POST | `/auth/email/register` | âœ… å·²å®ç° |
| POST | `/auth/refresh` | âœ… å·²å®ç° |
| POST | `/auth/logout` | âœ… å·²å®ç° |

---

## ğŸ“Š æ€»ç»“

### å®ç°å®Œæ•´æ€§
- âœ… **åŸºç¡€ç”¨æˆ·æ¥å£**: 2/3 å·²å®ç°ï¼ˆ66.7%ï¼‰
- âœ… **è®¤è¯æ¥å£**: 7/7 å·²å®ç°ï¼ˆ100%ï¼‰
- âœ… **ç›¸å…³ Hook**: `useUserPreferences` å·²å®ç°
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

### éœ€è¦ç¡®è®¤çš„é—®é¢˜
1. **è·¯å¾„ä¸ä¸€è‡´**: `/user` vs `/users` - éœ€è¦ç¡®è®¤åç«¯å®é™…è·¯å¾„
2. **ç¼ºå¤±æ¥å£**: `GET /user/preferences` - éœ€è¦ç¡®è®¤æ˜¯å¦éœ€è¦å®ç°
3. **æ–‡æ¡£æ›´æ–°**: å¦‚æœè·¯å¾„æ˜¯ `/users`ï¼Œéœ€è¦æ›´æ–°æ–‡æ¡£

### å»ºè®®è¡ŒåŠ¨
1. âœ… ç¡®è®¤åç«¯å®é™…ä½¿ç”¨çš„è·¯å¾„ï¼ˆ`/user` è¿˜æ˜¯ `/users`ï¼‰
2. âœ… ç¡®è®¤æ˜¯å¦éœ€è¦å®ç° `GET /user/preferences` æ¥å£
3. âœ… æ›´æ–°æ–‡æ¡£ä»¥åæ˜ å®é™…å®ç°æƒ…å†µ
4. âœ… å¦‚æœç¡®è®¤éœ€è¦ï¼Œå®ç°ç¼ºå¤±çš„ `GET /user/preferences` æ¥å£

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `src/api/user.ts` - ç”¨æˆ· API å®ç°
- `src/api/auth.ts` - è®¤è¯ API å®ç°
- `src/hooks/useUserPreferences.ts` - ç”¨æˆ·åå¥½ Hook
- `src/hooks/useAuth.ts` - è®¤è¯ Hook
- `docs/API-æ¥å£å¯¹æ¥æƒ…å†µ.md` - API æ¥å£æ–‡æ¡£
