# 产品经理评估：点击"已确认"后卡片内容消失问题

## 问题描述

用户反馈：点击"已确认"后，AI显示"规划师正在思考..."，但之后没有显示预期的卡片内容（如结构化内容块、澄清问题卡片等）。

## 产品经理评估

### 1. **交互流程分析**

**当前流程**：
1. 用户回答澄清问题
2. 所有必填问题回答完成后，自动发送"已确认"消息
3. 后端处理请求，返回响应
4. 前端根据响应类型显示内容

**问题**：
- 如果后端返回 `needsClarification: false`，前端不会显示任何卡片
- 如果后端返回了 `responseBlocks`，但没有 `needsClarification: true`，前端可能不会正确显示

### 2. **预期行为**

**产品决策**：无论后端返回什么状态，只要返回了 `responseBlocks`，就应该显示结构化内容。

**理由**：
1. **用户体验一致性**：用户期望看到结构化的回复内容，而不是纯文本
2. **信息完整性**：`responseBlocks` 包含了结构化的信息（如行程概览、预算摘要等），应该优先显示
3. **降级策略**：如果后端没有返回 `responseBlocks`，才降级到纯文本显示

### 3. **当前实现问题**

**问题1**：只在 `needsClarification: true` 时处理 `responseBlocks`
- 如果后端返回了 `responseBlocks` 但 `needsClarification: false`，这些内容不会被显示

**问题2**：自动发送"已确认"可能不合适
- 用户可能想先查看答案的反馈，再决定是否提交
- 自动提交可能让用户感觉失去控制

### 4. **修复建议**

#### 建议1：无论 `needsClarification` 状态，都显示 `responseBlocks`

**修改点**：
- 检查 `response.plannerResponseBlocks` 是否存在
- 如果存在，无论 `needsClarification` 状态如何，都显示结构化内容
- 只有在没有 `responseBlocks` 时，才使用 `plannerReply` 作为降级方案

#### 建议2：改进自动提交逻辑

**选项A**：移除自动提交，改为显示"提交"按钮
- 用户回答完所有必填问题后，显示一个"提交答案"按钮
- 用户点击后才发送消息

**选项B**：保留自动提交，但增加确认提示
- 所有必填问题回答完成后，显示一个提示："所有问题已回答，3秒后自动提交"
- 用户可以取消自动提交

**选项C**：保留自动提交，但改进反馈
- 自动提交后，立即显示一个用户消息气泡："已确认"
- 让用户明确知道已经提交了

### 5. **推荐方案**

**推荐：方案1（显示 responseBlocks）+ 方案2选项C（改进反馈）**

**理由**：
1. **信息完整性**：确保用户看到所有结构化内容
2. **用户体验**：自动提交提高效率，但需要明确的反馈
3. **实现简单**：不需要大幅改动现有逻辑

### 6. **验收标准**

1. ✅ 后端返回 `responseBlocks` 时，无论 `needsClarification` 状态，都显示结构化内容
2. ✅ 自动提交后，立即显示用户消息气泡："已确认"
3. ✅ 后端响应后，正确显示所有卡片内容（行程概览、预算摘要、澄清问题等）
4. ✅ 如果没有 `responseBlocks`，降级到纯文本显示

### 7. **风险与对策**

**风险**：自动提交可能让用户感觉失去控制

**对策**：
- 增加明确的视觉反馈（用户消息气泡）
- 考虑添加"取消自动提交"选项（未来优化）

## 总结

**产品决策**：
1. **修复显示逻辑**：无论 `needsClarification` 状态，都显示 `responseBlocks`
2. **改进自动提交反馈**：自动提交后立即显示用户消息气泡
3. **保持自动提交**：提高效率，但需要明确的反馈

**优先级**：P0（高优先级，影响核心功能）
