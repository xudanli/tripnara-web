# 执行阶段页面 - 信息架构与认知负荷优化方案

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 版本 | v1.0 |
| 创建日期 | 2026-02-22 |
| 角色 | 人机交互设计专家（Dr. Sarah Chen） |
| 参考 | `.claude/agents/人机交互设计专家.md` |

---

## 2. 问题分析

### 2.1 用户反馈

- **「中间是不是可以显示所有行程」**：主区当前仅展示「下一步」或「暂无下一步操作」，缺少**完整行程概览**
- **「信息过载」**：实时状态、24h 预测、提醒、今日时间线、助手、快捷操作等分散展示，**认知负荷过高**

### 2.2 认知负荷分析（Cognitive Load Theory）

| 负荷类型 | 现状 | 问题 |
|----------|------|------|
| **内在负荷** | 信息分散在左/中/右三栏 | 用户需在多个区域扫视才能理解「我在哪、接下来做什么」 |
| **外在负荷** | 实时状态、预测、提醒、今日时间线、助手、动作栏同时呈现 | 视觉噪音多，**违反 Miller's Law**（工作记忆 7±2 块） |
| **相关负荷** | 今日时间线在右侧，与主区「下一步」分离 | 上下文割裂，用户需 mentally 整合 |

### 2.3 违反的认知科学原理

- **Miller's Law**：单屏信息块过多（实时状态、预测、下一步、提醒、今日、助手、动作栏 ≥ 7）
- **渐进式披露**：次要信息（24h 预测、可行概率）与主要信息（行程）同级展示
- **任务优先级**：执行阶段核心任务是「按行程执行」，但**行程本身未居中展示**

---

## 3. 优化目标

1. **主区展示完整行程**：中间区域以**行程时间线**为核心，支持「今日 + 全部」切换
2. **降低认知负荷**：次要信息折叠/摘要，主区聚焦「当前在哪、接下来做什么」
3. **信息层级清晰**：主区 > 右侧助手 > 顶部/折叠区

---

## 4. 信息架构重组

### 4.1 新布局结构（桌面端）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 顶部条（精简）：行程名 | 当前日期/时间 | 状态徽章 | 天气(compact) | 实地报告  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────┐  ┌──────────────────────────┐ │
│  │ 主区：行程时间线（8/12）              │  │ 右侧：提醒 + 助手入口（4/12）│ │
│  │                                     │  │                          │ │
│  │ • 今日行程（默认）                   │  │ • 提醒（仅高优先级，可折叠）│ │
│  │   - 当前项高亮                       │  │ • 今日时间线（精简/可收起）│ │
│  │   - 下一项高亮                       │  │ • 或：助手折叠条           │ │
│  │   - 已完成项淡化                     │  │                          │ │
│  │ • Tab: [今日] [全部]                 │  │                          │ │
│  │ • 下一步卡片（可内嵌在时间线中）     │  │                          │ │
│  │                                     │  │                          │ │
│  └─────────────────────────────────────┘  └──────────────────────────┘ │
│                                                                         │
│  ┌─ 可折叠区（默认收起）────────────────────────────────────────────────┐ │
│  │ 实时状态 | 24h 预测 | 可行概率                                        │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  底部浮层：延迟15m | 延迟30m | Skip | Replace | Reorder（保持）          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 信息优先级（按用户任务）

| 优先级 | 信息 | 展示方式 | 依据 |
|--------|------|----------|------|
| **P0** | 今日/全部行程时间线 | 主区居中，默认展开 | 执行阶段核心任务 |
| **P0** | 下一步（当前项） | 主区高亮或内嵌卡片 | 即时行动指引 |
| **P1** | 提醒（高优先级） | 右侧，可折叠 | 时间敏感 |
| **P1** | 今日时间线（右侧） | 与主区合并或精简 | 减少重复 |
| **P2** | 实时状态、24h 预测 | 可折叠区，默认收起 | 渐进式披露 |
| **P2** | 行程助手 | 右侧折叠条，点击展开 | 按需获取 |

---

## 5. 主区「行程时间线」设计

### 5.1 数据结构

- 来源：`trip.TripDay`、`tripState`、`todaySchedule`
- 类型：`TripDetail`、`TripDay`、`ItineraryItem`（`src/types/trip.ts`）

### 5.2 交互模式

| 模式 | 说明 | 符合原理 |
|------|------|----------|
| **Tab 切换** | [今日] [全部] | 分块呈现（Miller's Law） |
| **当前/下一项高亮** | 视觉焦点明确 | 降低外在负荷 |
| **已完成项淡化** | 减少干扰 | 渐进式披露 |
| **每块 ≤ 7 项** | 今日过多时虚拟滚动或分页 | Miller's Law |
| **下一步卡片** | 可内嵌在时间线顶部或独立卡片 | 任务优先级 |

### 5.3 组件结构建议

```
主区（col-span-8）
├── TabList: [今日] [全部]
├── 今日模式
│   ├── 下一步卡片（若有 nextStop）
│   └── 今日行程列表（todaySchedule 或 trip.TripDay 中当天）
│       └── ItineraryItemRow（当前/下一/待执行 状态）
└── 全部模式
    └── 按 TripDay 分组展示
        └── DaySection
            └── ItineraryItemRow[]
```

### 5.4 与现有「今日时间线」的关系

- **现状**：右侧有「今日时间线」卡片，与主区「下一步」分离
- **优化**：主区行程时间线**取代**右侧今日时间线，右侧仅保留**提醒**（或提醒+助手）
- **数据复用**：`todaySchedule`、`trip.TripDay` 用于主区渲染

---

## 6. 信息过载缓解措施

### 6.1 可折叠区（Collapsible）

- **实时状态**（RealtimeStatusBanner）：默认收起，点击「展开」查看
- **24h 预测**：合并到折叠区，或仅显示 Badge（如「可行概率 40%」），详情在抽屉中

### 6.2 右侧精简

- **提醒**：仅显示高优先级（urgent/high），中低优先级折叠
- **今日时间线**：移除，由主区行程时间线承担
- **助手**：保持折叠条，点击展开

### 6.3 快捷操作（Fitts's Law）

- 底部浮层保持 4–5 个核心操作（延迟15m、延迟30m、Skip、Replace、Reorder）
- 符合 Hick's Law：选择数量可控

---

## 7. 实施计划

### Phase 1：主区行程时间线（P0）

| 任务 | 内容 | 文件 | 预计 |
|------|------|------|------|
| 1.1 | 新增 `ExecuteItineraryTimeline` 组件 | `src/components/execute/ExecuteItineraryTimeline.tsx` | 0.5d |
| 1.2 | 支持 [今日] [全部] Tab，渲染 `trip.TripDay` / `todaySchedule` | 同上 | 0.5d |
| 1.3 | 主区替换「下一步」单卡片为「行程时间线 + 下一步高亮」 | `src/pages/execute/index.tsx` | 0.5d |
| 1.4 | 移除右侧「今日时间线」卡片（避免重复） | `src/pages/execute/index.tsx` | 0.5d |

### Phase 2：可折叠区（P1）

| 任务 | 内容 | 文件 | 预计 |
|------|------|------|------|
| 2.1 | 实时状态 + 24h 预测放入 Collapsible，默认收起 | `src/pages/execute/index.tsx` | 0.5d |
| 2.2 | 顶部条精简，天气保持 compact | `src/pages/execute/index.tsx` | 0.25d |

### Phase 3：右侧与提醒优化（P2）

| 任务 | 内容 | 文件 | 预计 |
|------|------|------|------|
| 3.1 | 提醒仅展示 urgent/high，其余折叠 | `src/pages/execute/index.tsx` | 0.25d |
| 3.2 | 可选：右侧仅保留提醒，助手完全依赖全局侧边栏 | - | - |

---

## 8. 验收标准

| 指标 | 标准 |
|------|------|
| **主区核心** | 主区首屏可见「今日行程」或「全部行程」时间线 |
| **认知负荷** | 首屏信息块 ≤ 5（行程时间线、下一步、提醒摘要、折叠区入口、动作栏） |
| **任务完成** | 用户能在 3 秒内定位「当前项」和「下一项」 |
| **无重复** | 今日行程仅在一处展示（主区），右侧无重复今日时间线 |

---

## 9. 埋点建议

| 事件 | 属性 | 用途 |
|------|------|------|
| `execute_page_view` | `has_next_stop`, `reminders_count` | 页面加载分析 |
| `execute_itinerary_tab_switch` | `tab` (today/all) | Tab 使用率 |
| `execute_collapsible_toggle` | `section` (realtime/forecast) | 折叠区使用率 |
| `execute_quick_action_click` | `action` (delay/skip/replace) | 快捷操作使用率 |

---

## 10. 理论依据

- **Cognitive Load Theory**（Sweller）：内在/外在/相关负荷区分，已核验
- **Miller's Law**（1956）：工作记忆 7±2 块，已核验
- **Progressive Disclosure**（Nielsen）：复杂信息渐进呈现，已核验
- **TripNARA 产品哲学**：可执行优先、决策优先

---

## 11. 待确认问题

1. 「全部」模式下，多日行程的展示形式：按日折叠，还是平铺？
2. 下一步卡片与行程时间线的关系：内嵌在时间线顶部，还是独立卡片？
3. 移动端布局：主区行程时间线是否全宽，右侧提醒如何呈现？
