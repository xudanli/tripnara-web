# Dashboard 页面改造 - 多角色协作方案

**更新时间**：2026-02-01  
**改造目标**：让 Dashboard 符合 TripNARA "决策优先"的产品定位和用户心智

---

## 📋 问题诊断

### 当前 Dashboard 的问题

**产品经理视角（Danny）**：
- ❌ **缺少"决策感"**：当前 Dashboard 更像传统的"功能入口"页面，没有体现 TripNARA "决策优先"的核心价值
- ❌ **信息架构不符合用户心智**：用户期望看到的是"路线责任系统"的决策状态，而不是"工具集合"
- ❌ **缺少核心元素**：没有展示三人格（Abu/Dr.Dre/Neptune）、决策状态、证据链等核心元素
- ❌ **用户旅程不清晰**：没有引导用户理解"决策型旅行"的工作流程

**人机交互设计专家视角（Dr. Sarah Chen）**：
- ❌ **认知负荷错配**：用户需要理解"决策优先"的概念，但当前页面没有提供足够的上下文
- ❌ **信息层级不清晰**：继续编辑卡片、快捷入口、创建行程入口的优先级没有体现"决策优先"
- ❌ **缺少渐进式披露**：没有引导用户理解"Should-Exist Gate"、"三人格决策"等核心概念

**体验设计专家视角（Alex）**：
- ❌ **用户旅程断裂**：从 Dashboard 到规划工作台的旅程没有体现"决策优先"的流程
- ❌ **缺少状态可视化**：没有展示当前行程的决策状态（ALLOW/NEED_ADJUST/REJECT）
- ❌ **缺少信任建立**：没有展示三人格的决策过程、证据链，用户无法建立信任

---

## 🎯 改造目标

### 核心目标

**让 Dashboard 成为"决策系统的控制台"，而不是"功能入口的集合"**

### 具体目标

1. **体现"决策优先"的产品哲学**
   - 展示当前行程的决策状态（Should-Exist Gate 结果）
   - 展示三人格的决策过程（Abu/Dr.Dre/Neptune）
   - 展示关键决策点（需要用户确认的事项）

2. **符合用户心智模型**
   - 用户期望看到的是"路线责任系统"的决策状态
   - 用户期望理解"为什么这样判断"（决策日志、证据链）
   - 用户期望看到"需要我做什么"（待确认的决策点）

3. **降低认知负荷**
   - 渐进式披露：默认展示关键信息，详情可展开
   - 信息分层：决策状态 > 快捷入口 > 创建入口
   - 上下文帮助：提供 Tooltip、Inline Help 解释核心概念

---

## 🏗️ 改造方案

### 方案概述

**新的 Dashboard 信息架构**：

```
DashboardPage
├── DecisionStatusSection (决策状态区域) - 新增
│   ├── CurrentTripDecisionCard (当前行程决策卡片)
│   │   ├── 行程基本信息（目的地、日期、天数）
│   │   ├── 决策状态（ALLOW/NEED_ADJUST/REJECT）
│   │   ├── 三人格评审结果（Abu/Dr.Dre/Neptune）
│   │   └── 关键决策点（需要用户确认的事项）
│   │
│   └── DecisionSummaryCard (决策摘要卡片) - 可选
│       ├── 最近决策日志（最近3条）
│       └── 证据链摘要（关键证据）
│
├── ContinueEditingCard (继续编辑卡片) - 保留但改造
│   ├── 行程基本信息
│   ├── 决策状态指示器（新增）
│   ├── "继续规划"按钮
│   └── "打开总览"按钮
│
├── QuickAccessSection (快捷入口) - 保留但弱化
│   ├── 我的行程
│   ├── 国家数据库
│   └── 路线模版
│
└── CreateTripSection (创建行程入口) - 保留
    ├── 对话创建
    └── 表单创建
```

### 详细设计

#### 1. DecisionStatusSection（决策状态区域）- 新增

**产品经理视角（Danny）**：

**目标**：让用户第一眼看到当前行程的决策状态，理解"路线是否应该存在"

**内容设计**：
- **当前行程决策卡片**：
  - 如果有当前行程（`status === 'PLANNING'`），显示决策状态
  - 展示三人格评审结果（Abu/Dr.Dre/Neptune）
  - 展示关键决策点（需要用户确认的事项）
  - 展示预算评估结果（`ALLOW`/`NEED_ADJUST`/`REJECT`）

**数据需求**：
- 调用 `GET /planning-workbench/plans/:planId/budget-evaluation` 获取预算评估结果
- 调用 `GET /planning-workbench/budget/decision-log` 获取决策日志
- 调用 `GET /trips/:id` 获取行程详情

**人机交互设计专家视角（Dr. Sarah Chen）**：

**认知负荷优化**：
- **默认状态**：显示决策状态摘要（ALLOW/NEED_ADJUST/REJECT），三人格评审结果（图标 + 状态）
- **展开状态**：点击"查看详情" → 展开决策日志、证据链
- **符合 Miller's Law**：默认显示不超过 7 个元素（行程信息 + 3个三人格状态 + 决策状态 + 操作按钮）

**信息架构**：
- **一级信息**：决策状态（ALLOW/NEED_ADJUST/REJECT）- 最突出
- **二级信息**：三人格评审结果（Abu/Dr.Dre/Neptune）- 次要
- **三级信息**：决策日志、证据链 - 可展开

**体验设计专家视角（Alex）**：

**用户旅程**：
1. 用户登录 → Dashboard 加载
2. **关键决策点**：是否显示决策状态？
   - **条件**：有当前行程（`status === 'PLANNING'`）
   - **展示**：显示决策状态卡片，突出显示需要用户确认的事项
3. **用户操作**：点击"查看详情" → 展开决策日志、证据链
4. **用户操作**：点击"继续规划" → 跳转到规划工作台

**交互流程**：
- **默认状态**：显示决策状态摘要（ALLOW/NEED_ADJUST/REJECT），三人格评审结果（图标 + 状态）
- **悬停效果**：显示更多信息（决策时间、关键证据）
- **点击"查看详情"**：展开决策日志、证据链（使用抽屉或展开区域）

#### 2. ContinueEditingCard（继续编辑卡片）- 改造

**产品经理视角（Danny）**：

**改造目标**：在继续编辑卡片中增加决策状态指示器，让用户快速了解当前行程的决策状态

**改造内容**：
- **保留**：行程基本信息、最后编辑时间、"继续规划"按钮、"打开总览"按钮
- **新增**：决策状态指示器（ALLOW/NEED_ADJUST/REJECT）
- **新增**：三人格评审状态（图标 + 简要状态）

**人机交互设计专家视角（Dr. Sarah Chen）**：

**认知负荷优化**：
- **信息层级**：决策状态指示器应该突出显示（使用颜色、图标）
- **渐进式披露**：默认显示决策状态摘要，详情在规划工作台展示
- **符合 Fitts's Law**：决策状态指示器应该有足够的点击区域（最小 44×44px）

**体验设计专家视角（Alex）**：

**交互设计**：
- **决策状态指示器**：
  - **ALLOW**：绿色，显示"✓ 已通过"
  - **NEED_ADJUST**：黄色，显示"⚠ 需要调整"
  - **REJECT**：红色，显示"✗ 已拒绝"
- **点击决策状态指示器**：跳转到规划工作台的决策日志页面

#### 3. QuickAccessSection（快捷入口）- 弱化

**产品经理视角（Danny）**：

**改造目标**：弱化快捷入口的视觉权重，因为"决策状态"应该是最突出的

**改造内容**：
- **保留**：三个核心入口（我的行程、国家数据库、路线模版）
- **弱化**：降低视觉权重（使用更浅的背景色、更小的卡片）
- **位置调整**：放在决策状态区域之后

**人机交互设计专家视角（Dr. Sarah Chen）**：

**信息层级**：
- **一级信息**：决策状态区域（最突出）
- **二级信息**：继续编辑卡片（次要）
- **三级信息**：快捷入口（弱化）

**体验设计专家视角（Alex）**：

**视觉设计**：
- **卡片样式**：使用更浅的背景色（`bg-slate-50` 而不是 `bg-blue-50`）
- **图标大小**：使用更小的图标（`w-8 h-8` 而不是 `w-12 h-12`）
- **间距**：减少卡片间距（`gap-4` 而不是 `gap-6`）

#### 4. CreateTripSection（创建行程入口）- 保留

**产品经理视角（Danny）**：

**保留原因**：创建行程是用户的核心任务，必须保留

**优化建议**：
- **增加说明文字**：解释"对话创建"和"表单创建"的区别
- **新用户引导**：首次使用显示引导提示

---

## 📐 布局设计

### 桌面端布局（≥1024px）

```
┌─────────────────────────────────────────────────────────┐
│  Dashboard TopBar                                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │  DecisionStatusSection (决策状态区域)              │ │
│  │  ┌─────────────────────────────────────────────┐ │ │
│  │  │  CurrentTripDecisionCard                    │ │ │
│  │  │  - 行程信息                                  │ │ │
│  │  │  - 决策状态: ALLOW/NEED_ADJUST/REJECT      │ │ │
│  │  │  - 三人格评审: ✓/⚠/✗                        │ │ │
│  │  │  - 关键决策点: [需要确认的事项]              │ │ │
│  │  └─────────────────────────────────────────────┘ │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │  ContinueEditingCard (继续编辑卡片)                │ │
│  │  - 行程信息 + 决策状态指示器                       │ │
│  │  - [继续规划] [打开总览]                          │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │  QuickAccessSection (快捷入口 - 弱化)              │ │
│  │  ┌──────┐ ┌──────┐ ┌──────┐                      │ │
│  │  │ 行程 │ │ 国家 │ │ 路线 │                      │ │
│  │  └──────┘ └──────┘ └──────┘                      │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │  CreateTripSection (创建行程入口)                  │ │
│  │  [对话创建] [表单创建]                             │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 移动端布局（<768px）

```
┌─────────────────────────┐
│  Dashboard TopBar       │
├─────────────────────────┤
│                         │
│  ┌───────────────────┐ │
│  │ DecisionStatus     │ │
│  │ Section            │ │
│  └───────────────────┘ │
│                         │
│  ┌───────────────────┐ │
│  │ ContinueEditing    │ │
│  │ Card               │ │
│  └───────────────────┘ │
│                         │
│  ┌───────────────────┐ │
│  │ QuickAccess       │ │
│  │ (单列)            │ │
│  └───────────────────┘ │
│                         │
│  ┌───────────────────┐ │
│  │ CreateTrip        │ │
│  │ (垂直排列)        │ │
│  └───────────────────┘ │
│                         │
└─────────────────────────┘
```

---

## 🎨 视觉设计

### 决策状态指示器设计

**ALLOW（已通过）**：
- **颜色**：绿色（`bg-green-50`、`text-green-700`、`border-green-200`）
- **图标**：`CheckCircle`（✓）
- **文案**："已通过" 或 "路线可行"

**NEED_ADJUST（需要调整）**：
- **颜色**：黄色（`bg-yellow-50`、`text-yellow-700`、`border-yellow-200`）
- **图标**：`AlertTriangle`（⚠）
- **文案**："需要调整" 或 "需要优化"

**REJECT（已拒绝）**：
- **颜色**：红色（`bg-red-50`、`text-red-700`、`border-red-200`）
- **图标**：`XCircle`（✗）
- **文案**："已拒绝" 或 "路线不可行"

### 三人格评审状态设计

**Abu（安全与现实守门）**：
- **图标**：`Shield` 或 `Lock`
- **状态**：`ALLOW`（绿色）、`NEED_ADJUST`（黄色）、`REJECT`（红色）

**Dr.Dre（节奏与体感）**：
- **图标**：`Activity` 或 `Zap`
- **状态**：`ALLOW`（绿色）、`NEED_ADJUST`（黄色）、`REJECT`（红色）

**Neptune（空间结构修复）**：
- **图标**：`Compass` 或 `Navigation`
- **状态**：`ALLOW`（绿色）、`NEED_ADJUST`（黄色）、`REJECT`（红色）

---

## 🔧 技术实现

### 新增组件

1. **DecisionStatusSection**（`src/components/dashboard/DecisionStatusSection.tsx`）
   - 显示当前行程的决策状态
   - 展示三人格评审结果
   - 展示关键决策点

2. **CurrentTripDecisionCard**（`src/components/dashboard/CurrentTripDecisionCard.tsx`）
   - 决策状态卡片
   - 三人格评审结果展示
   - 关键决策点列表

3. **DecisionStatusIndicator**（`src/components/dashboard/DecisionStatusIndicator.tsx`）
   - 决策状态指示器组件
   - 支持 ALLOW/NEED_ADJUST/REJECT 三种状态

4. **PersonaStatusBadge**（`src/components/dashboard/PersonaStatusBadge.tsx`）
   - 三人格状态徽章组件
   - 显示三人格的评审状态

### API 调用

**新增 API 调用**：
- `GET /planning-workbench/plans/:planId/budget-evaluation` - 获取预算评估结果
- `GET /planning-workbench/budget/decision-log` - 获取决策日志
- `GET /trips/:id` - 获取行程详情（如果还没有）

**修改现有 API 调用**：
- `tripsApi.getAll()` - 获取行程列表（已有）
- `tripsApi.getById(tripId)` - 获取行程详情（已有）

### 文件修改清单

**新增文件**：
- `src/components/dashboard/DecisionStatusSection.tsx`
- `src/components/dashboard/CurrentTripDecisionCard.tsx`
- `src/components/dashboard/DecisionStatusIndicator.tsx`
- `src/components/dashboard/PersonaStatusBadge.tsx`

**修改文件**：
- `src/pages/Dashboard.tsx` - 集成 DecisionStatusSection
- `src/components/dashboard/ContinueEditingCard.tsx` - 增加决策状态指示器
- `src/components/dashboard/QuickAccessSection.tsx` - 弱化视觉权重

---

## ✅ 验收标准

### 功能验收

1. ✅ **决策状态区域**：
   - 有当前行程时，显示决策状态卡片
   - 显示三人格评审结果（Abu/Dr.Dre/Neptune）
   - 显示关键决策点（需要用户确认的事项）
   - 点击"查看详情" → 展开决策日志、证据链

2. ✅ **继续编辑卡片**：
   - 显示决策状态指示器（ALLOW/NEED_ADJUST/REJECT）
   - 显示三人格评审状态（图标 + 状态）
   - 点击决策状态指示器 → 跳转到规划工作台

3. ✅ **快捷入口**：
   - 视觉权重弱化（更浅的背景色、更小的卡片）
   - 位置调整（放在决策状态区域之后）

### 体验验收

1. ✅ **认知负荷**：
   - 信息层级清晰（决策状态 > 继续编辑 > 快捷入口）
   - 符合 Miller's Law（每个区域不超过 7 个元素）
   - 符合渐进式披露（默认摘要，详情可展开）

2. ✅ **用户心智**：
   - 用户能够理解"决策优先"的产品哲学
   - 用户能够看到"路线是否应该存在"的决策状态
   - 用户能够理解"为什么这样判断"（决策日志、证据链）

3. ✅ **可用性**：
   - 关键操作易于发现和理解
   - 支持键盘导航
   - 支持屏幕阅读器

---

## 📊 埋点清单

### 新增埋点

1. **决策状态区域展示**：
   - 事件名：`dashboard_decision_status_viewed`
   - 属性：`trip_id`、`decision_status`、`has_pending_decisions`

2. **决策详情展开**：
   - 事件名：`dashboard_decision_details_expanded`
   - 属性：`trip_id`、`decision_status`

3. **三人格评审结果查看**：
   - 事件名：`dashboard_persona_status_viewed`
   - 属性：`trip_id`、`persona_type`、`persona_status`

4. **决策状态指示器点击**：
   - 事件名：`dashboard_decision_indicator_clicked`
   - 属性：`trip_id`、`decision_status`、`source`（continue_editing_card / decision_status_section）

---

## 🚀 实施优先级

### P0（必须实现）

1. ✅ **新增 DecisionStatusSection**：
   - 显示当前行程的决策状态
   - 展示三人格评审结果
   - 展示关键决策点

2. ✅ **改造 ContinueEditingCard**：
   - 增加决策状态指示器
   - 增加三人格评审状态

3. ✅ **弱化 QuickAccessSection**：
   - 降低视觉权重
   - 调整位置

### P1（重要）

1. ⚠️ **决策详情展开功能**：
   - 点击"查看详情" → 展开决策日志、证据链

2. ⚠️ **新用户引导**：
   - 首次使用显示引导提示，解释"决策优先"的概念

### P2（可选）

1. 📝 **决策摘要卡片**：
   - 显示最近决策日志（最近3条）
   - 显示证据链摘要（关键证据）

2. 📝 **统计数据展示**：
   - 显示决策统计（通过率、调整率、拒绝率）

---

## 📝 待确认问题

1. **决策状态数据来源**：
   - 当前是否有 API 可以获取决策状态？
   - 如果没有，是否需要新增 API？

2. **三人格评审结果**：
   - 当前是否有 API 可以获取三人格评审结果？
   - 如果没有，是否需要新增 API？

3. **关键决策点**：
   - 如何定义"关键决策点"？
   - 是否需要新增 API 获取关键决策点？

---

**状态**：✅ 多角色协作方案完成，等待产品决策和技术实现
