# 侧边栏布局设计分析

**参考**: ChatGPT/Cursor 风格的侧边栏布局  
**应用场景**: Planning Assistant V2  
**分析时间**: 2026-02-08

---

## 📐 布局结构分析

### 1. **垂直分层结构**

```
┌─────────────────────────┐
│  顶部：Logo + 全局操作   │  ← 固定区域
├─────────────────────────┤
│                         │
│   GPT/角色选择区域      │  ← 可折叠分组
│   - 天思引              │
│   - Graphic Designer    │
│   - 电商产品经理         │
│   - 探索 GPT            │
├─────────────────────────┤
│                         │
│   项目文件夹区域         │  ← 可折叠分组
│   - 新项目              │
│   - 产品经理方法论       │
│   - 报价                │
│   - 人性                │
├─────────────────────────┤
│                         │
│   聊天历史区域           │  ← 动态内容，可滚动
│   - AI工具商业化...     │
│   - TripNARA 商标...    │
│   - New chat (x4)      │
│                         │
├─────────────────────────┤
│  底部：用户信息 + 升级   │  ← 固定区域
└─────────────────────────┘
```

### 2. **设计特点**

#### ✅ **优势**：
1. **清晰的信息层级**
   - 顶部：全局操作（最高优先级）
   - 中间：分类内容（可折叠分组）
   - 底部：用户信息（固定可见）

2. **可折叠分组**
   - GPT、项目等可以折叠/展开
   - 节省空间，提高可读性

3. **滚动区域明确**
   - 只有中间内容区域可滚动
   - 顶部和底部固定，不会丢失重要操作

4. **视觉层次清晰**
   - 灰色分组标题区分不同区域
   - 图标 + 文字的组合提高识别度

5. **历史记录管理**
   - 显示最近的聊天记录
   - 支持快速切换和继续对话

---

## 🎯 应用到 Planning Assistant V2 的设计方案

### 方案 A：完整侧边栏（推荐）

```
┌─────────────────────────┐
│  TripNARA Logo          │
│  [+ 新对话] [🔍 搜索]    │
├─────────────────────────┤
│                         │
│  智能体角色              │
│  ▼ NARA 规划助手        │
│    - 规划工作台模式      │
│    - 行程执行模式        │
│    - 探索模式           │
│                         │
│  项目/行程              │
│  ▼ 我的行程             │
│    - 冰岛7日游          │
│    - 日本樱花之旅        │
│    - 新项目             │
│                         │
│  对话历史                │
│  - 关于冰岛酒店推荐     │
│  - 调整行程预算          │
│  - 查看天气信息         │
│  - New chat (x3)       │
│                         │
├─────────────────────────┤
│  👤 用户头像            │
│     用户名               │
│     [升级]              │
└─────────────────────────┘
```

### 方案 B：简化侧边栏（当前优化）

```
┌─────────────────────────┐
│  TripNARA Logo          │
│  [+ 新对话]              │
├─────────────────────────┤
│                         │
│  当前行程上下文          │
│  📍 冰岛7日游           │
│  📅 2026-03-15 ~ 21     │
│  💰 ¥50,000             │
│                         │
│  对话历史                │
│  - 关于冰岛酒店推荐     │
│  - 调整行程预算          │
│  - 查看天气信息         │
│  - New chat (x3)       │
│                         │
├─────────────────────────┤
│  👤 用户信息            │
└─────────────────────────┘
```

---

## 🔧 实现建议

### 1. **组件结构**

```typescript
// PlanningAssistantSidebar.tsx
export function PlanningAssistantSidebar() {
  return (
    <aside className="flex flex-col h-full bg-white border-r">
      {/* 顶部：Logo + 操作 */}
      <SidebarHeader />
      
      {/* 中间：可滚动内容 */}
      <div className="flex-1 overflow-y-auto">
        {/* 智能体角色选择（可选） */}
        <AgentRolesSection />
        
        {/* 当前行程上下文 */}
        <TripContextSection tripId={tripId} />
        
        {/* 对话历史 */}
        <ConversationHistorySection 
          sessions={sessions}
          onSelectSession={handleSelectSession}
        />
      </div>
      
      {/* 底部：用户信息 */}
      <SidebarFooter />
    </aside>
  );
}
```

### 2. **关键功能**

#### **对话历史管理**
```typescript
interface ConversationSession {
  id: string;
  title: string; // 自动生成或用户自定义
  preview: string; // 最后一条消息的预览
  timestamp: Date;
  tripId?: string; // 关联的行程ID
  messageCount: number;
}

// 从 API 获取会话列表
const { sessions } = useConversationSessions(userId);
```

#### **快速切换会话**
```typescript
const handleSelectSession = (sessionId: string) => {
  // 切换到选中的会话
  setActiveSessionId(sessionId);
  // 加载该会话的消息历史
  loadSessionMessages(sessionId);
};
```

#### **新对话创建**
```typescript
const handleNewConversation = () => {
  // 创建新会话
  const newSession = await createSession(userId);
  // 切换到新会话
  setActiveSessionId(newSession.id);
  // 清空当前消息
  clearMessages();
};
```

### 3. **数据流设计**

```
用户操作
  ↓
侧边栏组件
  ↓
PlanningAssistant 组件
  ↓
useChatV2 Hook
  ↓
API 调用
```

---

## 📊 对比分析

### 当前实现 vs 新设计

| 特性 | 当前实现 | 新设计（参考图） |
|------|---------|----------------|
| **对话历史** | ❌ 无 | ✅ 显示最近对话 |
| **会话管理** | ❌ 单会话 | ✅ 多会话切换 |
| **上下文显示** | ✅ 有 | ✅ 有（更清晰） |
| **快速操作** | ✅ 有 | ✅ 有（更丰富） |
| **角色选择** | ❌ 无 | ✅ 可选 |
| **项目管理** | ❌ 无 | ✅ 可选 |

---

## 🎨 UI/UX 建议

### 1. **视觉设计**
- **分组标题**：灰色背景，小字号，大写字母
- **列表项**：hover 效果，选中状态高亮
- **图标**：统一的图标风格，16-20px 大小
- **间距**：分组之间 16px，列表项之间 8px

### 2. **交互设计**
- **折叠/展开**：点击分组标题切换
- **拖拽排序**：对话历史可以拖拽排序（可选）
- **右键菜单**：删除、重命名、归档等操作
- **搜索**：支持搜索对话历史

### 3. **响应式设计**
- **桌面端**：固定宽度 240-280px
- **平板端**：可折叠，默认收起
- **移动端**：全屏抽屉模式

---

## 🚀 实施优先级

### Phase 1：核心功能（必须）
1. ✅ 对话历史列表显示
2. ✅ 会话切换功能
3. ✅ 新对话创建
4. ✅ 当前行程上下文显示

### Phase 2：增强功能（重要）
5. ⭐ 对话标题自动生成
6. ⭐ 对话搜索功能
7. ⭐ 对话删除/归档
8. ⭐ 智能体角色选择

### Phase 3：高级功能（可选）
9. 💡 对话分组/标签
10. 💡 对话导出
11. 💡 对话分享
12. 💡 拖拽排序

---

## 📝 API 需求

### 1. **获取会话列表**
```
GET /api/agent/planning-assistant/v2/sessions?userId=xxx&limit=20
```

### 2. **创建新会话**
```
POST /api/agent/planning-assistant/v2/sessions
{
  "userId": "user_123",
  "title": "新对话" // 可选，自动生成
}
```

### 3. **更新会话标题**
```
PATCH /api/agent/planning-assistant/v2/sessions/:sessionId
{
  "title": "关于冰岛酒店推荐"
}
```

### 4. **删除会话**
```
DELETE /api/agent/planning-assistant/v2/sessions/:sessionId
```

### 5. **获取会话消息历史**
```
GET /api/agent/planning-assistant/v2/sessions/:sessionId/history
```

---

## ✅ 总结

### 优势
1. **用户体验提升**：快速切换对话，查看历史
2. **信息组织清晰**：分组管理，层次分明
3. **操作效率提高**：一键创建新对话，快速访问历史

### 挑战
1. **数据管理**：需要管理多个会话的状态
2. **性能优化**：大量历史记录时的加载和渲染
3. **状态同步**：切换会话时的状态管理

### 建议
- **渐进式实施**：先实现核心功能，再逐步增强
- **性能优先**：使用虚拟滚动处理大量历史记录
- **用户测试**：收集反馈，迭代优化

---

**下一步行动**：
1. 确认设计方案
2. 评估 API 支持情况
3. 制定开发计划
4. 开始实施 Phase 1
