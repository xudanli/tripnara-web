# 行程详情页 - 评审决策总结

## 文档信息

- **评审日期**: 2026-02-05
- **评审状态**: ✅ 部分决策已确认
- **评审人员**: 产品经理、前端设计师

---

## ✅ 已确认的决策

### 1. 健康度计算逻辑 ✅

**决策内容**：采用**木桶效应**原理计算健康度

**计算公式**：
```
健康度 = min(可执行度, 缓冲, (100-风险), 成本)
```

**说明**：
- 整体健康度由4个维度中的最低分决定
- 这样更能反映行程的真实可执行性
- 如果任何一个维度得分低，整体健康度就会低
- 符合"短板效应"，强调全面优化

**影响**：
- 后端需要修改健康度计算逻辑
- 前端展示需要统一使用这个计算结果
- 用户更容易理解：只要有一个维度有问题，整体就有问题

---

### 2. 状态转换规则 ✅

**决策内容**：**禁止** IN_PROGRESS → PLANNING 状态转换

**完整状态转换规则**：
```
✅ PLANNING → IN_PROGRESS：允许（需要确认）
✅ PLANNING → CANCELLED：允许（需要确认）
❌ PLANNING → COMPLETED：不允许（必须先IN_PROGRESS）
✅ IN_PROGRESS → COMPLETED：允许（需要确认）
✅ IN_PROGRESS → CANCELLED：允许（需要确认）
❌ IN_PROGRESS → PLANNING：禁止（已确认）
✅ COMPLETED → CANCELLED：允许（需要确认）
❌ COMPLETED → PLANNING/IN_PROGRESS：不允许
```

**说明**：
- 保持状态转换的单向性，避免用户困惑
- 一旦开始执行，就不能返回规划状态
- 如果需要重新规划，应该创建新行程

**影响**：
- 前端需要隐藏 IN_PROGRESS → PLANNING 的选项
- 状态转换菜单需要更新
- 用户引导需要说明：如果需要重新规划，请创建新行程

---

### 3. Auto综合优化范围 ✅

**决策内容**：Auto综合优化**只应用高优先级建议**

**优化范围**：
- 只应用严重程度为"红线"（blocker）的高优先级建议
- 不应用"警告"（warn）和"提示"（info）级别的建议
- 用户仍可以手动应用其他级别的建议

**说明**：
- 只自动处理必须解决的问题
- 避免过度优化，给用户保留控制权
- 用户可以查看所有建议，但Auto综合只处理最紧急的

**影响**：
- 后端API需要支持按严重程度筛选建议
- 前端Auto综合按钮需要明确说明只应用高优先级建议
- 确认弹窗需要显示"将应用X条高优先级建议"

---

### 4. 健康度展示位置 ✅

**决策内容**：健康度**只在头部显示**（推荐方案）

**展示方案**：
- ✅ 头部区域：显示健康度（整体健康度 + 4个维度指标）
- ❌ 侧边栏：不显示健康度，改为显示其他辅助信息
  - 预算概览
  - 助手中心（建议列表）
  - 其他辅助信息

**说明**：
- 避免信息重复，提高信息利用率
- 侧边栏空间用于展示更丰富的辅助信息
- 健康度作为核心信息，在头部统一展示更突出

**影响**：
- 需要修改侧边栏设计，移除健康度详情
- 头部健康度区域需要更详细的设计
- 侧边栏需要重新规划内容布局

---

## 📋 设计调整建议

### 1. 健康度计算逻辑调整

**需要调整的内容**：
- [ ] 更新后端健康度计算API，使用木桶效应公式
- [ ] 更新前端健康度展示组件，确保显示一致
- [ ] 更新健康度说明文档，解释木桶效应原理

**技术实现**：
```typescript
// 后端计算逻辑
const overallHealth = Math.min(
  dimensions.executable.score,    // 可执行度
  dimensions.buffer.score,        // 缓冲
  100 - dimensions.risk.score,    // 风险（反转）
  dimensions.cost.score           // 成本
);
```

---

### 2. 状态转换规则调整

**需要调整的内容**：
- [ ] 更新状态转换菜单，移除 IN_PROGRESS → PLANNING 选项
- [ ] 更新状态转换确认弹窗文案
- [ ] 更新用户引导，说明重新规划需要创建新行程

**前端实现**：
```typescript
// 状态转换选项
const statusOptions = {
  PLANNING: [
    { status: 'IN_PROGRESS', label: '进行中', icon: '🚀' },
    { status: 'CANCELLED', label: '已取消', icon: '❌' }
    // 移除 PLANNING 选项（不允许返回）
  ],
  IN_PROGRESS: [
    { status: 'COMPLETED', label: '已完成', icon: '✅' },
    { status: 'CANCELLED', label: '已取消', icon: '❌' }
    // 移除 PLANNING 选项（禁止返回）
  ],
  // ...
};
```

---

### 3. Auto综合优化调整

**需要调整的内容**：
- [ ] 更新Auto综合按钮文案："Auto 综合（高优先级）"
- [ ] 更新确认弹窗，明确显示"将应用X条高优先级建议"
- [ ] 更新后端API，支持按严重程度筛选建议

**前端实现**：
```typescript
// Auto综合优化
const handleAutoOptimize = async () => {
  // 只获取高优先级建议（blocker）
  const highPrioritySuggestions = suggestions.filter(
    s => s.severity === 'blocker'
  );
  
  // 显示确认弹窗
  showConfirmDialog({
    title: 'Auto 综合优化',
    description: `将应用 ${highPrioritySuggestions.length} 条高优先级建议`,
    suggestions: highPrioritySuggestions
  });
};
```

---

### 4. 健康度展示位置调整

**需要调整的内容**：
- [ ] 移除侧边栏健康度详情组件
- [ ] 增强头部健康度区域设计
- [ ] 重新规划侧边栏内容布局

**设计调整**：
```
头部区域（Header Zone）
├── 健康度区域（Health Zone）
│   ├── 整体健康度（79%）[大号显示]
│   ├── 4个维度指标 [详细展示]
│   │   ├── 可执行度（85%）[可点击查看详情]
│   │   ├── 缓冲（70%）[可点击查看详情]
│   │   ├── 风险（25%）[可点击查看详情]
│   │   └── 成本（80%）[可点击查看详情]
│   └── 快速操作
│       ├── Auto综合按钮
│       └── 进入规划工作台按钮

侧边栏（Sidebar Zone）
├── 预算概览（Budget Overview）
│   ├── 总预算
│   ├── 已支出
│   ├── 剩余预算
│   └── 预算进度条
└── 助手中心（Assistant Center）
    ├── Tab筛选
    └── 建议卡片列表
```

---

## ⚠️ 待确认的问题

### 1. 建议应用确认流程

**问题**：应用单个建议是否需要确认弹窗？还是可以直接应用？

**建议**：
- 高优先级建议（blocker）：需要确认弹窗
- 警告和建议级别：可以直接应用（可选确认）

**待确认**：需要HCI/UX确认

---

### 2. Auto综合优化反馈

**问题**：Auto综合优化可能需要较长时间（5-10秒），如何提供更好的反馈？

**建议**：
- 显示全屏加载遮罩
- 显示进度条（如果后端支持）
- 显示"正在优化中..."文案

**待确认**：需要HCI/UX确认

---

### 3. 健康度颜色编码无障碍

**问题**：健康度颜色编码是否符合无障碍设计标准（WCAG AA）？

**建议**：
- 检查颜色对比度
- 不仅依赖颜色，还要使用图标和文字
- 支持色盲用户

**待确认**：需要Visual Designer确认

---

## 📊 评审进度

### 已完成（4/12）

- [x] ✅ PM-001：确认健康度计算公式（木桶效应）
- [x] ✅ PM-002：确认状态转换规则（禁止IN_PROGRESS→PLANNING）
- [x] ✅ PM-003：确认Auto综合优化范围（只应用高优先级）
- [x] ✅ HCI-001：确认健康度展示位置（只在头部显示）

### 待完成（8/12）

- [ ] HCI-002：优化建议应用确认流程
- [ ] HCI-003：设计Auto综合优化反馈方案
- [ ] VD-001：检查健康度颜色编码无障碍标准
- [ ] VD-002：确认响应式断点
- [ ] VD-003：定义设计Token并添加到设计系统
- [ ] FE-001：确认健康度数据同步方案
- [ ] FE-002：评估应用建议撤销功能
- [ ] FE-003：设计Auto综合优化进度显示方案

---

## 🎯 下一步行动

1. **更新设计文档**（1天）
   - 根据已确认的决策更新设计文档
   - 调整健康度展示位置设计
   - 更新状态转换规则

2. **完成剩余评审**（2-3天）
   - HCI/UX确认建议应用确认流程
   - HCI/UX设计Auto综合优化反馈方案
   - Visual Designer检查无障碍标准

3. **技术方案设计**（2-3天）
   - 前端设计师确认技术实现方案
   - 后端接口对接确认
   - 组件设计确认

4. **开始开发**（预计2.5-4周）
   - 第一阶段：健康度统一展示（1周）
   - 第二阶段：改进建议优化（1周）
   - 第三阶段：Auto综合优化（1-2周）

---

**文档状态**: ✅ 部分决策已确认  
**最后更新**: 2026-02-05  
**下次评审**: [待定]
