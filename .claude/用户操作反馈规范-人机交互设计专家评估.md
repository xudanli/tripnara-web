# 用户操作反馈规范 - 人机交互设计专家评估

> 评估时间：2026-02-05  
> 评估范围：设置页面及全站用户操作反馈

## 一、问题分析

### 1.1 当前问题

根据用户反馈和代码检查，发现以下问题：

1. **设置页面保存操作缺少反馈**
   - 点击"保存偏好"后，虽然有 toast 代码，但可能未正确显示
   - 需要检查 Toaster 组件是否正确渲染

2. **反馈机制不统一**
   - 部分操作使用 toast，部分使用页面内卡片提示
   - 缺少统一的反馈规范

3. **反馈及时性不足**
   - 某些操作缺少即时反馈（< 100ms）
   - 加载状态反馈不够明显

### 1.2 认知科学分析

基于**认知科学理论**和**人机交互原则**：

#### Feedback（反馈）原则
- **及时性**：反馈应该在 < 100ms 内显示（即时反馈），< 1s 内完成（视觉反馈）
- **清晰性**：用户必须能理解发生了什么
- **一致性**：相同类型的操作应该有相同的反馈方式

#### 认知负荷理论
- **外在认知负荷**：通过清晰的反馈减少用户的不确定性
- **相关认知负荷**：通过反馈帮助用户学习系统行为

## 二、用户操作分类与反馈规范

### 2.1 操作类型分类

根据**操作的重要性和影响范围**，将用户操作分为三类：

#### A类：关键操作（Critical Actions）
- **特点**：不可逆、影响重大、需要确认
- **示例**：删除账户、提交方案、确认危险操作
- **反馈要求**：
  - 操作前：确认对话框（NEED_CONFIRM）
  - 操作中：明确的加载状态（Spinner + 文字说明）
  - 操作成功：Toast + 页面内成功提示（双重反馈）
  - 操作失败：Toast + 页面内错误提示（双重反馈）

#### B类：重要操作（Important Actions）
- **特点**：可逆、影响较大、需要用户关注
- **示例**：保存偏好、更新账户信息、提交表单
- **反馈要求**：
  - 操作中：按钮状态变化（disabled + loading）
  - 操作成功：Toast 提示（3秒）
  - 操作失败：Toast 提示（5秒）+ 页面内错误提示

#### C类：常规操作（Normal Actions）
- **特点**：可逆、影响较小、常规交互
- **示例**：切换标签、展开折叠、选择选项
- **反馈要求**：
  - 操作中：即时视觉反馈（< 100ms）
  - 操作成功：可选的 Toast 提示（2秒）或页面内状态更新

### 2.2 反馈时机规范

基于**Fitts's Law**和**反馈理论**：

| 操作阶段 | 反馈时机 | 反馈方式 | 持续时间 |
|---------|---------|---------|---------|
| **操作前** | 点击按钮时 | 按钮按下效果（< 50ms） | 即时 |
| **操作中** | API 调用期间 | Loading 状态（Spinner + 文字） | 直到完成 |
| **操作成功** | API 返回成功 | Toast + 页面内提示 | Toast: 3秒，页面内: 3秒 |
| **操作失败** | API 返回错误 | Toast + 页面内错误提示 | Toast: 5秒，页面内: 直到用户关闭 |

## 三、反馈组件规范

### 3.1 Toast 通知规范

**使用场景**：
- 所有 A类 和 B类 操作的成功/失败反馈
- 系统级通知（如网络错误、权限不足）

**视觉规范**（由视觉设计师定义）：
- **成功**：绿色主题，CheckCircle 图标
- **失败**：红色主题，AlertCircle 图标
- **信息**：蓝色主题，Info 图标
- **警告**：黄色主题，AlertTriangle 图标

**位置**：页面右上角（桌面端）或顶部居中（移动端）

**持续时间**：
- 成功：3秒
- 失败：5秒（给用户更多时间阅读错误信息）
- 信息：4秒
- 警告：5秒

### 3.2 页面内反馈规范

**使用场景**：
- A类 和 B类 操作的重要反馈
- 表单验证错误
- 需要用户关注的提示

**视觉规范**（由视觉设计师定义）：
- **成功卡片**：绿色边框 + 浅绿背景 + CheckCircle 图标
- **错误卡片**：红色边框 + 浅红背景 + AlertCircle 图标
- **信息卡片**：蓝色边框 + 浅蓝背景 + Info 图标

**位置**：表单顶部或操作区域附近

**持续时间**：
- 成功：3秒后自动消失
- 错误：用户手动关闭或操作成功后消失
- 信息：用户手动关闭

### 3.3 按钮状态反馈

**使用场景**：所有提交类按钮

**状态规范**：
- **默认**：可点击状态
- **Hover**：视觉反馈（阴影、颜色变化）
- **Loading**：Spinner + "保存中..." 文字 + disabled
- **Success**：短暂的成功状态（可选）
- **Error**：保持可点击，显示错误提示

## 四、设置页面具体规范

### 4.1 账户标签页操作

#### 更新账户信息（B类操作）
- **操作中**：按钮显示 Spinner + "保存中..."，按钮 disabled
- **成功**：Toast.success("账户信息已更新") + 页面内成功卡片（3秒）
- **失败**：Toast.error("更新失败") + 页面内错误卡片（持续显示）

#### 删除账户（A类操作）
- **操作前**：确认对话框（已有）
- **操作中**：对话框内按钮显示 Spinner + "删除中..."，按钮 disabled
- **成功**：Toast.success("账户已删除")，2秒后跳转
- **失败**：Toast.error("删除失败") + 对话框内错误提示

### 4.2 偏好标签页操作

#### 保存偏好设置（B类操作）
- **操作中**：按钮显示 Spinner + "保存中..."，按钮 disabled
- **成功**：Toast.success("偏好设置已保存") + 页面内成功卡片（3秒）
- **失败**：Toast.error("保存失败") + 页面内错误卡片（持续显示）

### 4.3 数据标签页操作

#### 导出数据（待实现）
- **操作中**：按钮显示 Spinner + "导出中..."
- **成功**：Toast.success("数据导出成功") + 下载提示
- **失败**：Toast.error("导出失败")

### 4.4 集成标签页操作

#### 连接第三方服务（待实现）
- **操作中**：按钮显示 Spinner + "连接中..."
- **成功**：Toast.success("连接成功")
- **失败**：Toast.error("连接失败")

## 五、全站操作反馈检查清单

### 5.1 必须检查的页面和操作

#### 设置页面（`src/pages/settings/index.tsx`）
- [x] 更新账户信息 - 已有 toast，需验证显示
- [x] 保存偏好设置 - 已有 toast，需验证显示
- [x] 删除账户 - 已有 toast，需验证显示
- [ ] 导出数据 - 待实现
- [ ] 连接日历 - 待实现
- [ ] 连接地图应用 - 待实现

#### 行程相关页面
- [ ] 创建行程 - 需检查反馈
- [ ] 更新行程 - 需检查反馈
- [ ] 删除行程 - 需检查反馈
- [ ] 保存时间轴 - 需检查反馈

#### 规划工作台（`src/pages/plan-studio/PlanningWorkbenchTab.tsx`）
- [x] 生成方案 - 已有加载状态
- [x] 提交方案 - 已有 toast
- [x] 调整方案 - 需检查反馈
- [x] 对比方案 - 需检查反馈

#### 其他关键页面
- [ ] 登录/注册 - 需检查反馈
- [ ] 创建行程（自然语言） - 需检查反馈
- [ ] 保存行程项 - 需检查反馈

## 六、技术实现要求

### 6.1 Toaster 组件配置

**必须确保**：
1. `Toaster` 组件在应用根组件中渲染
2. 检查 `src/App.tsx` 或 `src/components/layout/DashboardLayout.tsx` 是否包含 `<Toaster />`

### 6.2 Toast 使用规范

**统一使用 `sonner` 库**：
```typescript
import { toast } from 'sonner';

// 成功
toast.success('操作成功', {
  description: '详细说明',
  duration: 3000,
});

// 失败
toast.error('操作失败', {
  description: '错误详情',
  duration: 5000,
});

// 信息
toast.info('提示信息', {
  description: '详细说明',
  duration: 4000,
});

// 警告
toast.warning('警告信息', {
  description: '详细说明',
  duration: 5000,
});
```

### 6.3 按钮状态管理

**统一模式**：
```typescript
const [loading, setLoading] = useState(false);
const [success, setSuccess] = useState(false);

const handleSubmit = async () => {
  setLoading(true);
  setSuccess(false);
  
  try {
    await apiCall();
    setSuccess(true);
    toast.success('操作成功');
    setTimeout(() => setSuccess(false), 3000);
  } catch (err) {
    toast.error('操作失败', { description: err.message });
  } finally {
    setLoading(false);
  }
};
```

## 七、验收标准

### 7.1 功能验收

- [ ] 所有 A类 操作都有确认对话框
- [ ] 所有 B类 操作都有 Toast 反馈
- [ ] 所有操作都有加载状态反馈
- [ ] 所有操作都有成功/失败反馈
- [ ] Toast 在所有页面都能正常显示

### 7.2 用户体验验收

- [ ] 反馈及时性：< 100ms 即时反馈，< 1s 视觉反馈
- [ ] 反馈清晰性：用户能明确理解操作结果
- [ ] 反馈一致性：相同操作有相同反馈方式
- [ ] 反馈不干扰：不影响用户继续操作

### 7.3 可访问性验收

- [ ] 屏幕阅读器能读取 Toast 内容
- [ ] 键盘用户可以访问所有操作
- [ ] 颜色对比度符合 WCAG 2.1 AA 标准

## 八、待确认问题

1. **Toaster 组件位置**：需要确认是否在 `DashboardLayout` 或 `App` 中渲染
2. **移动端适配**：Toast 在移动端的显示位置和样式
3. **国际化**：Toast 消息的多语言支持
4. **暗色模式**：Toast 在暗色模式下的样式

## 九、实施优先级

### P0（立即修复）
1. 修复设置页面 Toast 不显示问题
2. 确保 Toaster 组件正确渲染
3. 验证所有保存操作的反馈

### P1（本周完成）
1. 统一全站操作反馈规范
2. 检查并修复所有关键操作的反馈
3. 添加缺失的操作反馈

### P2（后续优化）
1. 优化反馈动画和过渡效果
2. 添加操作历史记录（可选）
3. 优化移动端反馈体验

---

**评估人**：人机交互设计专家  
**评估时间**：2026-02-05  
**下一步**：视觉设计师出视觉规范，前端工程师执行修复
