# Dashboard 页面改造 - 测试指南

**更新时间**：2026-02-01  
**改造内容**：Dashboard 页面增加决策状态区域，体现"决策优先"的产品哲学

---

## 📋 测试场景

### 场景 1：有规划中行程 + 有预算评估结果

**前置条件**：
- 用户已登录
- 有至少一个状态为 `PLANNING` 的行程
- 该行程有方案（plan）
- 该方案已进行预算评估

**预期结果**：
1. ✅ Dashboard 页面顶部显示**决策状态区域**
2. ✅ 决策状态卡片显示：
   - 决策状态（ALLOW/NEED_ADJUST/REJECT）
   - 三人格评审结果（Abu 显示实际状态，Dr.Dre 和 Neptune 显示 PENDING）
   - 关键决策点（如果 verdict 是 NEED_ADJUST 或 REJECT）
   - 决策说明（如果有）
3. ✅ **继续编辑卡片**显示决策状态指示器（右上角）
4. ✅ 点击"查看详情"按钮 → 跳转到规划工作台

**测试步骤**：
1. 登录系统
2. 访问 Dashboard 页面（`/dashboard`）
3. 检查决策状态区域是否显示
4. 检查决策状态是否正确
5. 检查继续编辑卡片是否显示决策状态指示器
6. 点击"查看详情"按钮，验证跳转

---

### 场景 2：有规划中行程 + 无预算评估结果

**前置条件**：
- 用户已登录
- 有至少一个状态为 `PLANNING` 的行程
- 该行程有方案（plan）
- 该方案**未进行**预算评估

**预期结果**：
1. ✅ Dashboard 页面**不显示**决策状态区域（静默处理）
2. ✅ **继续编辑卡片**正常显示（不显示决策状态指示器）
3. ✅ 其他功能正常

**测试步骤**：
1. 登录系统
2. 访问 Dashboard 页面
3. 检查决策状态区域是否不显示
4. 检查继续编辑卡片是否正常显示（无决策状态指示器）

---

### 场景 3：有规划中行程 + 无方案

**前置条件**：
- 用户已登录
- 有至少一个状态为 `PLANNING` 的行程
- 该行程**没有**方案（plan）

**预期结果**：
1. ✅ Dashboard 页面**不显示**决策状态区域
2. ✅ **继续编辑卡片**正常显示（不显示决策状态指示器）
3. ✅ 其他功能正常

**测试步骤**：
1. 登录系统
2. 访问 Dashboard 页面
3. 检查决策状态区域是否不显示
4. 检查继续编辑卡片是否正常显示

---

### 场景 4：无规划中行程

**前置条件**：
- 用户已登录
- **没有**状态为 `PLANNING` 的行程（或所有行程都是其他状态）

**预期结果**：
1. ✅ Dashboard 页面**不显示**决策状态区域
2. ✅ **不显示**继续编辑卡片
3. ✅ 快捷入口和创建行程入口正常显示

**测试步骤**：
1. 登录系统
2. 访问 Dashboard 页面
3. 检查决策状态区域是否不显示
4. 检查继续编辑卡片是否不显示
5. 检查快捷入口和创建行程入口是否正常显示

---

### 场景 5：新用户（无任何行程）

**前置条件**：
- 新用户首次登录
- **没有任何**行程

**预期结果**：
1. ✅ Dashboard 页面**不显示**决策状态区域
2. ✅ **不显示**继续编辑卡片
3. ✅ 显示 Welcome Modal（首次登录）
4. ✅ 快捷入口和创建行程入口正常显示

**测试步骤**：
1. 使用新账号登录
2. 访问 Dashboard 页面
3. 检查 Welcome Modal 是否显示
4. 检查决策状态区域是否不显示
5. 检查快捷入口和创建行程入口是否正常显示

---

## 🎨 UI/UX 测试

### 视觉层级测试

**预期结果**：
1. ✅ **决策状态区域**视觉权重最高（如果显示）
2. ✅ **继续编辑卡片**视觉权重中等
3. ✅ **快捷入口**视觉权重较低（浅色背景、小图标）
4. ✅ **创建行程入口**视觉权重中等

**测试步骤**：
1. 访问 Dashboard 页面
2. 观察各区域的视觉权重
3. 验证是否符合"决策优先"的设计理念

---

### 响应式设计测试

**桌面端**（≥1024px）：
- ✅ 决策状态卡片全宽显示
- ✅ 快捷入口三列网格布局
- ✅ 创建行程入口两个并排按钮

**平板端**（768px-1023px）：
- ✅ 决策状态卡片全宽显示
- ✅ 快捷入口两列网格布局
- ✅ 创建行程入口两个并排按钮

**移动端**（<768px）：
- ✅ 决策状态卡片全宽显示
- ✅ 快捷入口单列布局
- ✅ 创建行程入口垂直排列

**测试步骤**：
1. 在不同屏幕尺寸下访问 Dashboard 页面
2. 检查布局是否自适应
3. 检查交互是否正常

---

## 🔧 功能测试

### 决策状态指示器测试

**测试项**：
1. ✅ ALLOW 状态显示绿色徽章（"已通过"）
2. ✅ NEED_ADJUST 状态显示黄色徽章（"需要调整"）
3. ✅ REJECT 状态显示红色徽章（"已拒绝"）

**测试步骤**：
1. 创建不同决策状态的行程
2. 访问 Dashboard 页面
3. 检查决策状态指示器颜色和文案是否正确

---

### 三人格状态徽章测试

**测试项**：
1. ✅ Abu 徽章显示（如果有预算评估结果）
2. ✅ Dr.Dre 和 Neptune 徽章显示 PENDING 状态
3. ✅ 徽章样式正确（图标 + 名称 + 状态）

**测试步骤**：
1. 访问有预算评估结果的 Dashboard 页面
2. 检查三人格徽章是否正确显示
3. 检查徽章样式是否符合设计规范

---

### 快捷入口测试

**测试项**：
1. ✅ 视觉权重弱化（浅色背景、小图标）
2. ✅ 点击后正确跳转
3. ✅ 悬停效果正常

**测试步骤**：
1. 访问 Dashboard 页面
2. 检查快捷入口的视觉样式
3. 点击各个入口，验证跳转
4. 悬停检查交互效果

---

## 🐛 错误处理测试

### API 错误处理测试

**测试项**：
1. ✅ 获取方案列表失败 → 静默处理，不影响页面显示
2. ✅ 获取预算评估结果失败（404） → 静默处理，不显示决策状态
3. ✅ 获取预算评估结果失败（其他错误） → 记录警告日志，不显示决策状态

**测试步骤**：
1. 模拟 API 错误场景
2. 检查页面是否正常显示
3. 检查控制台日志是否正确

---

### 加载状态测试

**测试项**：
1. ✅ 决策状态卡片加载时显示 Spinner
2. ✅ 加载完成后显示内容或隐藏（如果没有数据）

**测试步骤**：
1. 访问 Dashboard 页面
2. 观察加载状态
3. 检查加载完成后是否正确显示或隐藏

---

## 📊 性能测试

### 加载性能测试

**测试项**：
1. ✅ Dashboard 页面加载时间 < 2 秒
2. ✅ 决策状态区域加载时间 < 1 秒（如果有数据）
3. ✅ 无明显的性能问题

**测试步骤**：
1. 使用浏览器开发者工具测试加载时间
2. 检查网络请求是否合理
3. 检查是否有不必要的重复请求

---

## ✅ 验收标准

### 功能验收

- [x] 决策状态区域正确显示（有数据时）
- [x] 决策状态区域正确隐藏（无数据时）
- [x] 继续编辑卡片显示决策状态指示器（有数据时）
- [x] 快捷入口视觉权重弱化
- [x] 所有交互功能正常

### 体验验收

- [x] 信息层级清晰（决策状态 > 继续编辑 > 快捷入口）
- [x] 符合"决策优先"的产品哲学
- [x] 响应式设计正常
- [x] 加载状态和错误处理合理

### 代码质量

- [x] 无 lint 错误
- [x] TypeScript 类型检查通过
- [x] 代码注释清晰
- [x] 错误处理完善

---

## 🔗 相关文件

- `src/pages/Dashboard.tsx` - Dashboard 主页面
- `src/components/dashboard/DecisionStatusSection.tsx` - 决策状态区域
- `src/components/dashboard/CurrentTripDecisionCard.tsx` - 当前行程决策卡片
- `src/components/dashboard/DecisionStatusIndicator.tsx` - 决策状态指示器
- `src/components/dashboard/PersonaStatusBadge.tsx` - 三人格状态徽章
- `src/components/dashboard/ContinueEditingCard.tsx` - 继续编辑卡片（已改造）
- `src/components/dashboard/QuickAccessSection.tsx` - 快捷入口（已改造）

---

## 📝 已知问题

1. **Dr.Dre 和 Neptune 的状态**：
   - 当前显示为 PENDING，因为预算评估结果中只包含 Abu 的状态
   - 如果需要显示完整的三人格状态，需要从其他 API 获取

2. **决策日志详情**：
   - 当前只显示决策状态摘要
   - 如果需要显示完整的决策日志，需要点击"查看详情"跳转到规划工作台

---

**状态**：✅ 改造完成，等待测试验证
