# è´§å¸ç¬¦å·ç¡¬ç¼–ç æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ—¶é—´
2026-02-10

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. ç¡¬ç¼–ç è´§å¸ç¬¦å·ï¼ˆÂ¥ï¼‰å·²ä¿®å¤
ä»¥ä¸‹ç»„ä»¶å·²ä¿®å¤ï¼Œç°åœ¨ä½¿ç”¨åŠ¨æ€è´§å¸è·å–ï¼š

- âœ… `DrDreView.tsx` - æ€»é¢„ç®—æ˜¾ç¤º
- âœ… `AutoOptimizeDialog.tsx` - è´¹ç”¨å˜åŒ–æ˜¾ç¤º
- âœ… `OptimizationResultDialog.tsx` - è´¹ç”¨å˜åŒ–æ˜¾ç¤ºï¼ˆéœ€æ·»åŠ  tripId propï¼‰
- âœ… `SuggestionPreviewDialog.tsx` - æˆæœ¬å˜åŒ–æ˜¾ç¤º
- âœ… `AdjustTimeDialog.tsx` - æˆæœ¬å˜åŒ–æ˜¾ç¤º

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
- æ·»åŠ è´§å¸çŠ¶æ€ç®¡ç†
- ä¼˜å…ˆä»é¢„ç®—çº¦æŸè·å–è´§å¸
- å…¶æ¬¡ä»ç›®çš„åœ°è·å–è´§å¸ç­–ç•¥
- é»˜è®¤ä½¿ç”¨ CNY

## âš ï¸ éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥çš„é—®é¢˜

### 2. ç¡¬ç¼–ç  CNY ä½œä¸ºé»˜è®¤å€¼

ä»¥ä¸‹ç»„ä»¶è™½ç„¶ä½¿ç”¨äº† `formatCurrency` å‡½æ•°ï¼Œä½†ç¡¬ç¼–ç äº† `'CNY'` ä½œä¸ºé»˜è®¤å€¼ï¼š

#### 2.1 Planning Assistant V2 ç›¸å…³ç»„ä»¶

**`PlanComparison.tsx`** (ç¬¬58ã€95ã€101è¡Œ)
```typescript
formatCurrency(plan.scores[dimension], 'CNY')
formatCurrency(diff.plan1Value, 'CNY')
formatCurrency(diff.plan2Value, 'CNY')
```

**`PlanCard.tsx`** (ç¬¬96ã€106è¡Œ)
```typescript
formatCurrency(plan.estimatedBudget.total, 'CNY')
formatCurrency(value, 'CNY')
```

**é—®é¢˜åˆ†æ**ï¼š
- `PlanComparison` å’Œ `PlanCard` ç»„ä»¶æ¥æ”¶ `ComparePlansResponse` å’Œ `Plan` ç±»å‹
- è¿™äº›ç±»å‹ä¸­æ²¡æœ‰è´§å¸å­—æ®µ
- ç»„ä»¶åº”è¯¥æ¥æ”¶ `currency` prop æˆ–ä» `tripInfo` è·å–è´§å¸

**å»ºè®®ä¿®å¤**ï¼š
1. åœ¨ `PlanComparisonProps` å’Œ `PlanCardProps` ä¸­æ·»åŠ  `currency?: string` prop
2. åœ¨ `PlanningAssistant` ç»„ä»¶ä¸­ï¼Œä» `tripInfo?.budgetConfig?.currency` è·å–è´§å¸å¹¶ä¼ é€’ç»™å­ç»„ä»¶
3. å¦‚æœæ²¡æœ‰è´§å¸ä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤å€¼ `'CNY'`

#### 2.2 PlanningAssistantChat.tsx (ç¬¬376ã€385è¡Œ)
```typescript
formatCurrency(plan.estimatedBudget.total, 'CNY')
formatCurrency(plan.estimatedBudget.breakdown[key], 'CNY')
```

**é—®é¢˜åˆ†æ**ï¼š
- ç»„ä»¶åº”è¯¥èƒ½å¤Ÿä»è¡Œç¨‹ä¿¡æ¯ä¸­è·å–è´§å¸
- éœ€è¦æ£€æŸ¥ç»„ä»¶æ˜¯å¦æœ‰è®¿é—®è¡Œç¨‹ä¿¡æ¯çš„é€”å¾„

#### 2.3 NLChatInterface.tsx (ç¬¬1145è¡Œ)
```typescript
formatCurrency(params.totalBudget, 'CNY')
```

**é—®é¢˜åˆ†æ**ï¼š
- åœ¨åˆ›å»ºè¡Œç¨‹æ—¶ï¼Œç”¨æˆ·å¯èƒ½å·²ç»è¾“å…¥äº†ç›®çš„åœ°ï¼ˆ`latestParams?.destination`ï¼‰
- å¦‚æœç›®çš„åœ°å·²ç¡®å®šï¼Œåº”è¯¥æ ¹æ®ç›®çš„åœ°è·å–è´§å¸ç­–ç•¥
- å¦‚æœç›®çš„åœ°æœªç¡®å®šï¼Œä½¿ç”¨é»˜è®¤å€¼ `'CNY'` æ˜¯åˆç†çš„

**å»ºè®®ä¿®å¤**ï¼š
1. å½“ `latestParams?.destination` å­˜åœ¨æ—¶ï¼Œè°ƒç”¨ `countriesApi.getCurrencyStrategy()` è·å–è´§å¸
2. å°†è´§å¸ä¿¡æ¯å­˜å‚¨åœ¨çŠ¶æ€ä¸­
3. ä½¿ç”¨è·å–åˆ°çš„è´§å¸æ ¼å¼åŒ–é¢„ç®—æ˜¾ç¤º

#### 2.4 JourneyAssistantChat.tsx (ç¬¬146è¡Œ)
```typescript
formatCurrency(state.stats.spentBudget, 'CNY')
formatCurrency(state.stats.totalBudget, 'CNY')
```

**é—®é¢˜åˆ†æ**ï¼š
- éœ€è¦æ£€æŸ¥ç»„ä»¶æ˜¯å¦æœ‰è®¿é—®è¡Œç¨‹ä¿¡æ¯çš„é€”å¾„
- å¦‚æœæœ‰ï¼Œåº”è¯¥ä»è¡Œç¨‹ä¸­è·å–è´§å¸

#### 2.5 schedule.tsx (ç¬¬231ã€245è¡Œ)
```typescript
formatCurrency(item.metadata.cost, 'CNY')
formatCurrency(schedule.schedule.totalCost ?? 0, 'CNY')
```

**é—®é¢˜åˆ†æ**ï¼š
- è¿™æ˜¯è¡Œç¨‹æ—¥ç¨‹é¡µé¢ï¼Œåº”è¯¥æœ‰ `tripId`
- åº”è¯¥ä»è¡Œç¨‹çš„é¢„ç®—çº¦æŸæˆ–ç›®çš„åœ°è·å–è´§å¸

### 3. å…¶ä»–å‘ç°

#### 3.1 ItineraryItemRow.tsx (ç¬¬585è¡Œ)
```typescript
'Â¥'.repeat(priceLevel)
```

**çŠ¶æ€**ï¼šâœ… **æ— éœ€ä¿®å¤**
- è¿™æ˜¯ç”¨äºæ˜¾ç¤ºä»·æ ¼ç­‰çº§çš„è§†è§‰æŒ‡ç¤ºå™¨ï¼Œä¸æ˜¯å®é™…é‡‘é¢
- ä½¿ç”¨ç¡¬ç¼–ç çš„ `Â¥` ç¬¦å·æ˜¯åˆç†çš„ï¼Œå› ä¸ºè¿™åªæ˜¯è§†è§‰æç¤º

#### 3.2 useItineraryCost.ts (ç¬¬232-238è¡Œ)
```typescript
const currencySymbols: Record<string, string> = {
  'CNY': 'Â¥',
  'USD': '$',
  'EUR': 'â‚¬',
  'JPY': 'Â¥',
  'GBP': 'Â£',
};
```

**çŠ¶æ€**ï¼šâœ… **æ— éœ€ä¿®å¤**
- è¿™æ˜¯ `formatCost` å‡½æ•°çš„å®ç°ï¼Œå®šä¹‰äº†è´§å¸ç¬¦å·æ˜ å°„
- è¿™æ˜¯æ­£ç¡®çš„å®ç°æ–¹å¼

#### 3.3 ç¿»è¯‘æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç 
- `src/locales/en/translation.json` å’Œ `src/locales/zh/translation.json` ä¸­åŒ…å«ç¤ºä¾‹æ–‡æœ¬
- **çŠ¶æ€**ï¼šâœ… **æ— éœ€ä¿®å¤** - è¿™äº›æ˜¯ç¤ºä¾‹æ–‡æœ¬ï¼Œä¸æ˜¯å®é™…ä»£ç 

## ğŸ“Š ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“ç”¨æˆ·ä½“éªŒï¼‰
1. **PlanComparison å’Œ PlanCard** - è¿™äº›æ˜¯æ ¸å¿ƒå±•ç¤ºç»„ä»¶ï¼Œç”¨æˆ·ç»å¸¸çœ‹åˆ°
2. **NLChatInterface** - åˆ›å»ºè¡Œç¨‹æ—¶çš„é¢„ç®—æ˜¾ç¤ºï¼Œå¦‚æœç›®çš„åœ°å·²ç¡®å®šåº”è¯¥æ˜¾ç¤ºæ­£ç¡®è´§å¸

### ä¸­ä¼˜å…ˆçº§ï¼ˆå½±å“ä¸€è‡´æ€§ï¼‰
3. **PlanningAssistantChat** - å¦‚æœç»„ä»¶å¯ä»¥è®¿é—®è¡Œç¨‹ä¿¡æ¯ï¼Œåº”è¯¥ä½¿ç”¨æ­£ç¡®è´§å¸
4. **JourneyAssistantChat** - åŒä¸Š
5. **schedule.tsx** - è¡Œç¨‹æ—¥ç¨‹é¡µé¢åº”è¯¥ä½¿ç”¨è¡Œç¨‹çš„è´§å¸

## ğŸ”§ ä¿®å¤å»ºè®®

### é€šç”¨ä¿®å¤æ¨¡å¼

å¯¹äºéœ€è¦è´§å¸ä¿¡æ¯çš„ç»„ä»¶ï¼Œå»ºè®®é‡‡ç”¨ä»¥ä¸‹æ¨¡å¼ï¼š

```typescript
// 1. æ·»åŠ  currency propï¼ˆå¯é€‰ï¼‰
interface ComponentProps {
  // ... å…¶ä»– props
  currency?: string;
  tripId?: string; // å¦‚æœæœ‰ tripIdï¼Œå¯ä»¥ä»è¡Œç¨‹è·å–è´§å¸
}

// 2. åœ¨ç»„ä»¶å†…éƒ¨è·å–è´§å¸
const [currency, setCurrency] = useState<string>('CNY');

useEffect(() => {
  const loadCurrency = async () => {
    if (tripId) {
      try {
        // ä¼˜å…ˆä»é¢„ç®—çº¦æŸè·å–
        const constraint = await tripsApi.getBudgetConstraint(tripId);
        if (constraint.budgetConstraint.currency) {
          setCurrency(constraint.budgetConstraint.currency);
          return;
        }
      } catch {
        // å¦‚æœå¤±è´¥ï¼Œå°è¯•ä»ç›®çš„åœ°è·å–
      }
      
      // ä»è¡Œç¨‹è·å–ç›®çš„åœ°
      try {
        const trip = await tripsApi.getById(tripId);
        if (trip.destination) {
          const currencyStrategy = await countriesApi.getCurrencyStrategy(trip.destination);
          if (currencyStrategy?.currencyCode) {
            setCurrency(currencyStrategy.currencyCode);
            return;
          }
        }
      } catch {
        // ä¿æŒé»˜è®¤å€¼
      }
    }
    
    // å¦‚æœæä¾›äº† currency propï¼Œä½¿ç”¨å®ƒ
    if (props.currency) {
      setCurrency(props.currency);
    }
  };
  
  loadCurrency();
}, [tripId, props.currency]);

// 3. ä½¿ç”¨è´§å¸æ ¼å¼åŒ–
formatCurrency(amount, currency)
```

## ğŸ“ æ€»ç»“

### å·²å®Œæˆ
- âœ… ä¿®å¤äº† 5 ä¸ªç»„ä»¶ä¸­çš„ç¡¬ç¼–ç è´§å¸ç¬¦å·ï¼ˆÂ¥ï¼‰
- âœ… æ‰€æœ‰ä¿®å¤éƒ½é‡‡ç”¨äº†ç»Ÿä¸€çš„è´§å¸è·å–ç­–ç•¥

### å¾…å®Œæˆ
- âš ï¸ éœ€è¦ä¿®å¤ 6+ ä¸ªç»„ä»¶ä¸­ç¡¬ç¼–ç çš„ `'CNY'` é»˜è®¤å€¼
- âš ï¸ éœ€è¦ä¸ºç›¸å…³ç»„ä»¶æ·»åŠ è´§å¸ prop æˆ–ä»è¡Œç¨‹è·å–è´§å¸çš„é€»è¾‘

### å»ºè®®
1. ä¼˜å…ˆä¿®å¤é«˜ä¼˜å…ˆçº§ç»„ä»¶ï¼ˆPlanComparisonã€PlanCardã€NLChatInterfaceï¼‰
2. å»ºç«‹ç»Ÿä¸€çš„è´§å¸è·å–å·¥å…·å‡½æ•°ï¼Œé¿å…é‡å¤ä»£ç 
3. åœ¨ç»„ä»¶æ–‡æ¡£ä¸­æ˜ç¡®è´§å¸è·å–çš„ä¼˜å…ˆçº§å’Œé»˜è®¤å€¼ç­–ç•¥
