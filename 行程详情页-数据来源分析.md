# è¡Œç¨‹è¯¦æƒ…é¡µ - æ•°æ®æ¥æºåˆ†æ

**ç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**æ–‡ä»¶**: `src/pages/trips/[id].tsx` åŠç›¸å…³ç»„ä»¶

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æ•°æ®æ¥æºåˆ†ç±»](#æ•°æ®æ¥æºåˆ†ç±»)
3. [ç»¼åˆè§†å›¾æ•°æ®è¯¦ç»†åˆ†æ](#ç»¼åˆè§†å›¾æ•°æ®è¯¦ç»†åˆ†æ)
4. [å¥åº·åº¦æ•°æ®è¯¦ç»†åˆ†æ](#å¥åº·åº¦æ•°æ®è¯¦ç»†åˆ†æ)
5. [å…³é”®é—®é¢˜æ•°æ®è¯¦ç»†åˆ†æ](#å…³é”®é—®é¢˜æ•°æ®è¯¦ç»†åˆ†æ)
6. [æ•°æ®æµç¨‹å›¾](#æ•°æ®æµç¨‹å›¾)

---

## ğŸ“Š æ¦‚è¿°

è¡Œç¨‹è¯¦æƒ…é¡µæ˜¾ç¤ºçš„æ•°æ®æ¥è‡ªå¤šä¸ªæ¥æºï¼š
- âœ… **API æ¥å£**ï¼šä»åç«¯è·å–çš„çœŸå®æ•°æ®
- âš ï¸ **ç¡¬ç¼–ç æ•°æ®**ï¼šå‰ç«¯å†™æ­»çš„æ¨¡æ‹Ÿæ•°æ®
- ğŸ”„ **è®¡ç®—æ•°æ®**ï¼šåŸºäº API æ•°æ®è®¡ç®—å¾—å‡ºçš„æŒ‡æ ‡

---

## ğŸ“¦ æ•°æ®æ¥æºåˆ†ç±»

### âœ… API æ•°æ®ï¼ˆçœŸå®æ•°æ®ï¼‰

| æ•°æ®é¡¹ | æ¥æºæ¥å£ | çŠ¶æ€ | ä½ç½® |
|--------|----------|------|------|
| è¡Œç¨‹åŸºæœ¬ä¿¡æ¯ | `GET /trips/:id` | âœ… å·²å¯¹æ¥ | `loadTrip()` |
| å»ºè®®åˆ—è¡¨ | `GET /trips/:id/suggestions` | âœ… å·²å¯¹æ¥ | `loadSuggestions()` |
| å»ºè®®ç»Ÿè®¡ | `GET /trips/:id/suggestions/stats` | âœ… å·²å¯¹æ¥ | `loadSuggestions()` |
| è¯æ®åˆ—è¡¨ | `GET /trips/:id/evidence` | âœ… å·²å¯¹æ¥ | `loadEvidence()` |
| è¡Œç¨‹æŒ‡æ ‡ | `GET /trips/:id/metrics` | âœ… å·²å¯¹æ¥ | `loadTripMetrics()` |
| å†²çªåˆ—è¡¨ | `GET /trips/:id/conflicts` | âœ… å·²å¯¹æ¥ | `loadConflicts()` |
| è¡Œç¨‹çŠ¶æ€ | `GET /trips/:id/state` | âœ… å·²å¯¹æ¥ | `loadTripState()` |

### âš ï¸ ç¡¬ç¼–ç æ•°æ®ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰

| æ•°æ®é¡¹ | ä½ç½® | ç¡¬ç¼–ç å€¼ | ç”¨é€” |
|--------|------|----------|------|
| å®‰å…¨è¯„åˆ† | `AutoView.tsx` è¡Œ41-48 | `safetyScore: 75` | ç»¼åˆè§†å›¾å±•ç¤º |
| èŠ‚å¥è¯„åˆ† | `AutoView.tsx` è¡Œ41-48 | `rhythmScore: 80` | ç»¼åˆè§†å›¾å±•ç¤º |
| å‡†å¤‡åº¦è¯„åˆ† | `AutoView.tsx` è¡Œ41-48 | `readinessScore: 85` | ç»¼åˆè§†å›¾å±•ç¤º |
| å…³é”®é—®é¢˜æ•° | `AutoView.tsx` è¡Œ41-48 | `criticalIssues: 2` | ç»¼åˆè§†å›¾å±•ç¤º |
| è­¦å‘Šæ•° | `AutoView.tsx` è¡Œ41-48 | `warnings: 3` | ç»¼åˆè§†å›¾å±•ç¤º |
| å»ºè®®æ•° | `AutoView.tsx` è¡Œ41-48 | `suggestions: 5` | ç»¼åˆè§†å›¾å±•ç¤º |
| å…³é”®é—®é¢˜åˆ—è¡¨ | `AutoView.tsx` è¡Œ197-212 | "å¤œé—´å¾’æ­¥é£é™©"ã€"ç¼“å†²æ—¶é—´ä¸è¶³" | æ¦‚è§ˆæ ‡ç­¾é¡µ |
| å…³é”®æŒ‡æ ‡ | `AutoView.tsx` è¡Œ234-261 | æ€»æ—¶é•¿24å°æ—¶ã€ç–²åŠ³æŒ‡æ•°65 | æ¦‚è§ˆæ ‡ç­¾é¡µ |
| å®‰å…¨çŠ¶æ€ | `AbuView.tsx` è¡Œ46 | `gatingStatus: 'WARN'` | å®‰å…¨è§†å›¾ |
| è¿è§„åˆ—è¡¨ | `AbuView.tsx` è¡Œ47-71 | 2ä¸ªè¿è§„é¡¹ | å®‰å…¨è§†å›¾ |
| é£é™©æ˜ å°„ | `AbuView.tsx` è¡Œ73-77 | item-1/2/3çš„é£é™©ä¿¡æ¯ | å®‰å…¨è§†å›¾ |
| è¡Œç¨‹æŒ‡æ ‡ | `DrDreView.tsx` è¡Œ66-73 | timeTotal: 1440ç­‰ | èŠ‚å¥è§†å›¾ |
| å•é¡¹æŒ‡æ ‡ | `DrDreView.tsx` è¡Œ75-96 | item-1/2/3çš„æŒ‡æ ‡ | èŠ‚å¥è§†å›¾ |
| ä¿®å¤å»ºè®® | `NeptuneView.tsx` è¡Œ67-117 | 2ä¸ªä¿®å¤å»ºè®® | ä¿®å¤è§†å›¾ |
| æ›¿ä»£æ–¹æ¡ˆ | `NeptuneView.tsx` è¡Œ119-136 | item-2çš„æ›¿ä»£æ–¹æ¡ˆ | ä¿®å¤è§†å›¾ |

### ğŸ”„ è®¡ç®—æ•°æ®ï¼ˆåŸºäºAPIæ•°æ®è®¡ç®—ï¼‰

| æ•°æ®é¡¹ | è®¡ç®—æ–¹å¼ | æ•°æ®æº | ä½ç½® |
|--------|----------|--------|------|
| å¥åº·åº¦æŒ‡æ ‡ | åŸºäº tripMetrics å’Œ conflicts è®¡ç®— | `tripMetrics`, `conflicts`, `trip.statistics` | `[id].tsx` è¡Œ698-745 |
| å¥åº·åº¦æ€»åˆ† | å››ä¸ªæŒ‡æ ‡çš„å¹³å‡å€¼ | `healthMetrics` | `HealthBar` ç»„ä»¶ |

---

## ğŸ” ç»¼åˆè§†å›¾æ•°æ®è¯¦ç»†åˆ†æ

### AutoView ç»„ä»¶æ•°æ®æ¥æº

**æ–‡ä»¶**: `src/components/trips/views/AutoView.tsx`

#### 1. overallMetricsï¼ˆç»¼åˆæŒ‡æ ‡ï¼‰- âš ï¸ ç¡¬ç¼–ç 

**ä½ç½®**: è¡Œ 41-48

```typescript
const overallMetrics = {
  safetyScore: 75, // å®‰å…¨è¯„åˆ† 0-100
  rhythmScore: 80, // èŠ‚å¥è¯„åˆ† 0-100
  readinessScore: 85, // å‡†å¤‡åº¦è¯„åˆ† 0-100
  criticalIssues: 2, // å…³é”®é—®é¢˜æ•°
  warnings: 3, // è­¦å‘Šæ•°
  suggestions: 5, // å»ºè®®æ•°
};
```

**ä½¿ç”¨ä½ç½®**:
- è¡Œ 96-97: å®‰å…¨è¯„åˆ†æ˜¾ç¤º
- è¡Œ 102-103: å…³é”®é—®é¢˜æ•°æ˜¾ç¤º
- è¡Œ 121: èŠ‚å¥è¯„åˆ†æ˜¾ç¤º
- è¡Œ 127: è­¦å‘Šæ•°æ˜¾ç¤º
- è¡Œ 145: å‡†å¤‡åº¦è¯„åˆ†æ˜¾ç¤º
- è¡Œ 151: å»ºè®®æ•°æ˜¾ç¤º
- è¡Œ 195: å…³é”®é—®é¢˜åˆ¤æ–­

**åº”è¯¥çš„æ•°æ®æ¥æº**:
- `safetyScore`: åº”ä» `GET /trips/:id/risk-assessment` æˆ–åŸºäº `violations` è®¡ç®—
- `rhythmScore`: åº”ä» `GET /trips/:id/metrics` è®¡ç®—ï¼ˆåŸºäºç–²åŠ³æŒ‡æ•°ã€ç¼“å†²æ—¶é—´ç­‰ï¼‰
- `readinessScore`: åº”ä» `GET /trips/:id/readiness` æˆ–åŸºäº `repairs` è®¡ç®—
- `criticalIssues`: åº”ä» `GET /trips/:id/violations` è¿‡æ»¤ `level: 'HARD'` çš„æ•°é‡
- `warnings`: åº”ä» `GET /trips/:id/violations` è¿‡æ»¤ `level: 'SOFT'` çš„æ•°é‡
- `suggestions`: å¯ä» `getSuggestionStats` è·å–ï¼ˆå·²å¯¹æ¥ï¼Œä½†æœªä½¿ç”¨ï¼‰

**å½“å‰çŠ¶æ€**: âš ï¸ å®Œå…¨ç¡¬ç¼–ç 

**æ”¹è¿›å»ºè®®**:
```typescript
// åº”è¯¥ä» props ä¼ å…¥ï¼Œæˆ–è€…ä» API è·å–
interface AutoViewProps {
  trip: TripDetail;
  tripMetrics?: TripMetricsResponse;
  suggestionStats?: SuggestionStats;
  violations?: RiskViolation[];
  repairs?: Repair[];
  onItemClick?: (item: ItineraryItem) => void;
}

// è®¡ç®—ç»¼åˆæŒ‡æ ‡
const overallMetrics = useMemo(() => {
  // å®‰å…¨è¯„åˆ†ï¼šåŸºäºè¿è§„åˆ—è¡¨è®¡ç®—
  const safetyScore = violations ? calculateSafetyScore(violations) : 75;
  
  // èŠ‚å¥è¯„åˆ†ï¼šåŸºäºæŒ‡æ ‡è®¡ç®—
  const rhythmScore = tripMetrics ? calculateRhythmScore(tripMetrics) : 80;
  
  // å‡†å¤‡åº¦è¯„åˆ†ï¼šåŸºäºä¿®å¤å»ºè®®è®¡ç®—
  const readinessScore = repairs ? calculateReadinessScore(repairs) : 85;
  
  // å…³é”®é—®é¢˜æ•°ï¼šä»è¿è§„åˆ—è¡¨ç»Ÿè®¡
  const criticalIssues = violations?.filter(v => v.level === 'HARD').length || 0;
  
  // è­¦å‘Šæ•°ï¼šä»è¿è§„åˆ—è¡¨ç»Ÿè®¡
  const warnings = violations?.filter(v => v.level === 'SOFT').length || 0;
  
  // å»ºè®®æ•°ï¼šä»å»ºè®®ç»Ÿè®¡è·å–
  const suggestions = suggestionStats?.total || 0;
  
  return {
    safetyScore,
    rhythmScore,
    readinessScore,
    criticalIssues,
    warnings,
    suggestions,
  };
}, [tripMetrics, suggestionStats, violations, repairs]);
```

#### 2. å…³é”®é—®é¢˜åˆ—è¡¨ - âš ï¸ ç¡¬ç¼–ç 

**ä½ç½®**: è¡Œ 195-212

```typescript
{overallMetrics.criticalIssues > 0 ? (
  <>
    <div className="p-3 bg-red-50 border border-red-200 rounded-lg">
      <div className="font-medium text-sm text-red-900 mb-1">
        å¤œé—´å¾’æ­¥é£é™©
      </div>
      <div className="text-xs text-red-700">
        Day 2 çš„å¾’æ­¥æ´»åŠ¨é¢„è®¡åœ¨æ—¥è½åç»“æŸï¼Œå­˜åœ¨å®‰å…¨éšæ‚£
      </div>
    </div>
    <div className="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
      <div className="font-medium text-sm text-yellow-900 mb-1">
        ç¼“å†²æ—¶é—´ä¸è¶³
      </div>
      <div className="text-xs text-yellow-700">
        å¤šä¸ªè¡Œç¨‹é¡¹ä¹‹é—´ç¼“å†²æ—¶é—´å°‘äºæ¨èå€¼
      </div>
    </div>
  </>
) : (
  // æ— é—®é¢˜æç¤º
)}
```

**å½“å‰çŠ¶æ€**: âš ï¸ å®Œå…¨ç¡¬ç¼–ç 

**åº”è¯¥çš„æ•°æ®æ¥æº**:
- `GET /trips/:id/critical-issues` - è·å–å…³é”®é—®é¢˜åˆ—è¡¨
- æˆ–è€…ä» `GET /trips/:id/violations` è¿‡æ»¤ `level: 'HARD'` çš„è¿è§„é¡¹

**æ”¹è¿›å»ºè®®**:
```typescript
// åº”è¯¥ä» API è·å–
const [criticalIssues, setCriticalIssues] = useState<CriticalIssue[]>([]);

useEffect(() => {
  const loadCriticalIssues = async () => {
    if (!trip?.id) return;
    try {
      const data = await tripsApi.getCriticalIssues(trip.id);
      setCriticalIssues(data.issues);
    } catch (err) {
      console.error('Failed to load critical issues:', err);
    }
  };
  loadCriticalIssues();
}, [trip?.id]);

// åœ¨æ¸²æŸ“ä¸­ä½¿ç”¨
{criticalIssues.map((issue) => (
  <div key={issue.id} className={getIssueColorClass(issue.severity)}>
    <div className="font-medium text-sm mb-1">{issue.title}</div>
    <div className="text-xs">{issue.description}</div>
  </div>
))}
```

#### 3. å…³é”®æŒ‡æ ‡ - âš ï¸ ç¡¬ç¼–ç 

**ä½ç½®**: è¡Œ 234-261

```typescript
<div className="flex items-center justify-between p-2 bg-gray-50 rounded">
  <div className="flex items-center gap-2">
    <Clock className="w-4 h-4 text-muted-foreground" />
    <span className="text-sm">æ€»æ—¶é•¿</span>
  </div>
  <span className="text-sm font-medium">24å°æ—¶</span>
</div>
<div className="flex items-center justify-between p-2 bg-gray-50 rounded">
  <div className="flex items-center gap-2">
    <Activity className="w-4 h-4 text-muted-foreground" />
    <span className="text-sm">ç–²åŠ³æŒ‡æ•°</span>
  </div>
  <span className="text-sm font-medium">65/100</span>
</div>
// ... é¢„è®¡èŠ±è´¹ Â¥5,000ã€å¯é æ€§ 85%
```

**å½“å‰çŠ¶æ€**: âš ï¸ å®Œå…¨ç¡¬ç¼–ç 

**åº”è¯¥çš„æ•°æ®æ¥æº**:
- æ€»æ—¶é•¿ï¼šä» `tripMetrics.summary.totalDuration` è®¡ç®—
- ç–²åŠ³æŒ‡æ•°ï¼šä» `tripMetrics.summary.totalFatigue` è®¡ç®—
- é¢„è®¡èŠ±è´¹ï¼šä» `trip.statistics.budgetUsed` è·å–
- å¯é æ€§ï¼šä» `tripMetrics` æˆ–å…¶ä»–æŒ‡æ ‡è®¡ç®—

**æ”¹è¿›å»ºè®®**:
```typescript
// åº”è¯¥ä» props ä¼ å…¥ tripMetrics
const keyMetrics = useMemo(() => {
  if (!tripMetrics) return null;
  
  const summary = tripMetrics.summary;
  const totalDays = trip?.statistics?.totalDays || 1;
  
  return {
    totalDuration: summary.totalDuration, // åˆ†é’Ÿï¼Œè½¬æ¢ä¸ºå°æ—¶
    fatigueScore: Math.round(summary.totalFatigue / totalDays), // å¹³å‡ç–²åŠ³æŒ‡æ•°
    estimatedCost: trip?.statistics?.budgetUsed || 0,
    reliability: calculateReliability(tripMetrics), // åŸºäºæŒ‡æ ‡è®¡ç®—
  };
}, [tripMetrics, trip]);
```

---

## ğŸ¥ å¥åº·åº¦æ•°æ®è¯¦ç»†åˆ†æ

### å¥åº·åº¦æŒ‡æ ‡è®¡ç®—

**ä½ç½®**: `src/pages/trips/[id].tsx` è¡Œ 698-745

**æ•°æ®æº**: âœ… åŸºäº API æ•°æ®è®¡ç®—

```typescript
const healthMetrics = (() => {
  // é»˜è®¤å€¼ï¼ˆå½“ tripMetrics ä¸å­˜åœ¨æ—¶ä½¿ç”¨ï¼‰
  const defaultMetrics = {
    executable: 85,
    buffer: 70,
    risk: 25,
    cost: 80,
  };

  if (!tripMetrics) return defaultMetrics;

  // åŸºäºè¡Œç¨‹æŒ‡æ ‡è®¡ç®—å¥åº·åº¦
  const summary = tripMetrics.summary;
  const totalDays = trip?.statistics?.totalDays || trip?.TripDay?.length || 1;
  
  // 1. å¯æ‰§è¡Œåº¦ï¼šåŸºäºç¼“å†²æ—¶é—´å’Œç–²åŠ³æŒ‡æ•°
  const avgBufferPerDay = summary.totalBuffer / totalDays;
  const avgFatigue = summary.totalFatigue / totalDays;
  const executable = Math.min(100, Math.max(0, 
    (avgBufferPerDay / 60) * 20 + // ç¼“å†²æ—¶é—´ï¼ˆå°æ—¶ï¼‰* 20ï¼Œæœ€å¤š20åˆ†
    (100 - avgFatigue) * 0.65 // ç–²åŠ³æŒ‡æ•°è¶Šä½è¶Šå¥½ï¼Œæœ€å¤š65åˆ†
  ));

  // 2. ç¼“å†²ï¼šåŸºäºæ€»ç¼“å†²æ—¶é—´
  const buffer = Math.min(100, Math.max(0, (summary.totalBuffer / (totalDays * 120)) * 100)); // å‡è®¾æ¯å¤©ç†æƒ³ç¼“å†²2å°æ—¶

  // 3. é£é™©ï¼šåŸºäºå†²çªæ•°é‡å’Œé«˜é£é™©å†²çª
  const highRiskConflicts = conflicts?.conflicts?.filter(c => c.severity === 'HIGH').length || 0;
  const totalConflicts = conflicts?.total || 0;
  const risk = Math.min(100, Math.max(0, 
    (highRiskConflicts * 30) + // é«˜é£é™©å†²çªæ¯ä¸ª30åˆ†
    (totalConflicts * 5) // æ€»å†²çªæ¯ä¸ª5åˆ†
  ));

  // 4. æˆæœ¬æ§åˆ¶ï¼šåŸºäºé¢„ç®—ä½¿ç”¨æƒ…å†µ
  const budgetUsed = trip?.statistics?.budgetUsed || 0;
  const totalBudget = trip?.totalBudget || 1;
  const budgetRatio = budgetUsed / totalBudget;
  const cost = Math.min(100, Math.max(0, (1 - budgetRatio) * 100)); // é¢„ç®—ä½¿ç”¨è¶Šå°‘è¶Šå¥½

  return {
    executable: Math.round(executable),
    buffer: Math.round(buffer),
    risk: Math.round(risk),
    cost: Math.round(cost),
  };
})();
```

**æ•°æ®æ¥æº**:
1. âœ… `tripMetrics` - ä» `GET /trips/:id/metrics` è·å–ï¼ˆ`loadTripMetrics()`ï¼‰
2. âœ… `conflicts` - ä» `GET /trips/:id/conflicts` è·å–ï¼ˆ`loadConflicts()`ï¼‰
3. âœ… `trip.statistics` - ä» `GET /trips/:id` è·å–ï¼ˆ`loadTrip()`ï¼‰

**è®¡ç®—é€»è¾‘**:
- **å¯æ‰§è¡Œåº¦**: åŸºäºå¹³å‡ç¼“å†²æ—¶é—´å’Œå¹³å‡ç–²åŠ³æŒ‡æ•°
- **ç¼“å†²**: åŸºäºæ€»ç¼“å†²æ—¶é—´å ç†æƒ³ç¼“å†²æ—¶é—´çš„æ¯”ä¾‹
- **é£é™©**: åŸºäºå†²çªæ•°é‡ï¼ˆé«˜é£é™©å†²çªæƒé‡æ›´é«˜ï¼‰
- **æˆæœ¬**: åŸºäºé¢„ç®—ä½¿ç”¨æ¯”ä¾‹ï¼ˆä½¿ç”¨è¶Šå°‘è¶Šå¥½ï¼‰

**å¥åº·åº¦æ€»åˆ†**: å››ä¸ªæŒ‡æ ‡çš„å¹³å‡å€¼ï¼ˆåœ¨ `HealthBar` ç»„ä»¶ä¸­è®¡ç®—ï¼‰

**çŠ¶æ€**: âœ… å·²å®ç°ï¼ŒåŸºäºçœŸå®æ•°æ®è®¡ç®—

---

## ğŸ“Š æ•°æ®æµç¨‹å›¾

```
é¡µé¢åŠ è½½ (src/pages/trips/[id].tsx)
â”‚
â”œâ”€ loadTrip() â†’ GET /trips/:id
â”‚  â””â”€ trip (TripDetail)
â”‚     â”œâ”€ åŸºæœ¬ä¿¡æ¯
â”‚     â”œâ”€ statistics (é¢„ç®—ã€å¤©æ•°ç­‰)
â”‚     â””â”€ TripDay[] (è¡Œç¨‹é¡¹åˆ—è¡¨)
â”‚
â”œâ”€ loadTripMetrics() â†’ GET /trips/:id/metrics
â”‚  â””â”€ tripMetrics (TripMetricsResponse)
â”‚     â””â”€ summary (totalBuffer, totalFatigueç­‰)
â”‚
â”œâ”€ loadConflicts() â†’ GET /trips/:id/conflicts
â”‚  â””â”€ conflicts (ConflictsResponse)
â”‚     â””â”€ conflicts[] (å†²çªåˆ—è¡¨)
â”‚
â”œâ”€ loadSuggestions() â†’ GET /trips/:id/suggestions + /suggestions/stats
â”‚  â”œâ”€ suggestions (Suggestion[])
â”‚  â””â”€ suggestionStats (SuggestionStats)
â”‚
â””â”€ loadEvidence() â†’ GET /trips/:id/evidence
   â””â”€ evidence (EvidenceListResponse)

æ•°æ®ä½¿ç”¨
â”‚
â”œâ”€ å¥åº·åº¦æŒ‡æ ‡ (healthMetrics)
â”‚  â””â”€ è®¡ç®—æ¥æº: tripMetrics + conflicts + trip.statistics
â”‚     â””â”€ âœ… åŸºäºçœŸå®æ•°æ®è®¡ç®—
â”‚
â”œâ”€ ç»¼åˆè§†å›¾ (AutoView)
â”‚  â”œâ”€ overallMetrics
â”‚  â”‚  â”œâ”€ safetyScore: 75 âš ï¸ ç¡¬ç¼–ç 
â”‚  â”‚  â”œâ”€ rhythmScore: 80 âš ï¸ ç¡¬ç¼–ç 
â”‚  â”‚  â”œâ”€ readinessScore: 85 âš ï¸ ç¡¬ç¼–ç 
â”‚  â”‚  â”œâ”€ criticalIssues: 2 âš ï¸ ç¡¬ç¼–ç 
â”‚  â”‚  â”œâ”€ warnings: 3 âš ï¸ ç¡¬ç¼–ç 
â”‚  â”‚  â””â”€ suggestions: 5 âš ï¸ ç¡¬ç¼–ç ï¼ˆå¯ä»suggestionStatsè·å–ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ å…³é”®é—®é¢˜åˆ—è¡¨ âš ï¸ ç¡¬ç¼–ç 
â”‚  â””â”€ å…³é”®æŒ‡æ ‡ âš ï¸ ç¡¬ç¼–ç 
â”‚
â”œâ”€ å®‰å…¨è§†å›¾ (AbuView)
â”‚  â”œâ”€ gatingStatus: 'WARN' âš ï¸ ç¡¬ç¼–ç 
â”‚  â”œâ”€ violations: [] âš ï¸ ç¡¬ç¼–ç 
â”‚  â””â”€ riskMap: {} âš ï¸ ç¡¬ç¼–ç 
â”‚
â”œâ”€ èŠ‚å¥è§†å›¾ (DrDreView)
â”‚  â”œâ”€ metrics: {} âš ï¸ ç¡¬ç¼–ç ï¼ˆtripMetricså·²è·å–ä½†æœªä½¿ç”¨ï¼‰
â”‚  â””â”€ metricsByItem: {} âš ï¸ ç¡¬ç¼–ç 
â”‚
â””â”€ ä¿®å¤è§†å›¾ (NeptuneView)
   â”œâ”€ repairs: [] âš ï¸ ç¡¬ç¼–ç 
   â””â”€ alternatives: {} âš ï¸ ç¡¬ç¼–ç 
```

---

## ğŸ“ æ•°æ®æ¥æºæ±‡æ€»è¡¨

### é¡µé¢é¡¶éƒ¨å¥åº·åº¦åŒºåŸŸ

| æ•°æ®é¡¹ | æ¥æº | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|------|
| å¥åº·åº¦æ€»åˆ† | è®¡ç®—ï¼ˆ4ä¸ªæŒ‡æ ‡å¹³å‡å€¼ï¼‰ | âœ… å·²å®ç° | åŸºäº tripMetrics + conflicts |
| å¯æ‰§è¡Œåº¦ | è®¡ç®—ï¼ˆç¼“å†²æ—¶é—´ + ç–²åŠ³æŒ‡æ•°ï¼‰ | âœ… å·²å®ç° | åŸºäº tripMetrics |
| ç¼“å†² | è®¡ç®—ï¼ˆç¼“å†²æ—¶é—´å æ¯”ï¼‰ | âœ… å·²å®ç° | åŸºäº tripMetrics |
| é£é™© | è®¡ç®—ï¼ˆå†²çªæ•°é‡ï¼‰ | âœ… å·²å®ç° | åŸºäº conflicts |
| æˆæœ¬ | è®¡ç®—ï¼ˆé¢„ç®—ä½¿ç”¨ç‡ï¼‰ | âœ… å·²å®ç° | åŸºäº trip.statistics |

### å»ºè®®ç»Ÿè®¡åŒºåŸŸ

| æ•°æ®é¡¹ | æ¥æº | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|------|
| å»ºè®®æ€»æ•° | `GET /trips/:id/suggestions/stats` | âœ… å·²å¯¹æ¥ | suggestionStats.total |
| é£é™©å»ºè®®æ•° | `GET /trips/:id/suggestions/stats` | âœ… å·²å¯¹æ¥ | suggestionStats.byPersona.abu.total |
| èŠ‚å¥å»ºè®®æ•° | `GET /trips/:id/suggestions/stats` | âœ… å·²å¯¹æ¥ | suggestionStats.byPersona.drdre.total |
| ä¿®å¤å»ºè®®æ•° | `GET /trips/:id/suggestions/stats` | âœ… å·²å¯¹æ¥ | suggestionStats.byPersona.neptune.total |

### ç»¼åˆè§†å›¾ï¼ˆAutoViewï¼‰

| æ•°æ®é¡¹ | æ¥æº | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|------|
| å®‰å…¨è¯„åˆ† | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | `safetyScore: 75` |
| èŠ‚å¥è¯„åˆ† | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | `rhythmScore: 80` |
| å‡†å¤‡åº¦è¯„åˆ† | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | `readinessScore: 85` |
| å…³é”®é—®é¢˜æ•° | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | `criticalIssues: 2` |
| è­¦å‘Šæ•° | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | `warnings: 3` |
| å»ºè®®æ•° | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | `suggestions: 5`ï¼ˆå¯ä»APIè·å–ï¼‰ |
| å…³é”®é—®é¢˜åˆ—è¡¨ | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | "å¤œé—´å¾’æ­¥é£é™©"ã€"ç¼“å†²æ—¶é—´ä¸è¶³" |
| æ€»æ—¶é•¿ | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | "24å°æ—¶" |
| ç–²åŠ³æŒ‡æ•° | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | "65/100" |
| é¢„è®¡èŠ±è´¹ | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | "Â¥5,000" |
| å¯é æ€§ | ç¡¬ç¼–ç  | âš ï¸ ç¡¬ç¼–ç  | "85%" |

---

## ğŸ’¡ æ”¹è¿›å»ºè®®

### ä¼˜å…ˆçº§1: AutoView æ•°æ®å¯¹æ¥

**é—®é¢˜**: AutoView ä¸­çš„ `overallMetrics` å®Œå…¨ç¡¬ç¼–ç 

**è§£å†³æ–¹æ¡ˆ**:
1. å°† `tripMetrics`ã€`suggestionStats`ã€`violations`ã€`repairs` ä½œä¸º props ä¼ å…¥ AutoView
2. åœ¨ AutoView ä¸­åŸºäºçœŸå®æ•°æ®è®¡ç®—ç»¼åˆæŒ‡æ ‡
3. å¯¹æ¥ `GET /trips/:id/violations` å’Œ `GET /trips/:id/repairs` æ¥å£

### ä¼˜å…ˆçº§2: å…³é”®é—®é¢˜åˆ—è¡¨å¯¹æ¥

**é—®é¢˜**: å…³é”®é—®é¢˜åˆ—è¡¨å®Œå…¨ç¡¬ç¼–ç 

**è§£å†³æ–¹æ¡ˆ**:
1. å¯¹æ¥ `GET /trips/:id/critical-issues` æ¥å£
2. æˆ–è€…ä» `GET /trips/:id/violations` è¿‡æ»¤è·å–

### ä¼˜å…ˆçº§3: å…³é”®æŒ‡æ ‡å¯¹æ¥

**é—®é¢˜**: å…³é”®æŒ‡æ ‡ï¼ˆæ€»æ—¶é•¿ã€ç–²åŠ³æŒ‡æ•°ç­‰ï¼‰ç¡¬ç¼–ç 

**è§£å†³æ–¹æ¡ˆ**:
1. ä» `tripMetrics` ä¸­è·å–çœŸå®æ•°æ®
2. å°† `tripMetrics` ä½œä¸º props ä¼ å…¥ AutoView

---

## ğŸ“Š æ•°æ®çŠ¶æ€ç»Ÿè®¡

### æ•°æ®æ¥æºåˆ†å¸ƒ

- âœ… **API æ•°æ®**: 8ä¸ªæ•°æ®æº
- âš ï¸ **ç¡¬ç¼–ç æ•°æ®**: 15ä¸ªæ•°æ®é¡¹
- ğŸ”„ **è®¡ç®—æ•°æ®**: 5ä¸ªæŒ‡æ ‡

### è§†å›¾ç»„ä»¶æ•°æ®çŠ¶æ€

| ç»„ä»¶ | APIæ•°æ® | ç¡¬ç¼–ç æ•°æ® | è®¡ç®—æ•°æ® |
|------|---------|-----------|---------|
| ä¸»é¡µé¢ï¼ˆå¥åº·åº¦ï¼‰ | âœ… 3ä¸ª | âŒ 0ä¸ª | âœ… 5ä¸ª |
| AutoView | âŒ 0ä¸ª | âš ï¸ 11ä¸ª | âŒ 0ä¸ª |
| AbuView | âŒ 0ä¸ª | âš ï¸ 3ä¸ª | âŒ 0ä¸ª |
| DrDreView | âš ï¸ 1ä¸ªï¼ˆæœªä½¿ç”¨ï¼‰ | âš ï¸ 2ä¸ª | âŒ 0ä¸ª |
| NeptuneView | âŒ 0ä¸ª | âš ï¸ 2ä¸ª | âŒ 0ä¸ª |

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**ç»´æŠ¤è€…**: å‰ç«¯å›¢é˜Ÿ

